// Made with Panda.js - http://www.pandajs.net
pandaConfig={"system":{"orientation":"landscape","resizeToFill":true,"scaleToFit":false,"rotateImg":"rotate_screen.png","startScene":"SceneTitle","bgColor":"#000000","bgColorRotate":"#ffffff","webGL":true,"canvasId":"canvas"},"storage":{"id":"com.goodboydigital.atobee"},"loader":{"barColor":7600014,"barWidth":285,"barHeight":25},"useBlendModes":true,"useTint":true,"useShadows":true,"sourceFolder":"src","outputFile":"game.min.js"};var core={version:"1.5.2",config:"undefined"!=typeof pandaConfig?pandaConfig:{},coreModules:["engine.loader","engine.timer","engine.system","engine.audio","engine.renderer","engine.sprite","engine.debug","engine.storage","engine.tween","engine.scene","engine.pool","engine.analytics"],scale:1,scene:null,debug:null,system:null,sound:null,pool:null,storage:null,keyboard:null,device:{},assets:{},plugins:{},json:{},renderer:null,modules:{},nocache:"",current:null,loadQueue:[],waitForLoad:0,DOMLoaded:!1,next:1,anims:{},assetQueue:[],audioQueue:{},getJSON:function(e){return this.json[this.assets[e]]},copy:function(e){var t,i,s;if(!e||"object"!=typeof e||e instanceof HTMLElement||e instanceof this.Class||this.Container&&e instanceof this.Container)return e;if(e instanceof Array){for(i=[],s=0,t=e.length;t>s;s++)i[s]=this.copy(e[s]);return i}i={};for(s in e)i[s]=this.copy(e[s]);return i},merge:function(e,t){for(var i in t){var s=t[i];"object"!=typeof s||s instanceof HTMLElement||s instanceof this.Class||s instanceof this.Container?e[i]=s:(e[i]&&"object"==typeof e[i]||(e[i]=s instanceof Array?[]:{}),this.merge(e[i],s))}return e},ksort:function(e){if(!e||"object"!=typeof e)return!1;var t,i=[],s={};for(t in e)i.push(t);for(i.sort(),t=0;t<i.length;t++)s[i[t]]=e[i[t]];return s},setVendorAttribute:function(e,t,i){var s=t.ucfirst();e[t]=e["ms"+s]=e["moz"+s]=e["webkit"+s]=e["o"+s]=i},getVendorAttribute:function(e,t){var i=t.ucfirst();return e[t]||e["ms"+i]||e["moz"+i]||e["webkit"+i]||e["o"+i]},normalizeVendorAttribute:function(e,t){var i=this.getVendorAttribute(e,t);e[t]||(e[t]=e[t]||i)},fullscreen:function(){this.system.canvas.requestFullscreen&&this.system.canvas.requestFullscreen(),this.system.canvas.requestFullScreen&&this.system.canvas.requestFullScreen()},fullscreenSupport:function(){return!(!this.system.canvas.requestFullscreen&&!this.system.canvas.requestFullScreen)},addAsset:function(e,t){return t=t||e,e=this.config.mediaFolder+e+this.nocache,this.assets[t]=e,-1===this.assetQueue.indexOf(e)&&this.assetQueue.push(e),t},addAudio:function(e,t){return t=t||e,e=this.config.mediaFolder+e+this.nocache,this.audioQueue[e]=t,t},module:function(e,t){if(this.current)throw"Module "+this.current.name+" has no body";if(this.modules[e]&&this.modules[e].body)throw"Module "+e+" is already defined";return this.current={name:e,requires:[],loaded:!1,body:null,version:t},"game.main"===e&&this.current.requires.push("engine.core"),this.modules[e]=this.current,this.loadQueue.push(this.current),"engine.core"===this.current.name&&(this.current.requires=this.coreModules,this.body(function(){})),this},require:function(e){var t,e=Array.prototype.slice.call(arguments);for(t=0;t<e.length;t++)e[t]&&-1===this.current.requires.indexOf(e[t])&&this.current.requires.push(e[t]);return this},body:function(e){this.current.body=e,this.current=null,this.loadFinished&&this.loadModules()},start:function(e,t,i,s,a){if(this.loadQueue.length>0)throw"Core not ready";this.system=new this.System(t,i,a),this.Audio&&(this.audio=new this.Audio),this.Pool&&(this.pool=new this.Pool),this.DebugDraw&&this.DebugDraw.enabled&&(this.debugDraw=new this.DebugDraw),this.Storage&&this.Storage.id&&(this.storage=new this.Storage(this.Storage.id)),this.Analytics&&this.Analytics.id&&(this.analytics=new this.Analytics(this.Analytics.id)),this.TweenEngine&&(this.tweenEngine=new this.TweenEngine);for(var n in this.plugins)this.plugins[n]=new this.plugins[n];this.loader=new(s||this.Loader)(e),this.system.rotateScreenVisible||this.loader.start()},loadScript:function(e,t){this.modules[e]=!0,this.waitForLoad++;var i=this.config.sourceFolder+"/"+e.replace(/\./g,"/")+".js"+this.nocache,s=document.createElement("script");s.type="text/javascript",s.src=i;var a=this;s.onload=function(){a.waitForLoad--,a.loadModules()},s.onerror=function(){throw"Failed to load module "+e+" at "+i+" required from "+t},document.getElementsByTagName("head")[0].appendChild(s)},loadModules:function(){var e,t,i,s,a,n;for(t=0;t<this.loadQueue.length;t++){for(s=this.loadQueue[t],n=!0,i=0;i<s.requires.length;i++)a=s.requires[i],this.modules[a]?this.modules[a].loaded||(n=!1):(n=!1,this.loadScript(a,s.name));if(n&&s.body){if(this.loadQueue.splice(t,1),0===this.loadQueue.length)for(var r in this.config){var o=r.ucfirst();if(this[o])for(var h in this.config[r])this[o][h]=this.config[r][h]}s.loaded=!0,s.body(this),e=!0,t--}}if(e&&this.loadQueue.length>0)this.loadModules();else{if(0===this.waitForLoad&&0!==this.loadQueue.length){var l=[];for(t=0;t<this.loadQueue.length;t++){var d=[],u=this.loadQueue[t].requires;for(i=0;i<u.length;i++)s=this.modules[u[i]],s&&s.loaded||d.push(u[i]);l.push(this.loadQueue[t].name+" (requires: "+d.join(", ")+")")}throw"Unresolved modules:\n"+l.join("\n")}this.loadFinished=!0}},setGameLoop:function(e,t){if(window.requestAnimationFrame){var i=this.next++;this.anims[i]=!0;var s=this,a=function(){s.anims[i]&&(window.requestAnimationFrame(a,t),e())};return window.requestAnimationFrame(a,t),i}return window.setInterval(e,1e3/60)},clearGameLoop:function(e){window.requestAnimationFrame?delete this.anims[e]:window.clearInterval(e)},boot:function(){var e=document.createElement("canvas"),t=!(!e.getContext||!e.getContext("2d"));if(!t){if(!core.config.noCanvasURL)throw"Canvas not supported";window.location=core.config.noCanvasURL}if(Math.distance=function(e,t,i,s){return e=i-e,t=s-t,Math.sqrt(e*e+t*t)},Math.randomBetween=function(e,t){return Math.random()*(t-e)+e},Math.randomInt=function(e,t){return Math.round(Math.randomBetween(e,t))},this.Math=Math,Number.prototype.limit=function(e,t){var i=this;return e>i&&(i=e),i>t&&(i=t),i},Number.prototype.round=function(e){return e=e?Math.pow(10,e):1,Math.round(this*e)/e},Array.prototype.erase=function(e){for(var t=this.length;t>=0;t--)this[t]===e&&this.splice(t,1);return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.shuffle=function(){for(var e=this.length,t=e;t--;){var i=parseInt(Math.random()*e),s=this[t];this[t]=this[i],this[i]=s}return this},Function.prototype.bind=function(e){var t=this,i=[];return Array.prototype.push.apply(i,arguments),i.shift(),function(){var s=[];return Array.prototype.push.apply(s,i),Array.prototype.push.apply(s,arguments),t.apply(e,s)}},String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},this.coreModules=this.config.coreModules||this.coreModules,this.module("engine.core"),game.normalizeVendorAttribute(window,"requestAnimationFrame"),document.location.href.match(/\?nocache/)&&(this.nocache="?"+Date.now()),this.device.pixelRatio=window.devicePixelRatio||1,this.device.screen={width:window.screen.availWidth*this.device.pixelRatio,height:window.screen.availHeight*this.device.pixelRatio},this.device.iPod=/iPod/i.test(navigator.userAgent),this.device.iPhone=/iPhone/i.test(navigator.userAgent),this.device.iPhone4=this.device.iPhone&&2===this.device.pixelRatio,this.device.iPhone5=this.device.iPhone&&2===this.device.pixelRatio&&1096===this.device.screen.height,this.device.iPad=/iPad/i.test(navigator.userAgent),this.device.iPadRetina=this.device.iPad&&2===this.device.pixelRatio,this.device.iOS=this.device.iPod||this.device.iPhone||this.device.iPad,this.device.iOS5=this.device.iOS&&/OS 5/i.test(navigator.userAgent),this.device.iOS6=this.device.iOS&&/OS 6/i.test(navigator.userAgent),this.device.iOS7=this.device.iOS&&/OS 7/i.test(navigator.userAgent),this.device.iOS71=this.device.iOS&&/OS 7_1/i.test(navigator.userAgent),this.device.android=/android/i.test(navigator.userAgent),this.device.android2=/android 2/i.test(navigator.userAgent),this.device.ie9=/MSIE 9/i.test(navigator.userAgent),this.device.ie10=/MSIE 10/i.test(navigator.userAgent),this.device.ie11=/rv:11.0/i.test(navigator.userAgent),this.device.ie=this.device.ie10||this.device.ie11||this.device.ie9,this.device.wp7=/Windows Phone OS 7/i.test(navigator.userAgent),this.device.wp8=/Windows Phone 8/i.test(navigator.userAgent),this.device.wp=this.device.wp7||this.device.wp8,this.device.wt=this.device.ie&&/Tablet/i.test(navigator.userAgent),this.device.opera=/Opera/i.test(navigator.userAgent),this.device.crosswalk=/Crosswalk/i.test(navigator.userAgent),this.device.cocoonJS=!!navigator.isCocoonJS,this.device.ejecta=/Ejecta/i.test(navigator.userAgent),this.device.facebook=/FB/i.test(navigator.userAgent),this.device.mobile=this.device.iOS||this.device.android||this.device.wp||this.device.wt,"undefined"==typeof navigator.plugins||0===navigator.plugins.length)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),this.device.flash=!0}catch(i){this.device.flash=!1}else this.device.flash=!!navigator.plugins["Shockwave Flash"];for(var s in this.device)if(this.device[s]&&this.config[s])for(var a in this.config[s])this.merge(this.config[a],this.config[s][a]);this.config.sourceFolder=this.config.sourceFolder||"src",this.config.mediaFolder=this.config.mediaFolder?this.config.mediaFolder+"/":"media/";var n=document.getElementsByTagName("meta"),r=!1;for(s=0;s<n.length;s++)"viewport"===n[s].name&&(r=!0);if(!r){var o=document.createElement("meta");o.name="viewport";var h="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no";this.device.iOS71&&(h+=",minimal-ui"),o.content=h,document.getElementsByTagName("head")[0].appendChild(o)}"complete"===document.readyState?this.DOMReady():(document.addEventListener("DOMContentLoaded",this.DOMReady.bind(this),!1),window.addEventListener("load",this.DOMReady.bind(this),!1))},DOMReady:function(){if(!this.DOMLoaded){if(!document.body)return setTimeout(this.DOMReady.bind(this),13);this.DOMLoaded=!0,this.loadModules()}}},initializing=!1,fnTest=/xyz/.test(function(){var e;return e})?/\b_super\b/:/[\D|\d]*/;core.Class=function(){},core.Class.extend=function(e){function t(){if(!initializing){if(this.staticInit){var e=this.staticInit.apply(this,arguments);if(e)return e}for(var t in this)"object"==typeof this[t]&&(this[t]=core.copy(this[t]));this.init&&this.init.apply(this,arguments)}return this}var i=this.prototype;initializing=!0;var s=new this;initializing=!1;var a=function(e,t){return function(){var s=this._super;this._super=i[e];var a=t.apply(this,arguments);return this._super=s,a}};for(var n in e)s[n]="function"==typeof e[n]&&"function"==typeof i[n]&&fnTest.test(e[n])?a(n,e[n]):e[n];return t.prototype=s,t.prototype.constructor=t,t.extend=core.Class.extend,t.inject=function(e){var t=this.prototype,i={},s=function(e,t){return function(){var s=this._super;this._super=i[e];var a=t.apply(this,arguments);return this._super=s,a}};for(var a in e)"function"==typeof e[a]&&"function"==typeof t[a]&&fnTest.test(e[a])?(i[a]=t[a],t[a]=s(a,e[a])):t[a]=e[a]},t},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=core),exports.core=core):(window.game=window.panda=core,core.boot()),game.module("engine.loader").body(function(){game.Loader=game.Class.extend({scene:null,loaded:0,percent:0,backgroundColor:0,assetQueue:[],soundQueue:[],started:!1,dynamic:!0,callback:null,init:function(e){e&&e.prototype.init||game.System.startScene?(this.scene=e||window[game.System.startScene]||game[game.System.startScene],this.dynamic=!1,game.System.startScene=null):this.callback=e,this.stage=game.system.stage;for(var t=0;t<game.assetQueue.length;t++)game.TextureCache[game.assetQueue[t]]||this.assetQueue.push(this.getPath(game.assetQueue[t]));if(game.Audio)for(var i in game.audioQueue)this.soundQueue.push(i);this.assetQueue.length>0&&(this.loader=new game.AssetLoader(this.assetQueue,!0),this.loader.onProgress=this.progress.bind(this),this.loader.onComplete=this.loadAudio.bind(this),this.loader.onError=this.error.bind(this)),0===this.assetQueue.length&&0===this.soundQueue.length&&(this.percent=100)},initStage:function(){if(game.Loader.logo&&(this.logo=new game.Sprite(game.Texture.fromImage(game.Loader.logo)),this.logo.anchor.set(.5,1),this.logo.position.set(game.system.width/2,game.system.height/2+this.logo.height/2),this.stage.addChild(this.logo)),this.barBg=new game.Graphics,this.barBg.beginFill(game.Loader.barBg),this.barBg.drawRect(0,0,game.Loader.barWidth,game.Loader.barHeight),this.barBg.position.set(game.system.width/2-game.Loader.barWidth/2,game.system.height/2-game.Loader.barHeight/2),this.logo&&(this.barBg.position.y+=this.logo.height/2+game.Loader.barHeight+game.Loader.barMargin),this.stage.addChild(this.barBg),this.barFg=new game.Graphics,this.barFg.beginFill(game.Loader.barColor),this.barFg.drawRect(0,0,game.Loader.barWidth,game.Loader.barHeight),this.barFg.position.set(game.system.width/2-game.Loader.barWidth/2,game.system.height/2-game.Loader.barHeight/2),this.logo&&(this.barFg.position.y+=this.logo.height/2+game.Loader.barHeight+game.Loader.barMargin),this.barFg.scale.x=this.percent/100,this.stage.addChild(this.barFg),game.Tween&&game.Loader.logoTween&&this.logo){this.logo.rotation=-.1;{new game.Tween(this.logo).to({rotation:.1},500).easing(game.Tween.Easing.Cubic.InOut).repeat().yoyo().start()}}},start:function(){if(this.started=!0,!this.dynamic){if(game.scene){for(var e=this.stage.children.length-1;e>=0;e--)this.stage.removeChild(this.stage.children[e]);this.stage.setBackgroundColor(this.backgroundColor),this.stage.interactive=!1,this.stage.mousemove=this.stage.touchmove=null,this.stage.click=this.stage.tap=null,this.stage.mousedown=this.stage.touchstart=null,this.stage.mouseup=this.stage.mouseupoutside=this.stage.touchend=this.stage.touchendoutside=null,this.stage.mouseout=null}if(game.audio&&game.audio.stopAll(),"number"==typeof this.backgroundColor){var t=new game.Graphics;t.beginFill(this.backgroundColor),t.drawRect(0,0,game.system.width,game.system.height),this.stage.addChild(t)}this.initStage(),game.scene?game.scene=this:this.loopId=game.setGameLoop(this.run.bind(this),game.system.canvas)}this.assetQueue.length>0?this.loader.load():this.loadAudio()},error:function(e){if(e)throw e},progress:function(e){e&&e.json&&!e.json.frames&&!e.json.bones&&(game.json[e.url]=e.json),this.loaded++,this.percent=Math.round(this.loaded/(this.assetQueue.length+this.soundQueue.length)*100),this.onPercentChange(),this.dynamic&&this.loaded===this.assetQueue.length+this.soundQueue.length&&this.ready()},onPercentChange:function(){this.barFg&&(this.barFg.scale.x=this.percent/100)},loadAudio:function(){for(var e=this.soundQueue.length-1;e>=0;e--)game.audio.load(this.soundQueue[e],this.progress.bind(this))},ready:function(){if(game.system.retina||game.system.hires)for(var e in game.TextureCache)-1!==e.indexOf("@2x")&&(game.TextureCache[e.replace("@2x","")]=game.TextureCache[e],delete game.TextureCache[e]);return game.assetQueue.length=0,game.Audio&&(game.audioQueue={}),this.dynamic?void("function"==typeof this.callback&&this.callback()):this.setScene()},setScene:function(){game.system.timer.last=0,game.Timer.time=Number.MIN_VALUE,this.loopId&&game.clearGameLoop(this.loopId),game.system.setScene(this.scene)},run:function(){this.loopId&&(this.last=game.Timer.time,game.Timer.update(),game.system.delta=(game.Timer.time-this.last)/1e3),this.update(),this.render()},update:function(){if(this.startTime||(this.startTime=Date.now()),game.tweenEngine&&game.tweenEngine.update(),!this._ready)if(this.timer)this.timer.time()>=0&&(this._ready=!0,this.ready());else if(this.loaded===this.assetQueue.length+this.soundQueue.length){var e=Date.now()-this.startTime,t=Math.max(100,game.Loader.timeout-e);this.timer=new game.Timer(t)}},render:function(){game.system.renderer.render(this.stage)},getPath:function(e){return game.system.retina||game.system.hires?e.replace(/\.(?=[^.]*$)/,"@2x."):e}}),game.Loader.timeout=500,game.Loader.barBg=2301728,game.Loader.barColor=15132648,game.Loader.barWidth=200,game.Loader.barHeight=20,game.Loader.barMargin=10,game.Loader.logoTween=!1,game.Loader.logo=null}),game.module("engine.timer").body(function(){game.Timer=game.Class.extend({target:0,base:0,last:0,pauseTime:0,init:function(e){this.last=game.Timer.time,this.set(e)},set:function(e){"number"!=typeof e&&(e=0),this.target=e||0,this.reset()},reset:function(){this.base=game.Timer.time,this.pauseTime=0},delta:function(){var e=game.Timer.time-this.last;return this.last=game.Timer.time,this.pauseTime?0:e},time:function(){var e=(this.pauseTime||game.Timer.time)-this.base-this.target;return e},pause:function(){this.pauseTime||(this.pauseTime=game.Timer.time)},resume:function(){this.pauseTime&&(this.base+=game.Timer.time-this.pauseTime,this.pauseTime=0)}}),game.Timer.last=0,game.Timer.time=Number.MIN_VALUE,game.Timer.speedFactor=1,game.Timer.maxStep=50,game.Timer.update=function(){var e=Date.now();game.Timer.last||(game.Timer.last=e),game.Timer.time+=Math.min(e-game.Timer.last,game.Timer.maxStep)*game.Timer.speedFactor,game.Timer.last=e}}),game.module("engine.system").body(function(){game.System=game.Class.extend({width:null,height:null,delta:0,timer:null,canvas:null,canvasId:"canvas",paused:!1,hires:!1,retina:!1,rotateScreenVisible:!1,gameLoopId:0,newSceneClass:null,running:!1,init:function(e,t,i){if(e=e||game.System.width,t=t||game.System.height,"window"===e&&(e=window.innerWidth),"window"===t&&(t=window.innerHeight),"landscape"===game.System.orientation&&(game.System.orientation=game.System.LANDSCAPE),"portrait"===game.System.orientation&&(game.System.orientation=game.System.PORTRAIT),e||(e=game.System.orientation===game.System.PORTRAIT?768:1024),t||(t=game.System.orientation===game.System.PORTRAIT?927:672),game.System.resizeToFill&&navigator.isCocoonJS&&window.innerWidth/window.innerHeight!==e/t&&(game.System.orientation===game.System.LANDSCAPE?e=t*(window.innerWidth/window.innerHeight):t=e*(window.innerHeight/window.innerWidth)),game.System.hires&&("number"==typeof game.System.hiresWidth&&"number"==typeof game.System.hiresHeight?window.innerWidth>=game.System.hiresWidth&&window.innerHeight>=game.System.hiresHeight&&(this.hires=!0):window.innerWidth>=e*game.System.hiresFactor&&window.innerHeight>=t*game.System.hiresFactor&&(this.hires=!0)),game.System.retina&&2===game.device.pixelRatio&&(this.retina=!0),(this.hires||this.retina)&&(e*=2,t*=2,game.scale=2),"undefined"!=typeof game.System.resize&&(game.System.scale=game.System.resize),this.width=e,this.height=t,this.canvasId=i||game.System.canvasId||this.canvasId,this.timer=new game.Timer,!document.getElementById(this.canvasId)){var s=document.createElement(navigator.isCocoonJS&&game.System.screenCanvas?"screencanvas":"canvas");s.id=this.canvasId,document.body.appendChild(s)}if(game.System.canvas===!1&&(game.System.webGL=!0),this.renderer=game.System.webGL?new game.autoDetectRenderer(e,t,document.getElementById(this.canvasId),game.System.transparent,game.System.antialias):new game.CanvasRenderer(e,t,document.getElementById(this.canvasId),game.System.transparent),this.canvas=this.renderer.view,this.stage=new game.Stage,game.normalizeVendorAttribute(this.canvas,"requestFullscreen"),game.normalizeVendorAttribute(this.canvas,"requestFullScreen"),game.normalizeVendorAttribute(navigator,"vibrate"),document.body.style.margin=0,this.retina?(this.canvas.style.width=e/2+"px",this.canvas.style.height=t/2+"px"):(this.canvas.style.width=e+"px",this.canvas.style.height=t+"px"),!navigator.isCocoonJS){var a;"undefined"!=typeof document.hidden?a="visibilitychange":"undefined"!=typeof document.mozHidden?a="mozvisibilitychange":"undefined"!=typeof document.msHidden?a="msvisibilitychange":"undefined"!=typeof document.webkitHidden&&(a="webkitvisibilitychange"),document.addEventListener(a,function(){if(game.System.pauseOnHide){var e=!!game.getVendorAttribute(document,"hidden");e?game.system.pause():game.system.resume()}},!1)}window.addEventListener("devicemotion",function(e){game.accelerometer=game.accel=e.accelerationIncludingGravity},!1),navigator.isCocoonJS||("object"==typeof game.System.backgroundColor&&(game.System.bgColorMobile=game.System.backgroundColor.mobile,game.System.bgColorRotate=game.System.backgroundColor.rotate),"object"==typeof game.System.backgroundImage&&(game.System.bgImageMobile=game.System.backgroundImage.mobile,game.System.bgImageRotate=game.System.backgroundImage.rotate),game.System.bgColor&&!game.System.bgColorMobile&&(game.System.bgColorMobile=game.System.bgColor),game.System.bgColorMobile&&!game.System.bgColorRotate&&(game.System.bgColorRotate=game.System.bgColorMobile),game.System.bgImage&&!game.System.bgImageMobile&&(game.System.bgImageMobile=game.System.bgImage),game.System.bgImageMobile&&!game.System.bgImageRotate&&(game.System.bgImageRotate=game.System.bgImageMobile),game.device.mobile||(game.System.bgColor&&(document.body.style.backgroundColor=game.System.bgColor),game.System.bgImage&&(document.body.style.backgroundImage="url("+game.config.mediaFolder+game.System.bgImage+")")),game.System.bgPosition&&(document.body.style.backgroundPosition=game.System.bgPosition)),navigator.isCocoonJS&&(this.canvas.style.cssText="idtkscale:"+game.System.idtkScale+";"),game.renderer=this.renderer,navigator.isCocoonJS||this.initResize()},vibrate:function(e){return navigator.vibrate?navigator.vibrate(e):!1},pause:function(){this.paused||(this.paused=!0,game.scene&&game.scene.pause())},resume:function(){this.paused&&(this.paused=!1,game.Timer.last=Date.now(),game.scene&&game.scene.resume())},setScene:function(e){this.running?this.newSceneClass=e:this.setSceneNow(e)},setSceneNow:function(e){game.tweenEngine&&(game.tweenEngine.tweens.length=0),game.scene=new e,game.Debug&&game.Debug.enabled&&!navigator.isCocoonJS&&(this.debug=new game.Debug),this.startRunLoop()},startRunLoop:function(){this.gameLoopId&&this.stopRunLoop(),this.gameLoopId=game.setGameLoop(this.run.bind(this),this.canvas),this.running=!0},stopRunLoop:function(){game.clearGameLoop(this.gameLoopId),this.running=!1},run:function(){this.paused||(game.Timer.update(),this.delta=this.timer.delta()/1e3,game.scene.run(),this.debug&&this.debug.update(),this.newSceneClass&&(this.setSceneNow(this.newSceneClass),this.newSceneClass=null))},resize:function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.renderer.resize(this.width,this.height)},initResize:function(){if(this.ratio=game.System.orientation===game.System.LANDSCAPE?this.width/this.height:this.height/this.width,game.System.center&&(this.canvas.style.margin="auto"),game.device.mobile){game.System.center||(this.canvas.style.position="absolute",this.canvas.style.left=game.System.left+"px",this.canvas.style.top=game.System.top+"px"),document.addEventListener("touchstart",function(e){e.preventDefault()},!1);var e=document.createElement("div");if(e.innerHTML=game.System.rotateImg?"":game.System.rotateMsg,e.style.position="absolute",e.style.height="12px",e.style.textAlign="center",e.style.left=0,e.style.right=0,e.style.top=0,e.style.bottom=0,e.style.margin="auto",e.style.display="none",e.id="panda-rotate",game.System.rotateDiv=e,document.body.appendChild(game.System.rotateDiv),game.System.rotateImg){var t=new Image,i=this;t.onload=function(){e.image=t,e.style.height=t.height+"px",e.appendChild(t),i.resizeRotateImage()},t.src=game.config.mediaFolder+game.System.rotateImg,t.style.position="relative",t.style.maxWidth="100%"}}else if(this.canvas.style.position="absolute",game.System.center?(this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.bottom=0,this.canvas.style.right=0):(this.canvas.style.left=game.System.left+"px",this.canvas.style.top=game.System.top+"px"),game.System.scale){var s="auto"===game.System.minWidth?this.retina?this.width/4:this.width/2:game.System.minWidth,a="auto"===game.System.minHeight?this.retina?this.height/4:this.height/2:game.System.minHeight,n="auto"===game.System.maxWidth?this.retina?this.width/2:this.width:game.System.maxWidth,r="auto"===game.System.maxHeight?this.retina?this.height/2:this.height:game.System.maxHeight;game.System.minWidth&&(this.canvas.style.minWidth=s+"px"),game.System.minHeight&&(this.canvas.style.minHeight=a+"px"),game.System.maxWidth&&!game.System.scaleToFit&&(this.canvas.style.maxWidth=n+"px"),game.System.maxHeight&&!game.System.scaleToFit&&(this.canvas.style.maxHeight=r+"px")}"undefined"==typeof window.onorientationchange||game.device.android?window.onresize=this.onResize.bind(this):window.onorientationchange=this.onResize.bind(this),this.onResize()},checkOrientation:function(){this.orientation=window.innerWidth<window.innerHeight?game.System.PORTRAIT:game.System.LANDSCAPE,game.device.android2&&320===window.innerWidth&&251===window.innerHeight&&(this.orientation=game.System.PORTRAIT),this.rotateScreenVisible=game.System.orientation!==this.orientation?!0:!1,this.canvas.style.display=this.rotateScreenVisible?"none":"block",game.System.rotateDiv.style.display=this.rotateScreenVisible?"block":"none",this.rotateScreenVisible&&game.System.bgColorRotate&&(document.body.style.backgroundColor=game.System.bgColorRotate),!this.rotateScreenVisible&&game.System.bgColorMobile&&(document.body.style.backgroundColor=game.System.bgColorMobile),this.rotateScreenVisible&&game.System.bgImageRotate&&(document.body.style.backgroundImage="url("+game.config.mediaFolder+game.System.bgImageRotate+")"),!this.rotateScreenVisible&&game.System.bgImageMobile&&(document.body.style.backgroundImage="url("+game.config.mediaFolder+game.System.bgImageMobile+")"),this.rotateScreenVisible&&game.system&&"function"==typeof game.system.pause&&game.system.pause(),!this.rotateScreenVisible&&game.system&&"function"==typeof game.system.resume&&game.system.resume(),this.rotateScreenVisible&&this.resizeRotateImage()},resizeRotateImage:function(){this.rotateScreenVisible&&game.System.rotateDiv.image&&window.innerHeight<game.System.rotateDiv.image.height&&(game.System.rotateDiv.image.style.height=window.innerHeight+"px",game.System.rotateDiv.image.style.width="auto",game.System.rotateDiv.style.height=window.innerHeight+"px",game.System.rotateDiv.style.bottom="auto")},onResize:function(){if(game.device.mobile&&this.checkOrientation(),game.System.scale)if(game.device.mobile){var e=window.innerWidth,t=window.innerHeight;game.device.iOS7&&256===window.innerHeight&&(t=319),game.device.iOS7&&2===game.device.pixelRatio&&this.orientation===game.System.LANDSCAPE&&(t+=2),game.System.resizeToFill&&!this.rotateScreenVisible&&e/t!==this.width/this.height&&(this.orientation===game.System.LANDSCAPE?(this.width=this.height*(e/t),this.ratio=this.width/this.height):(this.height=this.width*(t/e),this.ratio=this.height/this.width),this.renderer.resize(this.width,this.height)),game.System.orientation===game.System.LANDSCAPE?(this.canvas.style.height=t+"px",this.canvas.style.width=t*this.ratio+"px"):(this.canvas.style.width=e+"px",this.canvas.style.height=e*this.ratio+"px"),game.device.ejecta||window.scroll(0,1),this.rotateScreenVisible||!game.loader||game.loader.started||game.loader.start()}else{if(0===window.innerWidth)return;window.innerWidth<this.width||window.innerHeight<this.height||game.System.scaleToFit?window.innerWidth/this.width<window.innerHeight/this.height?(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerWidth*(this.height/this.width)+"px"):(this.canvas.style.height=window.innerHeight+"px",this.canvas.style.width=window.innerHeight*(this.width/this.height)+"px"):(this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px")}}}),game.System.center=!0,game.System.left=0,game.System.top=0,game.System.scale=!0,game.System.minWidth="auto",game.System.minHeight="auto",game.System.maxWidth="auto",game.System.maxHeight="auto",game.System.idtkScale="ScaleAspectFit",game.System.screenCanvas=!0,game.System.hires=!1,game.System.hiresFactor=1.5,game.System.hiresWidth=null,game.System.hiresHeight=null,game.System.retina=!1,game.System.pauseOnHide=!0,game.System.PORTRAIT=0,game.System.LANDSCAPE=1,game.System.orientation=game.System.PORTRAIT,game.System.bgColor=null,game.System.bgColorMobile=null,game.System.bgColorRotate=null,game.System.bgImage=null,game.System.bgImageMobile=null,game.System.bgImageRotate=null,game.System.bgPosition=null,game.System.rotateMsg=null,game.System.rotateImg=null,game.System.webGL=!1,game.System.transparent=!1,game.System.antialias=!1,game.System.resizeToFill=!1,game.System.startScene="SceneGame",game.System.scaleToFit=!1,game.System.canvasId=null}),game.module("engine.audio").body(function(){game.Audio=game.Class.extend({format:null,soundMuted:!1,soundVolume:1,currentMusic:null,musicMuted:!1,musicVolume:1,sources:{},context:null,gainNode:null,init:function(){if(game.normalizeVendorAttribute(window,"AudioContext"),game.device.iOS5&&(game.Audio.enabled=!1),game.device.wp&&(game.Audio.enabled=!1),game.device.android2&&(game.Audio.enabled=!1),game.device.cocoonJS||navigator.onLine||!game.device.mobile||(game.Audio.enabled=!1),game.Audio.enabled||(game.Audio.webAudio=!1),game.Audio.webAudio&&!window.AudioContext&&(game.Audio.webAudio=!1),game.Audio.enabled)for(var e=new Audio,t=0;t<game.Audio.formats.length;t++)if(e.canPlayType(game.Audio.formats[t].type)){this.format=game.Audio.formats[t].ext;break}this.format||(game.Audio.enabled=!1),game.Audio.enabled&&game.Audio.webAudio&&(this.context=new AudioContext,this.context.createGain?this.gainNode=this.context.createGain():this.context.createGainNode&&(this.gainNode=this.context.createGainNode()),this.gainNode.connect(this.context.destination))},decode:function(e,t,i){if(this.context){if(!e.response)throw"Error loading audio: "+t;this.context.decodeAudioData(e.response,this.loaded.bind(this,t,i),this.loadError.bind(this,t))}},load:function(e,t){if(!game.Audio.enabled)return t?t():!1;var i=this.getPath(e);if(this.context){var s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType="arraybuffer",s.onload=this.decode.bind(this,s,e,t),s.send()}else{var a=new Audio(i);game.device.ie?this.loaded(e,t,a):(a.loadCallback=this.loaded.bind(this,e,t,a),a.addEventListener("canplaythrough",a.loadCallback,!1),a.addEventListener("error",this.loadError.bind(this,e),!1)),a.preload="auto",a.load()}},loaded:function(e,t,i){if(this.sources[game.audioQueue[e]])throw"Duplicate audio source: "+game.audioQueue[e];if(!game.audioQueue[e])throw"Cannot find audio resource: "+e;var s=game.audioQueue[e];this.sources[s]={clips:[],audio:i,path:e},i instanceof Audio&&(i.removeEventListener("canplaythrough",i.loadCallback,!1),i.addEventListener("ended",function(){this.playing=!1},!1)),t&&t(e)},loadError:function(e){throw"Error loading: "+e},getPath:function(e){return e.replace(/[^\.]+$/,this.format+game.nocache)},play:function(e,t,i,s,a){if(!this.sources[e])throw"Cannot find source: "+e;if(this.context){var n=this.context.createBufferSource();n.buffer=this.sources[e].audio,n.loop=!!i,n.playbackRate.value=a||1,n.onended="function"==typeof s?s.bind(this):null;var r;this.context.createGain?r=this.context.createGain():this.context.createGainNode&&(r=this.context.createGainNode()),r.gain.value=t||1,r.connect(this.gainNode),n.connect(r),n.start?n.start(0,this.sources[e].audio.pauseTime||0):n.noteOn&&n.noteOn(0,this.sources[e].audio.pauseTime||0),this.sources[e].clips.push(n),this.sources[e].audio.volume=r.gain.value,this.sources[e].audio.loop=n.loop,this.sources[e].audio.startTime=this.context.currentTime-this.sources[e].audio.pauseTime||0}else this.sources[e].audio.volume=t||1,this.sources[e].audio.loop=i,this.sources[e].audio.playing=!0,this.sources[e].audio.onended="function"==typeof s?s.bind(this):null,this.sources[e].audio.currentTime=0,this.sources[e].audio.play()},stop:function(e){if(!this.sources[e])throw"Cannot find source: "+e;if(this.context){for(var t=0;t<this.sources[e].clips.length;t++)this.sources[e].clips[t].stop?this.sources[e].clips[t].stop(!0):this.sources[e].clips[t].noteOff&&this.sources[e].clips[t].noteOff(!0);this.sources[e].clips.length=0,this.sources[e].audio.pauseTime=0}else navigator.isCocoonJS?this.sources[e].audio.volume=0:this.sources[e].audio.pause(),this.sources[e].audio.playing=!1,this.sources[e].audio.currentTime=0},pause:function(e){if(!this.sources[e])throw"Cannot find source: "+e;
if(this.context){if(0===this.sources[e].clips.length)return;for(var t=0;t<this.sources[e].clips.length;t++)this.sources[e].clips[t].stop?this.sources[e].clips[t].stop(!0):this.sources[e].clips[t].noteOff&&this.sources[e].clips[t].noteOff(!0);this.sources[e].clips.length=0,this.sources[e].audio.pauseTime=(this.context.currentTime-this.sources[e].audio.startTime)%this.sources[e].audio.duration,this.context.currentTime>this.sources[e].audio.startTime+this.sources[e].audio.duration&&!this.sources[e].audio.loop&&(this.sources[e].audio.pauseTime=0)}else(this.sources[e].audio.currentTime>0&&this.sources[e].audio.currentTime<this.sources[e].audio.duration||this.sources[e].audio.loop)&&this.sources[e].audio.pause()},resume:function(e){if(!this.sources[e])throw"Cannot find source: "+e;this.context?this.sources[e].audio.pauseTime&&(this.play(e,this.sources[e].audio.volume,this.sources[e].audio.loop),this.sources[e].audio.pauseTime=0):this.sources[e].audio.playing&&this.sources[e].audio.play()},playSound:function(e,t,i,s,a){game.Audio.enabled&&(this.soundMuted||(i=i||1,this.play(e,i*this.soundVolume,t,s,a)))},stopSound:function(e){if(game.Audio.enabled)if(e)this.stop(e);else for(e in this.sources)e!==this.currentMusic&&this.stop(e)},pauseSound:function(e){if(game.Audio.enabled)if(e)this.pause(e);else for(e in this.sources)e!==this.currentMusic&&this.pause(e)},resumeSound:function(e){if(game.Audio.enabled)if(e)this.resume(e);else for(e in this.sources)e!==this.currentMusic&&this.resume(e)},playMusic:function(e,t){game.Audio.enabled&&(this.musicMuted||(this.currentMusic&&this.stop(this.currentMusic),this.currentMusic=e,t=t||1,this.play(e,t*this.musicVolume,!0)))},stopMusic:function(){game.Audio.enabled&&(this.currentMusic&&this.stop(this.currentMusic),this.currentMusic=null)},pauseMusic:function(){game.Audio.enabled&&this.currentMusic&&this.pause(this.currentMusic)},resumeMusic:function(){game.Audio.enabled&&this.currentMusic&&(this.context?this.play(this.currentMusic,this.musicVolume,!0):this.sources[this.currentMusic].audio.playing&&this.sources[this.currentMusic].audio.play())},pauseAll:function(){game.Audio.enabled&&(this.soundMuted||this.pauseSound(),this.musicMuted||this.pauseMusic())},resumeAll:function(){game.Audio.enabled&&(this.soundMuted||this.resumeSound(),this.musicMuted||this.resumeMusic())},stopAll:function(){game.Audio.enabled&&(this.soundMuted||this.stopSound(),this.musicMuted||this.stopMusic())}}),game.Audio.enabled=!0,game.Audio.webAudio=!0,game.Audio.formats=[{ext:"m4a",type:'audio/mp4; codecs="mp4a.40.5"'},{ext:"ogg",type:'audio/ogg; codecs="vorbis"'}]}),game.module("engine.renderer").body(function(){(function(){var e=window,t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v1.5.3",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.Point=function(e,t){this.x=e||0,this.y=t||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.constructor=t.Point,t.Point.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)},t.Rectangle=function(e,t,i,s){this.x=e||0,this.y=t||0,this.width=i||0,this.height=s||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(e>=i&&e<=i+this.width){var s=this.y;if(t>=s&&t<=s+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var i=[],s=0,a=e.length;a>s;s+=2)i.push(new t.Point(e[s],e[s+1]));e=i}this.points=e},t.Polygon.prototype.clone=function(){for(var e=[],i=0;i<this.points.length;i++)e.push(this.points[i].clone());return new t.Polygon(e)},t.Polygon.prototype.contains=function(e,t){for(var i=!1,s=0,a=this.points.length-1;s<this.points.length;a=s++){var n=this.points[s].x,r=this.points[s].y,o=this.points[a].x,h=this.points[a].y,l=r>t!=h>t&&(o-n)*(t-r)/(h-r)+n>e;l&&(i=!i)}return i},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(e,t,i){this.x=e||0,this.y=t||0,this.radius=i||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var i=this.x-e,s=this.y-t,a=this.radius*this.radius;return i*=i,s*=s,a>=i+s},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(e,t,i,s){this.x=e||0,this.y=t||0,this.width=i||0,this.height=s||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var i=(e-this.x)/this.width,s=(t-this.y)/this.height;return i*=i,s*=s,1>=i+s},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},t.Matrix2=t.determineMatrixArrayType(),t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new Float32Array(9));var t=this.array;return e?(this.array[0]=this.a,this.array[1]=this.c,this.array[2]=0,this.array[3]=this.b,this.array[4]=this.d,this.array[5]=0,this.array[6]=this.tx,this.array[7]=this.ty,this.array[8]=1):(this.array[0]=this.a,this.array[1]=this.b,this.array[2]=this.tx,this.array[3]=this.c,this.array[4]=this.d,this.array[5]=this.ty,this.array[6]=0,this.array[7]=0,this.array[8]=1),t},t.identityMatrix=new t.Matrix,t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,t.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){for(var t=[],i=0;i<e.length;i++)for(var s=e[i].passes,a=0;a<s.length;a++)t.push(s[a]);this._filterBlock={target:this,filterPasses:t}}this._filters=e}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e)}}),t.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.parent.worldTransform,t=this.worldTransform,i=this.pivot.x,s=this.pivot.y,a=this._cr*this.scale.x,n=-this._sr*this.scale.y,r=this._sr*this.scale.x,o=this._cr*this.scale.y,h=this.position.x-a*i-s*n,l=this.position.y-o*s-i*r,d=e.a,u=e.b,c=e.c,m=e.d;t.a=d*a+u*r,t.b=d*n+u*o,t.tx=d*h+u*l+e.tx,t.c=c*a+m*r,t.d=c*n+m*o,t.ty=c*h+m*l+e.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e){var i=this.getLocalBounds(),s=new t.RenderTexture(0|i.width,0|i.height,e);return s.render(this,new t.Point(-i.x,-i.y)),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype._renderCachedSprite=function(e){e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var i=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var s=this._filters;this._filters=null,this._cachedSprite.filters=s,this._cachedSprite.texture.render(this,new t.Point(-e.x,-e.y)),this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._filters=s,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(e){e=e},t.DisplayObject.prototype._renderCanvas=function(e){e=e},Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,t.DisplayObjectContainer.prototype.addChild=function(e){this.addChildAt(e,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.stage&&e.setStageReference(this.stage)},t.DisplayObjectContainer.prototype.swapChildren=function(e,t){if(e!==t){var i=this.children.indexOf(e),s=this.children.indexOf(t);if(0>i||0>s)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t,this.children[s]=e}},t.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")},t.DisplayObjectContainer.prototype.removeChild=function(e){return this.removeChildAt(this.children.indexOf(e))},t.DisplayObjectContainer.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(e,1),t},t.DisplayObjectContainer.prototype.removeChildren=function(e,t){var i=e||0,s="number"==typeof t?t:this.children.length,a=s-i;if(a>0&&s>=a){for(var n=this.children.splice(i,a),r=0;r<n.length;r++){var o=n[r];this.stage&&o.removeStageReference(),o.parent=void 0}return n}throw new Error("Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(t.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var e=0,i=this.children.length;i>e;e++)this.children[e].updateTransform()},t.DisplayObjectContainer.prototype.getBounds=function(e){if(0===this.children.length)return t.EmptyRectangle;if(e){var i=this.worldTransform;this.worldTransform=e,this.updateTransform(),this.worldTransform=i}for(var s,a,n,r=1/0,o=1/0,h=-1/0,l=-1/0,d=!1,u=0,c=this.children.length;c>u;u++){var m=this.children[u];m.visible&&(d=!0,s=this.children[u].getBounds(e),r=r<s.x?r:s.x,o=o<s.y?o:s.y,a=s.width+s.x,n=s.height+s.y,h=h>a?h:a,l=l>n?l:n)}if(!d)return t.EmptyRectangle;var g=this._bounds;return g.x=r,g.y=o,g.width=h-r,g.height=l-o,g},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var i=0,s=this.children.length;s>i;i++)this.children[i].updateTransform();var a=this.getBounds();return this.worldTransform=e,a},t.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0);for(var t=0,i=this.children.length;i>t;t++){var s=this.children[t];s.setStageReference(e)}},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0,t=this.children.length;t>e;e++){var i=this.children[e];i.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);var t,i;if(this._mask||this._filters){for(this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),e.spriteBatch.start()}else for(t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(e)}},t.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);this._mask&&e.maskManager.pushMask(this._mask,e.context);for(var t=0,i=this.children.length;i>t;t++){var s=this.children[t];s._renderCanvas(e)}this._mask&&e.maskManager.popMask(e.context)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,e.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!==e.baseTexture?(this.textureChange=!0,this.texture=e):this.texture=e,this.cachedTint=16777215,this.updateFrame=!0},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},t.Sprite.prototype.getBounds=function(e){var t=this.texture.frame.width,i=this.texture.frame.height,s=t*(1-this.anchor.x),a=t*-this.anchor.x,n=i*(1-this.anchor.y),r=i*-this.anchor.y,o=e||this.worldTransform,h=o.a,l=o.c,d=o.b,u=o.d,c=o.tx,m=o.ty,g=h*a+d*r+c,p=u*r+l*a+m,f=h*s+d*r+c,v=u*r+l*s+m,y=h*s+d*n+c,x=u*n+l*s+m,w=h*a+d*n+c,b=u*n+l*a+m,T=-1/0,S=-1/0,C=1/0,A=1/0;C=C>g?g:C,C=C>f?f:C,C=C>y?y:C,C=C>w?w:C,A=A>p?p:A,A=A>v?v:A,A=A>x?x:A,A=A>b?b:A,T=g>T?g:T,T=f>T?f:T,T=y>T?y:T,T=w>T?w:T,S=p>S?p:S,S=v>S?v:S,S=x>S?x:S,S=b>S?b:S;var M=this._bounds;return M.x=C,M.width=T-C,M.y=A,M.height=S-A,this._currentBounds=M,M},t.Sprite.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)){var t,i;if(this._mask||this._filters){var s=e.spriteBatch;for(this._mask&&(s.stop(),e.maskManager.pushMask(this.mask,e),s.start()),this._filters&&(s.flush(),e.filterManager.pushFilter(this._filterBlock)),s.render(this),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(e);s.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),s.start()}else for(e.spriteBatch.render(this),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(e)}},t.Sprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){var i=this.texture.frame,s=e.context,a=this.texture;if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,s.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e.context),i&&i.width&&i.height&&a.baseTexture.source){s.globalAlpha=this.worldAlpha;var n=this.worldTransform;if(e.roundPixels?s.setTransform(n.a,n.c,n.b,n.d,0|n.tx,0|n.ty):s.setTransform(n.a,n.c,n.b,n.d,n.tx,n.ty),e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,s[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR),16777215!==this.tint){if(this.cachedTint!==this.tint){if(!a.baseTexture.hasLoaded)return;this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)}s.drawImage(this.tintedTexture,0,0,i.width,i.height,this.anchor.x*-i.width,this.anchor.y*-i.height,i.width,i.height)}else if(a.trim){var r=a.trim;s.drawImage(this.texture.baseTexture.source,i.x,i.y,i.width,i.height,r.x-this.anchor.x*r.width,r.y-this.anchor.y*r.height,i.width,i.height)}else s.drawImage(this.texture.baseTexture.source,i.x,i.y,i.width,i.height,this.anchor.x*-i.width,this.anchor.y*-i.height,i.width,i.height)}for(var o=0,h=this.children.length;h>o;o++){var l=this.children[o];l._renderCanvas(e)}this._mask&&e.maskManager.popMask(e.context)}},t.Sprite.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(i)},t.Sprite.fromImage=function(e,i,s){var a=t.Texture.fromImage(e,i,s);return new t.Sprite(a)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){t.DisplayObject.prototype.updateTransform.call(this)},t.SpriteBatch.prototype._renderWebGL=function(e){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(e.gl),e.spriteBatch.stop(),e.shaderManager.activateShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.shaderManager.activateShader(e.shaderManager.defaultShader),e.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(e){var i=e.context;i.globalAlpha=this.worldAlpha,t.DisplayObject.prototype.updateTransform.call(this);for(var s=this.worldTransform,a=!0,n=0;n<this.children.length;n++){var r=this.children[n];if(r.visible){var o=r.texture,h=o.frame;if(i.globalAlpha=this.worldAlpha*r.alpha,r.rotation%(2*Math.PI)===0)a&&(i.setTransform(s.a,s.c,s.b,s.d,s.tx,s.ty),a=!1),i.drawImage(o.baseTexture.source,h.x,h.y,h.width,h.height,r.anchor.x*-h.width*r.scale.x+r.position.x+.5|0,r.anchor.y*-h.height*r.scale.y+r.position.y+.5|0,h.width*r.scale.x,h.height*r.scale.y);else{a||(a=!0),t.DisplayObject.prototype.updateTransform.call(r);var l=r.worldTransform;e.roundPixels?i.setTransform(l.a,l.c,l.b,l.d,0|l.tx,0|l.ty):i.setTransform(l.a,l.c,l.b,l.d,l.tx,l.ty),i.drawImage(o.baseTexture.source,h.x,h.y,h.width,h.height,r.anchor.x*-h.width+.5|0,r.anchor.y*-h.height+.5|0,h.width,h.height)}}}},t.MovieClip=function(e){t.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},t.MovieClip.prototype=Object.create(t.Sprite.prototype),t.MovieClip.prototype.constructor=t.MovieClip,Object.defineProperty(t.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),t.MovieClip.prototype.stop=function(){this.playing=!1},t.MovieClip.prototype.play=function(){this.playing=!0},t.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},t.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},t.MovieClip.prototype.updateTransform=function(){if(t.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},t.MovieClip.prototype.fromFrames=function(e){for(var i=[],s=0;s<e.length;s++)i.push(new t.Texture.fromFrame(e[s]));return new t.MovieClip(i)},t.MovieClip.prototype.fromImages=function(e){for(var i=[],s=0;s<e.length;s++)i.push(new t.Texture.fromImage(e[s]));return new t.MovieClip(i)},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.Text=function(e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(i),this.updateText(),this.dirty=!1},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowAngle=e.dropShadowAngle||Math.PI/6,e.dropShadowDistance=e.dropShadowDistance||4,e.dropShadowColor=e.dropShadowColor||"black",this.style=e,this.dirty=!0},t.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),i=[],s=0,a=0;a<t.length;a++){var n=this.context.measureText(t[a]).width;i[a]=n,s=Math.max(s,n)}var r=s+this.style.strokeThickness;this.style.dropShadow&&(r+=this.style.dropShadowDistance),this.canvas.width=r+this.context.lineWidth;var o=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,h=o*t.length;this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.height=h,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";var l,d;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var u=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,c=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(a=0;a<t.length;a++)l=this.style.strokeThickness/2,d=this.style.strokeThickness/2+a*o,"right"===this.style.align?l+=s-i[a]:"center"===this.style.align&&(l+=(s-i[a])/2),this.style.fill&&this.context.fillText(t[a],l+u,d+c)}for(this.context.fillStyle=this.style.fill,a=0;a<t.length;a++)l=this.style.strokeThickness/2,d=this.style.strokeThickness/2+a*o,"right"===this.style.align?l+=s-i[a]:"center"===this.style.align&&(l+=(s-i[a])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[a],l,d),this.style.fill&&this.context.fillText(t[a],l,d);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},t.Text.prototype._renderWebGL=function(e){this.requiresUpdate&&(this.requiresUpdate=!1,t.updateWebGLTexture(this.texture.baseTexture,e.gl)),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.updateTransform.call(this)},t.Text.prototype.determineFontHeight=function(e){var i=t.Text.heightCache[e];if(!i){var s=document.getElementsByTagName("body")[0],a=document.createElement("div"),n=document.createTextNode("M");a.appendChild(n),a.setAttribute("style",e+";position:absolute;top:0;left:0"),s.appendChild(a),i=a.offsetHeight,t.Text.heightCache[e]=i,s.removeChild(a)}return i},t.Text.prototype.wordWrap=function(e){for(var t="",i=e.split("\n"),s=0;s<i.length;s++){for(var a=this.style.wordWrapWidth,n=i[s].split(" "),r=0;r<n.length;r++){var o=this.context.measureText(n[r]).width,h=o+this.context.measureText(" ").width;0===r||h>a?(r>0&&(t+="\n"),t+=n[r],a=this.style.wordWrapWidth-o):(a-=h,t+=" "+n[r])}s<i.length-1&&(t+="\n")}return t},t.Text.prototype.destroy=function(e){e&&this.texture.destroy()},t.Text.heightCache={},t.BitmapText=function(e,i){t.DisplayObjectContainer.call(this),this._pool=[],this.setText(e),this.setStyle(i),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var i=e.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],i=new t.Point,s=null,a=[],n=0,r=[],o=0,h=this.fontSize/e.size,l=0;l<this.text.length;l++){var d=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))r.push(i.x),n=Math.max(n,i.x),o++,i.x=0,i.y+=e.lineHeight,s=null;else{var u=e.chars[d];u&&(s&&u[s]&&(i.x+=u.kerning[s]),a.push({texture:u.texture,line:o,charCode:d,position:new t.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,s=d)}}r.push(i.x),n=Math.max(n,i.x);var c=[];for(l=0;o>=l;l++){var m=0;"right"===this.style.align?m=n-r[l]:"center"===this.style.align&&(m=(n-r[l])/2),c.push(m)}var g=this.children.length,p=a.length,f=this.tint||16777215;for(l=0;p>l;l++){var v=g>l?this.children[l]:this._pool.pop();v?v.setTexture(a[l].texture):v=new t.Sprite(a[l].texture),v.position.x=(a[l].position.x+c[a[l].line])*h,v.position.y=a[l].position.y*h,v.scale.x=v.scale.y=h,v.tint=f,v.parent||this.addChild(v)}for(;this.children.length>p;){var y=this.getChildAt(this.children.length-1);this._pool.push(y),this.removeChild(y)}this.textWidth=n*h,this.textHeight=(i.y+e.lineHeight)*h},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.InteractionData=function(){this.global=new t.Point,this.target=null,this.originalEvent=null},t.InteractionData.prototype.getLocalPosition=function(e){var i=e.worldTransform,s=this.global,a=i.a,n=i.b,r=i.tx,o=i.c,h=i.d,l=i.ty,d=1/(a*h+n*-o);return new t.Point(h*d*s.x+-n*d*s.y+(l*n-r*h)*d,a*d*s.y+-o*d*s.x+(-l*a+r*o)*d)},t.InteractionData.prototype.constructor=t.InteractionData,t.InteractionManager=function(e){this.stage=e,this.mouse=new t.InteractionData,this.touchs={},this.tempPoint=new t.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1},t.InteractionManager.prototype.constructor=t.InteractionManager,t.InteractionManager.prototype.collectInteractiveSprite=function(e,t){for(var i=e.children,s=i.length,a=s-1;a>=0;a--){var n=i[a];n._interactive?(t.interactiveChildren=!0,this.interactiveItems.push(n),n.children.length>0&&this.collectInteractiveSprite(n,n)):(n.__iParent=null,n.children.length>0&&this.collectInteractiveSprite(n,t))}},t.InteractionManager.prototype.setTarget=function(e){this.target=e,null===this.interactionDOMElement&&this.setTargetDomElement(e.view)},t.InteractionManager.prototype.setTargetDomElement=function(e){this.removeEvents(),window.navigator.msPointerEnabled&&(e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none"),this.interactionDOMElement=e,e.addEventListener("mousemove",this.onMouseMove,!0),e.addEventListener("mousedown",this.onMouseDown,!0),e.addEventListener("mouseout",this.onMouseOut,!0),e.addEventListener("touchstart",this.onTouchStart,!0),e.addEventListener("touchend",this.onTouchEnd,!0),e.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},t.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),i=e-this.last;if(i=i*t.INTERACTION_FREQUENCY/1e3,!(1>i)){this.last=e;var s=0;if(this.dirty){this.dirty=!1;var a=this.interactiveItems.length;for(s=0;a>s;s++)this.interactiveItems[s].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var n=this.interactiveItems.length,r="inherit",o=!1;for(s=0;n>s;s++){var h=this.interactiveItems[s];h.__hit=this.hitTest(h,this.mouse),this.mouse.target=h,h.__hit&&!o?(h.buttonMode&&(r=h.defaultCursor),h.interactiveChildren||(o=!0),h.__isOver||(h.mouseover&&h.mouseover(this.mouse),h.__isOver=!0)):h.__isOver&&(h.mouseout&&h.mouseout(this.mouse),h.__isOver=!1)}this.currentCursorStyle!==r&&(this.currentCursorStyle=r,this.interactionDOMElement.style.cursor=r)}}},t.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var t=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);for(var i=this.interactiveItems.length,s=0;i>s;s++){var a=this.interactiveItems[s];a.mousemove&&a.mousemove(this.mouse)}},t.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event,t.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var i=this.interactiveItems.length,s=0;i>s;s++){var a=this.interactiveItems[s];if((a.mousedown||a.click)&&(a.__mouseIsDown=!0,a.__hit=this.hitTest(a,this.mouse),a.__hit&&(a.mousedown&&a.mousedown(this.mouse),a.__isDown=!0,!a.interactiveChildren)))break
}},t.InteractionManager.prototype.onMouseOut=function(){var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var t=0;e>t;t++){var i=this.interactiveItems[t];i.__isOver&&(this.mouse.target=i,i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},t.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var t=this.interactiveItems.length,i=!1,s=0;t>s;s++){var a=this.interactiveItems[s];a.__hit=this.hitTest(a,this.mouse),a.__hit&&!i?(a.mouseup&&a.mouseup(this.mouse),a.__isDown&&a.click&&a.click(this.mouse),a.interactiveChildren||(i=!0)):a.__isDown&&a.mouseupoutside&&a.mouseupoutside(this.mouse),a.__isDown=!1}},t.InteractionManager.prototype.hitTest=function(e,i){var s=i.global;if(!e.worldVisible)return!1;var a=e instanceof t.Sprite,n=e.worldTransform,r=n.a,o=n.b,h=n.tx,l=n.c,d=n.d,u=n.ty,c=1/(r*d+o*-l),m=d*c*s.x+-o*c*s.y+(u*o-h*d)*c,g=r*c*s.y+-l*c*s.x+(-u*r+h*l)*c;if(i.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(m,g)?(i.target=e,!0):!1;if(a){var p,f=e.texture.frame.width,v=e.texture.frame.height,y=-f*e.anchor.x;if(m>y&&y+f>m&&(p=-v*e.anchor.y,g>p&&p+v>g))return i.target=e,!0}for(var x=e.children.length,w=0;x>w;w++){var b=e.children[w],T=this.hitTest(b,i);if(T)return i.target=e,!0}return!1},t.InteractionManager.prototype.onTouchMove=function(e){var t,i=this.interactionDOMElement.getBoundingClientRect(),s=e.changedTouches,a=0;for(a=0;a<s.length;a++){var n=s[a];t=this.touchs[n.identifier],t.originalEvent=e||window.event,t.global.x=(n.clientX-i.left)*(this.target.width/i.width),t.global.y=(n.clientY-i.top)*(this.target.height/i.height),navigator.isCocoonJS&&(t.global.x=n.clientX,t.global.y=n.clientY);for(var r=0;r<this.interactiveItems.length;r++){var o=this.interactiveItems[r];o.touchmove&&o.__touchData[n.identifier]&&o.touchmove(t)}}},t.InteractionManager.prototype.onTouchStart=function(e){var i=this.interactionDOMElement.getBoundingClientRect();t.AUTO_PREVENT_DEFAULT&&e.preventDefault();for(var s=e.changedTouches,a=0;a<s.length;a++){var n=s[a],r=this.pool.pop();r||(r=new t.InteractionData),r.originalEvent=e||window.event,this.touchs[n.identifier]=r,r.global.x=(n.clientX-i.left)*(this.target.width/i.width),r.global.y=(n.clientY-i.top)*(this.target.height/i.height),navigator.isCocoonJS&&(r.global.x=n.clientX,r.global.y=n.clientY);for(var o=this.interactiveItems.length,h=0;o>h;h++){var l=this.interactiveItems[h];if((l.touchstart||l.tap)&&(l.__hit=this.hitTest(l,r),l.__hit&&(l.touchstart&&l.touchstart(r),l.__isDown=!0,l.__touchData=l.__touchData||{},l.__touchData[n.identifier]=r,!l.interactiveChildren)))break}}},t.InteractionManager.prototype.onTouchEnd=function(e){for(var t=this.interactionDOMElement.getBoundingClientRect(),i=e.changedTouches,s=0;s<i.length;s++){var a=i[s],n=this.touchs[a.identifier],r=!1;n.global.x=(a.clientX-t.left)*(this.target.width/t.width),n.global.y=(a.clientY-t.top)*(this.target.height/t.height),navigator.isCocoonJS&&(n.global.x=a.clientX,n.global.y=a.clientY);for(var o=this.interactiveItems.length,h=0;o>h;h++){var l=this.interactiveItems[h];l.__touchData&&l.__touchData[a.identifier]&&(l.__hit=this.hitTest(l,l.__touchData[a.identifier]),n.originalEvent=e||window.event,(l.touchend||l.tap)&&(l.__hit&&!r?(l.touchend&&l.touchend(n),l.__isDown&&l.tap&&l.tap(n),l.interactiveChildren||(r=!0)):l.__isDown&&l.touchendoutside&&l.touchendoutside(n),l.__isDown=!1),l.__touchData[a.identifier]=null)}this.pool.push(n),this.touchs[a.identifier]=null}},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(e){this.interactionManager.setTargetDomElement(e)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var i=0,s=["ms","moz","webkit","o"],n=0;n<s.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[s[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[n]+"CancelAnimationFrame"]||window[s[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),s=Math.max(0,16-(t-i)),a=window.setTimeout(function(){e(t+s)},s);return i=t+s,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,t.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function i(){var n=a.concat(e.call(arguments));s.apply(this instanceof i?this:t,n)}var s=this,a=e.call(arguments,1);if("function"!=typeof s)throw new TypeError;return i.prototype=function n(e){return e&&(n.prototype=e),this instanceof n?void 0:new n}(s.prototype),i}}()),t.AjaxRequest=function(){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new window.ActiveXObject(e[t])}catch(i){}},t.canUseNewCanvasBlendModes=function(){var e=document.createElement("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="#000",t.fillRect(0,0,1,1),t.globalCompositeOperation="multiply",t.fillStyle="#fff",t.fillRect(0,0,1,1),0===t.getImageData(0,0,1,1).data[0]},t.getNextPowerOfTwo=function(e){if(e>0&&0===(e&e-1))return e;for(var t=1;e>t;)t<<=1;return t},t.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,i){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},this.dispatchEvent=this.emit=function(t){if(e[t.type]&&e[t.type].length)for(var i=0,s=e[t.type].length;s>i;i++)e[t.type][i](t)},this.removeEventListener=this.off=function(t,i){var s=e[t].indexOf(i);-1!==s&&e[t].splice(s,1)},this.removeAllEventListeners=function(t){var i=e[t];i&&(i.length=0)}},t.autoDetectRenderer=function(e,i,s,a,n){e||(e=800),i||(i=600);var r=function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}();return r?new t.WebGLRenderer(e,i,s,a,n):new t.CanvasRenderer(e,i,s,a)},t.autoDetectRecommendedRenderer=function(e,i,s,a,n){e||(e=800),i||(i=600);var r=function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),o=/Android/i.test(navigator.userAgent);return r&&!o?new t.WebGLRenderer(e,i,s,a,n):new t.CanvasRenderer(e,i,s,a)},t.PolyK={},t.PolyK.Triangulate=function(e){var i=!0,s=e.length>>1;if(3>s)return[];for(var a=[],n=[],r=0;s>r;r++)n.push(r);r=0;for(var o=s;o>3;){var h=n[(r+0)%o],l=n[(r+1)%o],d=n[(r+2)%o],u=e[2*h],c=e[2*h+1],m=e[2*l],g=e[2*l+1],p=e[2*d],f=e[2*d+1],v=!1;if(t.PolyK._convex(u,c,m,g,p,f,i)){v=!0;for(var y=0;o>y;y++){var x=n[y];if(x!==h&&x!==l&&x!==d&&t.PolyK._PointInTriangle(e[2*x],e[2*x+1],u,c,m,g,p,f)){v=!1;break}}}if(v)a.push(h,l,d),n.splice((r+1)%o,1),o--,r=0;else if(r++>3*o){if(!i)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(a=[],n=[],r=0;s>r;r++)n.push(r);r=0,o=s,i=!1}}return a.push(n[0],n[1],n[2]),a},t.PolyK._PointInTriangle=function(e,t,i,s,a,n,r,o){var h=r-i,l=o-s,d=a-i,u=n-s,c=e-i,m=t-s,g=h*h+l*l,p=h*d+l*u,f=h*c+l*m,v=d*d+u*u,y=d*c+u*m,x=1/(g*v-p*p),w=(v*f-p*y)*x,b=(g*y-p*f)*x;return w>=0&&b>=0&&1>w+b},t.PolyK._convex=function(e,t,i,s,a,n,r){return(t-s)*(a-i)+(i-e)*(n-s)>=0===r},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,i){return t._CompileShader(e,i,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,i){return t._CompileShader(e,i,e.FRAGMENT_SHADER)},t._CompileShader=function(e,t,i){var s=t.join("\n"),a=e.createShader(i);return e.shaderSource(a,s),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(window.console.log(e.getShaderInfoLog(a)),null)},t.compileProgram=function(e,i,s){var a=t.CompileFragmentShader(e,s),n=t.CompileVertexShader(e,i),r=e.createProgram();return e.attachShader(r,n),e.attachShader(r,a),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),r},t.PixiShader=function(e){this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},t.PixiShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var s in this.uniforms)this.uniforms[s].uniformLocation=e.getUniformLocation(i,s);this.initUniforms(),this.program=i},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e,t=this.gl;for(var i in this.uniforms){e=this.uniforms[i];var s=e.type;"sampler2D"===s?(e._init=!1,null!==e.value&&this.initSampler2D(e)):"mat2"===s||"mat3"===s||"mat4"===s?(e.glMatrix=!0,e.glValueLength=1,"mat2"===s?e.glFunc=t.uniformMatrix2fv:"mat3"===s?e.glFunc=t.uniformMatrix3fv:"mat4"===s&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+s],e.glValueLength="2f"===s||"2i"===s?2:"3f"===s||"3i"===s?3:"4f"===s||"4i"===s?4:1)}},t.PixiShader.prototype.initSampler2D=function(e){if(e.value&&e.value.baseTexture&&e.value.baseTexture.hasLoaded){var t=this.gl;if(t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]),e.textureData){var i=e.textureData,s=i.magFilter?i.magFilter:t.LINEAR,a=i.minFilter?i.minFilter:t.LINEAR,n=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,r=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,o=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(n=t.REPEAT,r=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,l=i.height?i.height:2,d=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,o,h,l,d,o,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,o,t.RGBA,t.UNSIGNED_BYTE,e.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r)}t.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,i=this.gl;for(var s in this.uniforms)e=this.uniforms[s],1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(i,e.uniformLocation,e.transpose,e.value):e.glFunc.call(i,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(i,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),i.bindTexture(i.TEXTURE_2D,e.value.baseTexture._glTextures[i.id]||t.createWebGLTexture(e.value.baseTexture,i)),i.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],t.PixiFastShader=function(e){this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.uMatrix=e.getUniformLocation(i,"uMatrix"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(i,"aPositionCoord"),this.aScale=e.getAttribLocation(i,"aScale"),this.aRotation=e.getAttribLocation(i,"aRotation"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(){this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","uniform vec2 offsetVector;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]},t.StripShader.prototype.init=function(){var e=t.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.PrimitiveShader=function(e){this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.init=function(){var e=this.gl,i=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(i),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.tintColor=e.getUniformLocation(i,"tint"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(i,"translationMatrix"),this.alpha=e.getUniformLocation(i,"alpha"),this.program=i},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,i){var s=i.gl,a=i.projection,n=i.offset,r=i.shaderManager.primitiveShader;e._webGL[s.id]||(e._webGL[s.id]={points:[],indices:[],lastIndex:0,buffer:s.createBuffer(),indexBuffer:s.createBuffer()});var o=e._webGL[s.id];e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,o.lastIndex=0,o.points=[],o.indices=[]),t.WebGLGraphics.updateGraphics(e,s)),i.shaderManager.activatePrimitiveShader(),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.uniformMatrix3fv(r.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(r.projectionVector,a.x,-a.y),s.uniform2f(r.offsetVector,-n.x,-n.y),s.uniform3fv(r.tintColor,t.hex2rgb(e.tint)),s.uniform1f(r.alpha,e.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,o.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(r.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o.indexBuffer),s.drawElements(s.TRIANGLE_STRIP,o.indices.length,s.UNSIGNED_SHORT,0),i.shaderManager.deactivatePrimitiveShader()},t.WebGLGraphics.updateGraphics=function(e,i){for(var s=e._webGL[i.id],a=s.lastIndex;a<e.graphicsData.length;a++){var n=e.graphicsData[a];n.type===t.Graphics.POLY?(n.fill&&n.points.length>3&&t.WebGLGraphics.buildPoly(n,s),n.lineWidth>0&&t.WebGLGraphics.buildLine(n,s)):n.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(n,s):(n.type===t.Graphics.CIRC||n.type===t.Graphics.ELIP)&&t.WebGLGraphics.buildCircle(n,s)}s.lastIndex=e.graphicsData.length,s.glPoints=new Float32Array(s.points),i.bindBuffer(i.ARRAY_BUFFER,s.buffer),i.bufferData(i.ARRAY_BUFFER,s.glPoints,i.STATIC_DRAW),s.glIndicies=new Uint16Array(s.indices),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,s.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,s.glIndicies,i.STATIC_DRAW)},t.WebGLGraphics.buildRectangle=function(e,i){var s=e.points,a=s[0],n=s[1],r=s[2],o=s[3];if(e.fill){var h=t.hex2rgb(e.fillColor),l=e.fillAlpha,d=h[0]*l,u=h[1]*l,c=h[2]*l,m=i.points,g=i.indices,p=m.length/6;m.push(a,n),m.push(d,u,c,l),m.push(a+r,n),m.push(d,u,c,l),m.push(a,n+o),m.push(d,u,c,l),m.push(a+r,n+o),m.push(d,u,c,l),g.push(p,p,p+1,p+2,p+3,p+3)}if(e.lineWidth){var f=e.points;e.points=[a,n,a+r,n,a+r,n+o,a,n+o,a,n],t.WebGLGraphics.buildLine(e,i),e.points=f}},t.WebGLGraphics.buildCircle=function(e,i){var s=e.points,a=s[0],n=s[1],r=s[2],o=s[3],h=40,l=2*Math.PI/h,d=0;if(e.fill){var u=t.hex2rgb(e.fillColor),c=e.fillAlpha,m=u[0]*c,g=u[1]*c,p=u[2]*c,f=i.points,v=i.indices,y=f.length/6;for(v.push(y),d=0;h+1>d;d++)f.push(a,n,m,g,p,c),f.push(a+Math.sin(l*d)*r,n+Math.cos(l*d)*o,m,g,p,c),v.push(y++,y++);v.push(y-1)}if(e.lineWidth){var x=e.points;for(e.points=[],d=0;h+1>d;d++)e.points.push(a+Math.sin(l*d)*r,n+Math.cos(l*d)*o);t.WebGLGraphics.buildLine(e,i),e.points=x}},t.WebGLGraphics.buildLine=function(e,i){var s=0,a=e.points;if(0!==a.length){if(e.lineWidth%2)for(s=0;s<a.length;s++)a[s]+=.5;var n=new t.Point(a[0],a[1]),r=new t.Point(a[a.length-2],a[a.length-1]);if(n.x===r.x&&n.y===r.y){a.pop(),a.pop(),r=new t.Point(a[a.length-2],a[a.length-1]);var o=r.x+.5*(n.x-r.x),h=r.y+.5*(n.y-r.y);a.unshift(o,h),a.push(o,h)}var l,d,u,c,m,g,p,f,v,y,x,w,b,T,S,C,A,M,E,L,R,F,B,_=i.points,I=i.indices,P=a.length/2,D=a.length,O=_.length/6,k=e.lineWidth/2,G=t.hex2rgb(e.lineColor),U=e.lineAlpha,j=G[0]*U,N=G[1]*U,W=G[2]*U;for(u=a[0],c=a[1],m=a[2],g=a[3],v=-(c-g),y=u-m,B=Math.sqrt(v*v+y*y),v/=B,y/=B,v*=k,y*=k,_.push(u-v,c-y,j,N,W,U),_.push(u+v,c+y,j,N,W,U),s=1;P-1>s;s++)u=a[2*(s-1)],c=a[2*(s-1)+1],m=a[2*s],g=a[2*s+1],p=a[2*(s+1)],f=a[2*(s+1)+1],v=-(c-g),y=u-m,B=Math.sqrt(v*v+y*y),v/=B,y/=B,v*=k,y*=k,x=-(g-f),w=m-p,B=Math.sqrt(x*x+w*w),x/=B,w/=B,x*=k,w*=k,S=-y+c-(-y+g),C=-v+m-(-v+u),A=(-v+u)*(-y+g)-(-v+m)*(-y+c),M=-w+f-(-w+g),E=-x+m-(-x+p),L=(-x+p)*(-w+g)-(-x+m)*(-w+f),R=S*E-M*C,Math.abs(R)<.1?(R+=10.1,_.push(m-v,g-y,j,N,W,U),_.push(m+v,g+y,j,N,W,U)):(l=(C*L-E*A)/R,d=(M*A-S*L)/R,F=(l-m)*(l-m)+(d-g)+(d-g),F>19600?(b=v-x,T=y-w,B=Math.sqrt(b*b+T*T),b/=B,T/=B,b*=k,T*=k,_.push(m-b,g-T),_.push(j,N,W,U),_.push(m+b,g+T),_.push(j,N,W,U),_.push(m-b,g-T),_.push(j,N,W,U),D++):(_.push(l,d),_.push(j,N,W,U),_.push(m-(l-m),g-(d-g)),_.push(j,N,W,U)));for(u=a[2*(P-2)],c=a[2*(P-2)+1],m=a[2*(P-1)],g=a[2*(P-1)+1],v=-(c-g),y=u-m,B=Math.sqrt(v*v+y*y),v/=B,y/=B,v*=k,y*=k,_.push(m-v,g-y),_.push(j,N,W,U),_.push(m+v,g+y),_.push(j,N,W,U),I.push(O),s=0;D>s;s++)I.push(O++);I.push(O-1)}},t.WebGLGraphics.buildPoly=function(e,i){var s=e.points;if(!(s.length<6)){var a=i.points,n=i.indices,r=s.length/2,o=t.hex2rgb(e.fillColor),h=e.fillAlpha,l=o[0]*h,d=o[1]*h,u=o[2]*h,c=t.PolyK.Triangulate(s),m=a.length/6,g=0;for(g=0;g<c.length;g+=3)n.push(c[g]+m),n.push(c[g]+m),n.push(c[g+1]+m),n.push(c[g+2]+m),n.push(c[g+2]+m);for(g=0;r>g;g++)a.push(s[2*g],s[2*g+1],l,d,u,h)}},t.glContexts=[],t.WebGLRenderer=function(e,i,s,a,n){t.defaultRenderer||(t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.transparent=!!a,this.width=e||800,this.height=i||600,this.view=s||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!n,premultipliedAlpha:!!a,stencil:!0};try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(r){try{this.gl=this.view.getContext("webgl",this.options)}catch(o){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var h=this.gl;this.glContextId=h.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=h,t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[h.SRC_ALPHA,h.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[h.SRC_ALPHA,h.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA]),this.projection=new t.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new t.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new t.WebGLShaderManager(h),this.spriteBatch=new t.WebGLSpriteBatch(h),this.maskManager=new t.WebGLMaskManager(h),this.filterManager=new t.WebGLFilterManager(h,this.transparent),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.renderer=this,h.useProgram(this.shaderManager.defaultShader.program),h.disable(h.DEPTH_TEST),h.disable(h.CULL_FACE),h.enable(h.BLEND),h.colorMask(!0,!0,!0,this.transparent)},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(e.interactive&&e.interactionManager.removeEvents(),this.__stage=e),t.WebGLRenderer.updateTextures(),e.updateTransform(),e._interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)));var i=this.gl;i.viewport(0,0,this.width,this.height),i.bindFramebuffer(i.FRAMEBUFFER,null),this.transparent?i.clearColor(0,0,0,0):i.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),i.clear(i.COLOR_BUFFER_BIT),this.renderDisplayObject(e,this.projection),e.interactive?e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)):e._interactiveEventsAdded&&(e._interactiveEventsAdded=!1,e.interactionManager.setTarget(this))}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,t,i){this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=t,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,i),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.updateTextures=function(){var e=0;for(e=0;e<t.Texture.frameUpdates.length;e++)t.WebGLRenderer.updateTextureFrame(t.Texture.frameUpdates[e]);for(e=0;e<t.texturesToDestroy.length;e++)t.WebGLRenderer.destroyTexture(t.texturesToDestroy[e]);t.texturesToUpdate.length=0,t.texturesToDestroy.length=0,t.Texture.frameUpdates.length=0},t.WebGLRenderer.destroyTexture=function(e){for(var i=e._glTextures.length-1;i>=0;i--){var s=e._glTextures[i],a=t.glContexts[i];a&&s&&a.deleteTexture(s)}e._glTextures.length=0},t.WebGLRenderer.updateTextureFrame=function(e){e.updateFrame=!1,e._updateWebGLuvs()},t.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},t.createWebGLTexture=function(e,i){return e.hasLoaded&&(e._glTextures[i.id]=i.createTexture(),i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.bindTexture(i.TEXTURE_2D,null)),e._glTextures[i.id]},t.updateWebGLTexture=function(e,i){e._glTextures[i.id]&&(i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?i.LINEAR:i.NEAREST),e._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.bindTexture(i.TEXTURE_2D,null))},t.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(e){try{this.gl=this.view.getContext("webgl",this.options)}catch(i){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var s=this.gl;s.id=t.WebGLRenderer.glContextId++,this.shaderManager.setContext(s),this.spriteBatch.setContext(s),this.maskManager.setContext(s),this.filterManager.setContext(s),this.renderSession.gl=this.gl,s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var a in t.TextureCache){var n=t.TextureCache[a].baseTexture;n._glTextures=[]}this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},t.WebGLRenderer.glContextId=0,t.WebGLMaskManager=function(e){this.maskStack=[],this.maskPosition=0,this.setContext(e)},t.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},t.WebGLMaskManager.prototype.pushMask=function(e,i){var s=this.gl;0===this.maskStack.length&&(s.enable(s.STENCIL_TEST),s.stencilFunc(s.ALWAYS,1,1)),this.maskStack.push(e),s.colorMask(!1,!1,!1,!1),s.stencilOp(s.KEEP,s.KEEP,s.INCR),t.WebGLGraphics.renderGraphics(e,i),s.colorMask(!0,!0,!0,!0),s.stencilFunc(s.NOTEQUAL,0,this.maskStack.length),s.stencilOp(s.KEEP,s.KEEP,s.KEEP)},t.WebGLMaskManager.prototype.popMask=function(e){var i=this.gl,s=this.maskStack.pop();s&&(i.colorMask(!1,!1,!1,!1),i.stencilOp(i.KEEP,i.KEEP,i.DECR),t.WebGLGraphics.renderGraphics(s,e),i.colorMask(!0,!0,!0,!0),i.stencilFunc(i.NOTEQUAL,0,this.maskStack.length),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)),0===this.maskStack.length&&i.disable(i.STENCIL_TEST)},t.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null
},t.WebGLShaderManager=function(e){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)},t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.activateShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<e.length;t++){var i=e[t];this.tempAttribState[i]=!0}var s=this.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?s.enableVertexAttribArray(t):s.disableVertexAttribArray(t))},t.WebGLShaderManager.prototype.activateShader=function(e){this.currentShader=e,this.gl.useProgram(e.program),this.setAttribs(e.attributes)},t.WebGLShaderManager.prototype.activatePrimitiveShader=function(){var e=this.gl;e.useProgram(this.primitiveShader.program),this.setAttribs(this.primitiveShader.attributes)},t.WebGLShaderManager.prototype.deactivatePrimitiveShader=function(){var e=this.gl;e.useProgram(this.defaultShader.program),this.setAttribs(this.defaultShader.attributes)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(e){this.vertSize=6,this.size=2e3;var t=4*this.size*this.vertSize,i=6*this.size;this.vertices=new Float32Array(t),this.indices=new Uint16Array(i),this.lastIndexCount=0;for(var s=0,a=0;i>s;s+=6,a+=4)this.indices[s+0]=a+0,this.indices[s+1]=a+1,this.indices[s+2]=a+2,this.indices[s+3]=a+0,this.indices[s+4]=a+2,this.indices[s+5]=a+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(e)},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},t.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(e){var t=e.texture;(t.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=t.baseTexture),e.blendMode!==this.currentBlendMode&&this.setBlendMode(e.blendMode);var i=e._uvs||e.texture._uvs;if(i){var s,a,n,r,o=e.worldAlpha,h=e.tint,l=this.vertices,d=e.anchor.x,u=e.anchor.y;if(e.texture.trim){var c=e.texture.trim;a=c.x-d*c.width,s=a+t.frame.width,r=c.y-u*c.height,n=r+t.frame.height}else s=t.frame.width*(1-d),a=t.frame.width*-d,n=t.frame.height*(1-u),r=t.frame.height*-u;var m=4*this.currentBatchSize*this.vertSize,g=e.worldTransform,p=g.a,f=g.c,v=g.b,y=g.d,x=g.tx,w=g.ty;l[m++]=p*a+v*r+x,l[m++]=y*r+f*a+w,l[m++]=i.x0,l[m++]=i.y0,l[m++]=o,l[m++]=h,l[m++]=p*s+v*r+x,l[m++]=y*r+f*s+w,l[m++]=i.x1,l[m++]=i.y1,l[m++]=o,l[m++]=h,l[m++]=p*s+v*n+x,l[m++]=y*n+f*s+w,l[m++]=i.x2,l[m++]=i.y2,l[m++]=o,l[m++]=h,l[m++]=p*a+v*n+x,l[m++]=y*n+f*a+w,l[m++]=i.x3,l[m++]=i.y3,l[m++]=o,l[m++]=h,this.currentBatchSize++}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var i=e.tilingTexture;(i.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=i.baseTexture),e.blendMode!==this.currentBlendMode&&this.setBlendMode(e.blendMode),e._uvs||(e._uvs=new t.TextureUvs);var s=e._uvs;e.tilePosition.x%=i.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=i.baseTexture.height*e.tileScaleOffset.y;var a=e.tilePosition.x/(i.baseTexture.width*e.tileScaleOffset.x),n=e.tilePosition.y/(i.baseTexture.height*e.tileScaleOffset.y),r=e.width/i.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),o=e.height/i.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);s.x0=0-a,s.y0=0-n,s.x1=1*r-a,s.y1=0-n,s.x2=1*r-a,s.y2=1*o-n,s.x3=0-a,s.y3=1*o-n;var h=e.worldAlpha,l=e.tint,d=this.vertices,u=e.width,c=e.height,m=e.anchor.x,g=e.anchor.y,p=u*(1-m),f=u*-m,v=c*(1-g),y=c*-g,x=4*this.currentBatchSize*this.vertSize,w=e.worldTransform,b=w.a,T=w.c,S=w.b,C=w.d,A=w.tx,M=w.ty;d[x++]=b*f+S*y+A,d[x++]=C*y+T*f+M,d[x++]=s.x0,d[x++]=s.y0,d[x++]=h,d[x++]=l,d[x++]=b*p+S*y+A,d[x++]=C*y+T*p+M,d[x++]=s.x1,d[x++]=s.y1,d[x++]=h,d[x++]=l,d[x++]=b*p+S*v+A,d[x++]=C*v+T*p+M,d[x++]=s.x2,d[x++]=s.y2,d[x++]=h,d[x++]=l,d[x++]=b*f+S*v+A,d[x++]=C*v+T*f+M,d[x++]=s.x3,d[x++]=s.y3,d[x++]=h,d[x++]=l,this.currentBatchSize++},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;if(e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]||t.createWebGLTexture(this.currentBaseTexture,e)),this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var i=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,i)}e.drawElements(e.TRIANGLES,6*this.currentBatchSize,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,i.x,i.y);var s=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,s,0),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,s,8),e.vertexAttribPointer(this.shader.colorAttribute,2,e.FLOAT,!1,s,16),this.currentBlendMode!==t.blendModes.NORMAL&&this.setBlendMode(t.blendModes.NORMAL)},t.WebGLSpriteBatch.prototype.setBlendMode=function(e){this.flush(),this.currentBlendMode=e;var i=t.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(i[0],i[1])},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var t=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new Float32Array(t),this.indices=new Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var s=0,a=0;i>s;s+=6,a+=4)this.indices[s+0]=a+0,this.indices[s+1]=a+1,this.indices[s+2]=a+2,this.indices[s+3]=a+0,this.indices[s+4]=a+2,this.indices[s+5]=a+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},t.WebGLFastSpriteBatch.prototype.begin=function(e,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=e.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(e){var t=e.children,i=t[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.currentBlendMode&&this.setBlendMode(i.blendMode);for(var s=0,a=t.length;a>s;s++)this.renderSprite(t[s]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(e){if(e.visible&&(e.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=e.texture.baseTexture,e.texture._uvs))){var t,i,s,a,n,r,o,h,l=this.vertices;if(t=e.texture._uvs,i=e.texture.frame.width,s=e.texture.frame.height,e.texture.trim){var d=e.texture.trim;n=d.x-e.anchor.x*d.width,a=n+e.texture.frame.width,o=d.y-e.anchor.y*d.height,r=o+e.texture.frame.height}else a=e.texture.frame.width*(1-e.anchor.x),n=e.texture.frame.width*-e.anchor.x,r=e.texture.frame.height*(1-e.anchor.y),o=e.texture.frame.height*-e.anchor.y;h=4*this.currentBatchSize*this.vertSize,l[h++]=n,l[h++]=o,l[h++]=e.position.x,l[h++]=e.position.y,l[h++]=e.scale.x,l[h++]=e.scale.y,l[h++]=e.rotation,l[h++]=t.x0,l[h++]=t.y1,l[h++]=e.alpha,l[h++]=a,l[h++]=o,l[h++]=e.position.x,l[h++]=e.position.y,l[h++]=e.scale.x,l[h++]=e.scale.y,l[h++]=e.rotation,l[h++]=t.x1,l[h++]=t.y1,l[h++]=e.alpha,l[h++]=a,l[h++]=r,l[h++]=e.position.x,l[h++]=e.position.y,l[h++]=e.scale.x,l[h++]=e.scale.y,l[h++]=e.rotation,l[h++]=t.x2,l[h++]=t.y2,l[h++]=e.alpha,l[h++]=n,l[h++]=r,l[h++]=e.position.x,l[h++]=e.position.y,l[h++]=e.scale.x,l[h++]=e.scale.y,l[h++]=e.rotation,l[h++]=t.x3,l[h++]=t.y3,l[h++]=e.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;if(this.currentBaseTexture._glTextures[e.id]||t.createWebGLTexture(this.currentBaseTexture,e),e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]),this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var i=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,i)}e.drawElements(e.TRIANGLES,6*this.currentBatchSize,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,i.x,i.y),e.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var s=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,s,0),e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,!1,s,8),e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,!1,s,16),e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,!1,s,24),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,s,28),e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,!1,s,36),this.currentBlendMode!==t.blendModes.NORMAL&&this.setBlendMode(t.blendModes.NORMAL)},t.WebGLFastSpriteBatch.prototype.setBlendMode=function(e){this.flush(),this.currentBlendMode=e;var i=t.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(i[0],i[1])},t.WebGLFilterManager=function(e,t){this.transparent=t,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(e)},t.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(e,t){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(e){var i=this.gl,s=this.renderSession.projection,a=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var n=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var r=this.texturePool.pop();r?r.resize(this.width,this.height):r=new t.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,r.texture);var o=e._filterArea,h=n.padding;o.x-=h,o.y-=h,o.width+=2*h,o.height+=2*h,o.x<0&&(o.x=0),o.width>this.width&&(o.width=this.width),o.y<0&&(o.y=0),o.height>this.height&&(o.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,r.frameBuffer),i.viewport(0,0,o.width,o.height),s.x=o.width/2,s.y=-o.height/2,a.x=-o.x,a.y=-o.y,i.uniform2f(this.defaultShader.projectionVector,o.width/2,-o.height/2),i.uniform2f(this.defaultShader.offsetVector,-o.x,-o.y),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),e._glFilterTexture=r},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,i=this.filterStack.pop(),s=i._filterArea,a=i._glFilterTexture,n=this.renderSession.projection,r=this.renderSession.offset;if(i.filterPasses.length>1){e.viewport(0,0,s.width,s.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=s.height,this.vertexArray[2]=s.width,this.vertexArray[3]=s.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=s.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=s.width/this.width,this.uvArray[5]=s.height/this.height,this.uvArray[6]=s.width/this.width,this.uvArray[7]=s.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var o=a,h=this.texturePool.pop();h||(h=new t.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,h.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var l=0;l<i.filterPasses.length-1;l++){var d=i.filterPasses[l];e.bindFramebuffer(e.FRAMEBUFFER,h.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o.texture),this.applyFilterPass(d,s,s.width,s.height);var u=o;o=h,h=u}e.enable(e.BLEND),a=o,this.texturePool.push(h)}var c=i.filterPasses[i.filterPasses.length-1];this.offsetX-=s.x,this.offsetY-=s.y;var m=this.width,g=this.height,p=0,f=0,v=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];s=y._filterArea,m=s.width,g=s.height,p=s.x,f=s.y,v=y._glFilterTexture.frameBuffer}n.x=m/2,n.y=-g/2,r.x=p,r.y=f,s=i._filterArea;var x=s.x-p,w=s.y-f;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=x,this.vertexArray[1]=w+s.height,this.vertexArray[2]=x+s.width,this.vertexArray[3]=w+s.height,this.vertexArray[4]=x,this.vertexArray[5]=w,this.vertexArray[6]=x+s.width,this.vertexArray[7]=w,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=s.width/this.width,this.uvArray[5]=s.height/this.height,this.uvArray[6]=s.width/this.width,this.uvArray[7]=s.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,m,g),e.bindFramebuffer(e.FRAMEBUFFER,v),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a.texture),this.applyFilterPass(c,s,m,g),e.useProgram(this.defaultShader.program),e.uniform2f(this.defaultShader.projectionVector,m/2,-g/2),e.uniform2f(this.defaultShader.offsetVector,-p,-f),this.texturePool.push(a),i._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,i,s,a){var n=this.gl,r=e.shaders[n.id];r||(r=new t.PixiShader(n),r.fragmentSrc=e.fragmentSrc,r.uniforms=e.uniforms,r.init(),e.shaders[n.id]=r),n.useProgram(r.program),n.uniform2f(r.projectionVector,s/2,-a/2),n.uniform2f(r.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),r.syncUniforms(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(r.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.vertexAttribPointer(r.aTextureCoord,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.vertexAttribPointer(r.colorAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var e=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool.destroy();this.texturePool=null,e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.uvBuffer),e.deleteBuffer(this.colorBuffer),e.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,i,s,a){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),a=a||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(i,s)},t.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(e,t){if(this.width!==e||this.height!==t){this.width=e,this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t)}},t.FilterTexture.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.pushMask=function(e,i){i.save();var s=e.alpha,a=e.worldTransform;i.setTransform(a.a,a.c,a.b,a.d,a.tx,a.ty),t.CanvasGraphics.renderGraphicsMask(e,i),i.clip(),e.worldAlpha=s},t.CanvasMaskManager.prototype.popMask=function(e){e.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,i){var s=e.texture;i=t.CanvasTinter.roundColor(i);var a="#"+("00000"+(0|i).toString(16)).substr(-6);if(s.tintCache=s.tintCache||{},s.tintCache[a])return s.tintCache[a];var n=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(s,i,n),t.CanvasTinter.convertTintToImage){var r=new Image;r.src=n.toDataURL(),s.tintCache[a]=r}else s.tintCache[a]=n,t.CanvasTinter.canvas=null;return n},t.CanvasTinter.tintWithMultiply=function(e,t,i){var s=i.getContext("2d"),a=e.frame;i.width=a.width,i.height=a.height,s.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),s.fillRect(0,0,a.width,a.height),s.globalCompositeOperation="multiply",s.drawImage(e.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height),s.globalCompositeOperation="destination-atop",s.drawImage(e.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height)},t.CanvasTinter.tintWithOverlay=function(e,t,i){var s=i.getContext("2d"),a=e.frame;i.width=a.width,i.height=a.height,s.globalCompositeOperation="copy",s.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),s.fillRect(0,0,a.width,a.height),s.globalCompositeOperation="destination-atop",s.drawImage(e.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height)},t.CanvasTinter.tintWithPerPixel=function(e,i,s){var a=s.getContext("2d"),n=e.frame;s.width=n.width,s.height=n.height,a.globalCompositeOperation="copy",a.drawImage(e.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);for(var r=t.hex2rgb(i),o=r[0],h=r[1],l=r[2],d=a.getImageData(0,0,n.width,n.height),u=d.data,c=0;c<u.length;c+=4)u[c+0]*=o,u[c+1]*=h,u[c+2]*=l;a.putImageData(d,0,0)},t.CanvasTinter.roundColor=function(e){var i=t.CanvasTinter.cacheStepsPerColorChannel,s=t.hex2rgb(e);return s[0]=Math.min(255,s[0]/i*i),s[1]=Math.min(255,s[1]/i*i),s[2]=Math.min(255,s[2]/i*i),t.rgb2hex(s)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,i,s,a){t.defaultRenderer=t.defaultRenderer||this,this.type=t.CANVAS_RENDERER,this.clearBeforeRender=!0,this.roundPixels=!1,this.transparent=!!a,t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over")),this.width=e||800,this.height=i||600,this.view=s||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){t.texturesToUpdate.length=0,t.texturesToDestroy.length=0,e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),t.Texture.frameUpdates.length>0&&(t.Texture.frameUpdates.length=0)},t.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},t.CanvasRenderer.prototype.renderDisplayObject=function(e,t){this.renderSession.context=t||this.context,e._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,i=e.verticies,s=i.length/2;this.count++,t.beginPath();for(var a=1;s-2>a;a++){var n=2*a,r=i[n],o=i[n+2],h=i[n+4],l=i[n+1],d=i[n+3],u=i[n+5];t.moveTo(r,l),t.lineTo(o,d),t.lineTo(h,u)}t.fillStyle="#FF0000",t.fill(),t.closePath()},t.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,i=e.verticies,s=e.uvs,a=i.length/2;this.count++;for(var n=1;a-2>n;n++){var r=2*n,o=i[r],h=i[r+2],l=i[r+4],d=i[r+1],u=i[r+3],c=i[r+5],m=s[r]*e.texture.width,g=s[r+2]*e.texture.width,p=s[r+4]*e.texture.width,f=s[r+1]*e.texture.height,v=s[r+3]*e.texture.height,y=s[r+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(o,d),t.lineTo(h,u),t.lineTo(l,c),t.closePath(),t.clip();var x=m*v+f*p+g*y-v*p-f*g-m*y,w=o*v+f*l+h*y-v*l-f*h-o*y,b=m*h+o*p+g*l-h*p-o*g-m*l,T=m*v*l+f*h*p+o*g*y-o*v*p-f*g*l-m*h*y,S=d*v+f*c+u*y-v*c-f*u-d*y,C=m*u+d*p+g*c-u*p-d*g-m*c,A=m*v*c+f*u*p+d*g*y-d*v*p-f*g*c-m*u*y;t.transform(w/x,S/x,b/x,C/x,T/x,A/x),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},t.CanvasBuffer=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t},t.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,i){for(var s=e.worldAlpha,a="",n=0;n<e.graphicsData.length;n++){var r=e.graphicsData[n],o=r.points;if(i.strokeStyle=a="#"+("00000"+(0|r.lineColor).toString(16)).substr(-6),i.lineWidth=r.lineWidth,r.type===t.Graphics.POLY){i.beginPath(),i.moveTo(o[0],o[1]);for(var h=1;h<o.length/2;h++)i.lineTo(o[2*h],o[2*h+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}else if(r.type===t.Graphics.RECT)(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fillRect(o[0],o[1],o[2],o[3])),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.strokeRect(o[0],o[1],o[2],o[3]));else if(r.type===t.Graphics.CIRC)i.beginPath(),i.arc(o[0],o[1],o[2],0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke());else if(r.type===t.Graphics.ELIP){var l=r.points,d=2*l[2],u=2*l[3],c=l[0]-d/2,m=l[1]-u/2;i.beginPath();var g=.5522848,p=d/2*g,f=u/2*g,v=c+d,y=m+u,x=c+d/2,w=m+u/2;i.moveTo(c,w),i.bezierCurveTo(c,w-f,x-p,m,x,m),i.bezierCurveTo(x+p,m,v,w-f,v,w),i.bezierCurveTo(v,w+f,x+p,y,x,y),i.bezierCurveTo(x-p,y,c,w+f,c,w),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,i){var s=e.graphicsData.length;if(0!==s){s>1&&(s=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var a=0;1>a;a++){var n=e.graphicsData[a],r=n.points;if(n.type===t.Graphics.POLY){i.beginPath(),i.moveTo(r[0],r[1]);for(var o=1;o<r.length/2;o++)i.lineTo(r[2*o],r[2*o+1]);r[0]===r[r.length-2]&&r[1]===r[r.length-1]&&i.closePath()}else if(n.type===t.Graphics.RECT)i.beginPath(),i.rect(r[0],r[1],r[2],r[3]),i.closePath();else if(n.type===t.Graphics.CIRC)i.beginPath(),i.arc(r[0],r[1],r[2],0,2*Math.PI),i.closePath();else if(n.type===t.Graphics.ELIP){var h=n.points,l=2*h[2],d=2*h[3],u=h[0]-l/2,c=h[1]-d/2;i.beginPath();var m=.5522848,g=l/2*m,p=d/2*m,f=u+l,v=c+d,y=u+l/2,x=c+d/2;i.moveTo(u,x),i.bezierCurveTo(u,x-p,y-g,c,y,c),i.bezierCurveTo(y+g,c,f,x-p,f,x),i.bezierCurveTo(f,x+p,y+g,v,y,v),i.bezierCurveTo(y-g,v,u,x+p,u,x),i.closePath()}}}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,i,s){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:s,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY},this.graphicsData.push(this.currentPath),this},t.Graphics.prototype.moveTo=function(e,i){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY},this.currentPath.points.push(e,i),this.graphicsData.push(this.currentPath),this},t.Graphics.prototype.lineTo=function(e,t){return this.currentPath.points.push(e,t),this.dirty=!0,this},t.Graphics.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=arguments.length<2?1:t,this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,i,s,a){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,i,s,a],type:t.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.drawCircle=function(e,i,s){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,i,s,s],type:t.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.drawEllipse=function(e,i,s,a){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,i,s,a],type:t.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},t.Graphics.prototype.generateTexture=function(){var e=this.getBounds(),i=new t.CanvasBuffer(e.width,e.height),s=t.Texture.fromCanvas(i.canvas);
return i.context.translate(-e.x,-e.y),t.CanvasGraphics.renderGraphics(this,i.context),s},t.Graphics.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),t.updateWebGLTexture(this._cachedSprite.texture.baseTexture,e.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),this._mask&&e.maskManager.pushMask(this.mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var i=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(i[0],i[1])}if(t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var s=0,a=this.children.length;a>s;s++)this.children[s]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var i=e.context,s=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),i.setTransform(s.a,s.c,s.b,s.d,s.tx,s.ty),t.CanvasGraphics.renderGraphics(this,i);for(var a=0,n=this.children.length;n>a;a++)this.children[a]._renderCanvas(e)}},t.Graphics.prototype.getBounds=function(e){this.bounds||this.updateBounds();var t=this.bounds.x,i=this.bounds.width+this.bounds.x,s=this.bounds.y,a=this.bounds.height+this.bounds.y,n=e||this.worldTransform,r=n.a,o=n.c,h=n.b,l=n.d,d=n.tx,u=n.ty,c=r*i+h*a+d,m=l*a+o*i+u,g=r*t+h*a+d,p=l*a+o*t+u,f=r*t+h*s+d,v=l*s+o*t+u,y=r*i+h*s+d,x=l*s+o*i+u,w=c,b=m,T=c,S=m;T=T>g?g:T,T=T>f?f:T,T=T>y?y:T,S=S>p?p:S,S=S>v?v:S,S=S>x?x:S,w=g>w?g:w,w=f>w?f:w,w=y>w?y:w,b=p>b?p:b,b=v>b?v:b,b=x>b?x:b;var C=this._bounds;return C.x=T,C.width=w-T,C.y=S,C.height=b-S,C},t.Graphics.prototype.updateBounds=function(){for(var e,i,s,a,n,r=1/0,o=-1/0,h=1/0,l=-1/0,d=0;d<this.graphicsData.length;d++){var u=this.graphicsData[d],c=u.type,m=u.lineWidth;if(e=u.points,c===t.Graphics.RECT)i=e[0]-m/2,s=e[1]-m/2,a=e[2]+m,n=e[3]+m,r=r>i?i:r,o=i+a>o?i+a:o,h=h>s?i:h,l=s+n>l?s+n:l;else if(c===t.Graphics.CIRC||c===t.Graphics.ELIP)i=e[0],s=e[1],a=e[2]+m/2,n=e[3]+m/2,r=r>i-a?i-a:r,o=i+a>o?i+a:o,h=h>s-n?s-n:h,l=s+n>l?s+n:l;else for(var g=0;g<e.length;g+=2)i=e[g],s=e[g+1],r=r>i-m?i-m:r,o=i+m>o?i+m:o,h=h>s-m?s-m:h,l=s+m>l?s+m:l}var p=this.boundsPadding;this.bounds=new t.Rectangle(r-p,h-p,o-r+2*p,l-h+2*p)},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var i=new t.CanvasBuffer(e.width,e.height),s=t.Texture.fromCanvas(i.canvas);this._cachedSprite=new t.Sprite(s),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Strip=function(e,i,s){t.Sprite.call(this,e),this.width=i,this.height=s,this.texture=e,this.blendMode=t.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(a){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},t.Strip.prototype=Object.create(t.Sprite.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Rope=function(e,i){t.Strip.call(this,e),this.points=i;try{this.verticies=new Float32Array(4*i.length),this.uvs=new Float32Array(4*i.length),this.colors=new Float32Array(2*i.length),this.indices=new Uint16Array(2*i.length)}catch(s){this.verticies=new Array(4*i.length),this.uvs=new Array(4*i.length),this.colors=new Array(2*i.length),this.indices=new Array(2*i.length)}this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,i=e[0],s=this.indices,a=this.colors;this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,a[0]=1,a[1]=1,s[0]=0,s[1]=1;for(var n,r,o,h=e.length,l=1;h>l;l++)n=e[l],r=4*l,o=l/(h-1),l%2?(t[r]=o,t[r+1]=0,t[r+2]=o,t[r+3]=1):(t[r]=o,t[r+1]=0,t[r+2]=o,t[r+3]=1),r=2*l,a[r]=1,a[r+1]=1,r=2*l,s[r]=r,s[r+1]=r+1,i=n}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var i,s=e[0],a={x:0,y:0};this.count-=.2;var n=this.verticies;n[0]=s.x+a.x,n[1]=s.y+a.y,n[2]=s.x-a.x,n[3]=s.y-a.y;for(var r,o,h,l,d,u=e.length,c=1;u>c;c++)r=e[c],o=4*c,i=c<e.length-1?e[c+1]:r,a.y=-(i.x-s.x),a.x=i.y-s.y,h=10*(1-c/(u-1)),h>1&&(h=1),l=Math.sqrt(a.x*a.x+a.y*a.y),d=this.texture.height/2,a.x/=l,a.y/=l,a.x*=d,a.y*=d,n[o]=r.x+a.x,n[o+1]=r.y+a.y,n[o+2]=r.x-a.x,n[o+3]=r.y-a.y,s=r;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},t.TilingSprite=function(e,i,s){t.Sprite.call(this,e),this.width=i||100,this.height=s||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),t.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.TilingSprite.prototype.setTexture=function(e){this.texture!==e&&(this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var i,s;for(this.mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this.filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.updateWebGLTexture(this.tilingTexture.baseTexture,e.gl),this.tilingTexture.needsUpdate=!1)):e.spriteBatch.renderTilingSprite(this),i=0,s=this.children.length;s>i;i++)this.children[i]._renderWebGL(e);e.spriteBatch.stop(),this.filters&&e.filterManager.popFilter(),this.mask&&e.maskManager.popMask(e),e.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){var i=e.context;this._mask&&e.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha;var s=this.worldTransform;if(i.setTransform(s.a,s.c,s.b,s.d,s.tx,s.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,i.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),i.beginPath();var a=this.tilePosition,n=this.tileScale;a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,i.scale(n.x,n.y),i.translate(a.x,a.y),i.fillStyle=this.__tilePattern,i.fillRect(-a.x+this.anchor.x*-this._width,-a.y+this.anchor.y*-this._height,this._width/n.x,this._height/n.y),i.scale(1/n.x,1/n.y),i.translate(-a.x,-a.y),i.closePath(),this._mask&&e.maskManager.popMask(e.context)}},t.TilingSprite.prototype.getBounds=function(){var e=this._width,t=this._height,i=e*(1-this.anchor.x),s=e*-this.anchor.x,a=t*(1-this.anchor.y),n=t*-this.anchor.y,r=this.worldTransform,o=r.a,h=r.c,l=r.b,d=r.d,u=r.tx,c=r.ty,m=o*s+l*n+u,g=d*n+h*s+c,p=o*i+l*n+u,f=d*n+h*i+c,v=o*i+l*a+u,y=d*a+h*i+c,x=o*s+l*a+u,w=d*a+h*s+c,b=-1/0,T=-1/0,S=1/0,C=1/0;S=S>m?m:S,S=S>p?p:S,S=S>v?v:S,S=S>x?x:S,C=C>g?g:C,C=C>f?f:C,C=C>y?y:C,C=C>w?w:C,b=m>b?m:b,b=p>b?p:b,b=v>b?v:b,b=x>b?x:b,T=g>T?g:T,T=f>T?f:T,T=y>T?y:T,T=w>T?w:T;var A=this._bounds;return A.x=S,A.width=b-S,A.y=C,A.height=T-C,this._currentBounds=A,A},t.TilingSprite.prototype.generateTilingTexture=function(e){var i=this.texture;if(i.baseTexture.hasLoaded){var s,a,n=i.baseTexture,r=i.frame,o=r.width!==n.width||r.height!==n.height,h=!1;if(e?(s=t.getNextPowerOfTwo(r.width),a=t.getNextPowerOfTwo(r.height),r.width!==s&&r.height!==a&&(h=!0)):o&&(s=r.width,a=r.height,h=!0),h){var l;this.tilingTexture&&this.tilingTexture.isTiling?(l=this.tilingTexture.canvasBuffer,l.resize(s,a),this.tilingTexture.baseTexture.width=s,this.tilingTexture.baseTexture.height=a,this.tilingTexture.needsUpdate=!0):(l=new t.CanvasBuffer(s,a),this.tilingTexture=t.Texture.fromCanvas(l.canvas),this.tilingTexture.canvasBuffer=l,this.tilingTexture.isTiling=!0),l.context.drawImage(i.baseTexture.source,r.x,r.y,r.width,r.height,0,0,s,a),this.tileScaleOffset.x=r.width/s,this.tileScaleOffset.y=r.height/a}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i;this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}};var o={};o.BoneData=function(e,t){this.name=e,this.parent=t},o.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},o.SlotData=function(e,t){this.name=e,this.boneData=t},o.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},o.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},o.Bone.yDown=!1,o.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var i=this.parent;null!=i?(this.worldX=this.x*i.m00+this.y*i.m01+i.worldX,this.worldY=this.x*i.m10+this.y*i.m11+i.worldY,this.worldScaleX=i.worldScaleX*this.scaleX,this.worldScaleY=i.worldScaleY*this.scaleY,this.worldRotation=i.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var s=this.worldRotation*Math.PI/180,a=Math.cos(s),n=Math.sin(s);this.m00=a*this.worldScaleX,this.m10=n*this.worldScaleX,this.m01=-n*this.worldScaleY,this.m11=a*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),o.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},o.Slot=function(e,t,i){this.data=e,this.skeleton=t,this.bone=i,this.setToSetupPose()},o.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var t=this.skeleton.data.slots,i=0,s=t.length;s>i;i++)if(t[i]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(i,e.attachmentName):null);break}}},o.Skin=function(e){this.name=e,this.attachments={}},o.Skin.prototype={addAttachment:function(e,t,i){this.attachments[e+":"+t]=i},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var i in t.attachments){var s=i.indexOf(":"),a=parseInt(i.substring(0,s),10),n=i.substring(s+1),r=e.slots[a];if(r.attachment&&r.attachment.name==n){var o=this.getAttachment(a,n);o&&r.setAttachment(o)}}}},o.Animation=function(e,t,i){this.name=e,this.timelines=t,this.duration=i},o.Animation.prototype={apply:function(e,t,i){i&&this.duration&&(t%=this.duration);for(var s=this.timelines,a=0,n=s.length;n>a;a++)s[a].apply(e,t,1)},mix:function(e,t,i,s){i&&this.duration&&(t%=this.duration);for(var a=this.timelines,n=0,r=a.length;r>n;n++)a[n].apply(e,t,s)}},o.binarySearch=function(e,t,i){var s=0,a=Math.floor(e.length/i)-2;if(!a)return i;for(var n=a>>>1;;){if(e[(n+1)*i]<=t?s=n+1:a=n,s==a)return(s+1)*i;n=s+a>>>1}},o.linearSearch=function(e,t,i){for(var s=0,a=e.length-i;a>=s;s+=i)if(e[s]>t)return s;return-1},o.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},o.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,t,i,s,a){var n=.1,r=n*n,o=r*n,h=3*n,l=3*r,d=6*r,u=6*o,c=2*-t+s,m=2*-i+a,g=3*(t-s)+1,p=3*(i-a)+1,f=6*e,v=this.curves;v[f]=t*h+c*l+g*o,v[f+1]=i*h+m*l+p*o,v[f+2]=c*d+g*u,v[f+3]=m*d+p*u,v[f+4]=g*u,v[f+5]=p*u},getCurvePercent:function(e,t){t=0>t?0:t>1?1:t;var i=6*e,s=this.curves,a=s[i];if(!a)return t;if(-1==a)return 0;for(var n=s[i+1],r=s[i+2],o=s[i+3],h=s[i+4],l=s[i+5],d=a,u=n,c=8;;){if(d>=t){var m=d-a,g=u-n;return g+(u-g)*(t-m)/(d-m)}if(!c)break;c--,a+=r,n+=o,r+=h,o+=l,d+=a,u+=n}return u+(1-u)*(t-d)/(1-d)}},o.RotateTimeline=function(e){this.curves=new o.Curves(e),this.frames=[],this.frames.length=2*e},o.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,i){e*=2,this.frames[e]=t,this.frames[e+1]=i},apply:function(e,t,i){var s,a=this.frames;if(!(t<a[0])){var n=e.bones[this.boneIndex];if(t>=a[a.length-2]){for(s=n.data.rotation+a[a.length-1]-n.rotation;s>180;)s-=360;for(;-180>s;)s+=360;return void(n.rotation+=s*i)}var r=o.binarySearch(a,t,2),h=a[r-1],l=a[r],d=1-(t-l)/(a[r-2]-l);for(d=this.curves.getCurvePercent(r/2-1,d),s=a[r+1]-h;s>180;)s-=360;for(;-180>s;)s+=360;for(s=n.data.rotation+(h+s*d)-n.rotation;s>180;)s-=360;for(;-180>s;)s+=360;n.rotation+=s*i}}},o.TranslateTimeline=function(e){this.curves=new o.Curves(e),this.frames=[],this.frames.length=3*e},o.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,i,s){e*=3,this.frames[e]=t,this.frames[e+1]=i,this.frames[e+2]=s},apply:function(e,t,i){var s=this.frames;if(!(t<s[0])){var a=e.bones[this.boneIndex];if(t>=s[s.length-3])return a.x+=(a.data.x+s[s.length-2]-a.x)*i,void(a.y+=(a.data.y+s[s.length-1]-a.y)*i);var n=o.binarySearch(s,t,3),r=s[n-2],h=s[n-1],l=s[n],d=1-(t-l)/(s[n+-3]-l);d=this.curves.getCurvePercent(n/3-1,d),a.x+=(a.data.x+r+(s[n+1]-r)*d-a.x)*i,a.y+=(a.data.y+h+(s[n+2]-h)*d-a.y)*i}}},o.ScaleTimeline=function(e){this.curves=new o.Curves(e),this.frames=[],this.frames.length=3*e},o.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,i,s){e*=3,this.frames[e]=t,this.frames[e+1]=i,this.frames[e+2]=s},apply:function(e,t,i){var s=this.frames;if(!(t<s[0])){var a=e.bones[this.boneIndex];if(t>=s[s.length-3])return a.scaleX+=(a.data.scaleX-1+s[s.length-2]-a.scaleX)*i,void(a.scaleY+=(a.data.scaleY-1+s[s.length-1]-a.scaleY)*i);var n=o.binarySearch(s,t,3),r=s[n-2],h=s[n-1],l=s[n],d=1-(t-l)/(s[n+-3]-l);d=this.curves.getCurvePercent(n/3-1,d),a.scaleX+=(a.data.scaleX-1+r+(s[n+1]-r)*d-a.scaleX)*i,a.scaleY+=(a.data.scaleY-1+h+(s[n+2]-h)*d-a.scaleY)*i}}},o.ColorTimeline=function(e){this.curves=new o.Curves(e),this.frames=[],this.frames.length=5*e},o.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,i){var s=this.frames;if(!(t<s[0])){var a=e.slots[this.slotIndex];if(t>=s[s.length-5]){var n=s.length-1;return a.r=s[n-3],a.g=s[n-2],a.b=s[n-1],void(a.a=s[n])}var r=o.binarySearch(s,t,5),h=s[r-4],l=s[r-3],d=s[r-2],u=s[r-1],c=s[r],m=1-(t-c)/(s[r-5]-c);m=this.curves.getCurvePercent(r/5-1,m);var g=h+(s[r+1]-h)*m,p=l+(s[r+2]-l)*m,f=d+(s[r+3]-d)*m,v=u+(s[r+4]-u)*m;1>i?(a.r+=(g-a.r)*i,a.g+=(p-a.g)*i,a.b+=(f-a.b)*i,a.a+=(v-a.a)*i):(a.r=g,a.g=p,a.b=f,a.a=v)}}},o.AttachmentTimeline=function(e){this.curves=new o.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},o.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,i){this.frames[e]=t,this.attachmentNames[e]=i},apply:function(e,t){var i=this.frames;if(!(t<i[0])){var s;s=t>=i[i.length-1]?i.length-1:o.binarySearch(i,t,1)-1;var a=this.attachmentNames[s];e.slots[this.slotIndex].setAttachment(a?e.getAttachmentBySlotIndex(this.slotIndex,a):null)}}},o.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},o.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var t=this.bones,i=0,s=t.length;s>i;i++)if(t[i].name==e)return t[i];return null},findBoneIndex:function(e){for(var t=this.bones,i=0,s=t.length;s>i;i++)if(t[i].name==e)return i;return-1},findSlot:function(e){for(var t=this.slots,i=0,s=t.length;s>i;i++)if(t[i].name==e)return slot[i];return null},findSlotIndex:function(e){for(var t=this.slots,i=0,s=t.length;s>i;i++)if(t[i].name==e)return i;return-1},findSkin:function(e){for(var t=this.skins,i=0,s=t.length;s>i;i++)if(t[i].name==e)return t[i];return null},findAnimation:function(e){for(var t=this.animations,i=0,s=t.length;s>i;i++)if(t[i].name==e)return t[i];return null}},o.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,i=e.bones.length;i>t;t++){var s=e.bones[t],a=s.parent?this.bones[e.bones.indexOf(s.parent)]:null;this.bones.push(new o.Bone(s,a))}for(this.slots=[],this.drawOrder=[],t=0,i=e.slots.length;i>t;t++){var n=e.slots[t],r=this.bones[e.bones.indexOf(n.boneData)],h=new o.Slot(n,this,r);this.slots.push(h),this.drawOrder.push(h)}},o.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,t=this.flipY,i=this.bones,s=0,a=i.length;a>s;s++)i[s].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,i=e.length;i>t;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,t=0,i=e.length;i>t;t++)e[t].setToSetupPose(t)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(e){for(var t=this.bones,i=0,s=t.length;s>i;i++)if(t[i].data.name==e)return t[i];return null},findBoneIndex:function(e){for(var t=this.bones,i=0,s=t.length;s>i;i++)if(t[i].data.name==e)return i;return-1},findSlot:function(e){for(var t=this.slots,i=0,s=t.length;s>i;i++)if(t[i].data.name==e)return t[i];return null},findSlotIndex:function(e){for(var t=this.slots,i=0,s=t.length;s>i;i++)if(t[i].data.name==e)return i;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var i=this.skin.getAttachment(e,t);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){for(var i=this.slots,s=0,a=i.size;a>s;s++){var n=i[s];if(n.data.name==e){var r=null;if(t&&(r=this.getAttachment(s,t),null==r))throw"Attachment not found: "+t+", for slot: "+e;return void n.setAttachment(r)}}throw"Slot not found: "+e},update:function(e){time+=e}},o.AttachmentType={region:0},o.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},o.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,i,s,a){var n=this.uvs;a?(n[2]=e,n[3]=s,n[4]=e,n[5]=t,n[6]=i,n[7]=t,n[0]=i,n[1]=s):(n[0]=e,n[1]=s,n[2]=e,n[3]=t,n[4]=i,n[5]=t,n[6]=i,n[7]=s)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*e,s=-this.height/2*this.scaleY+this.regionOffsetY*t,a=i+this.regionWidth*e,n=s+this.regionHeight*t,r=this.rotation*Math.PI/180,o=Math.cos(r),h=Math.sin(r),l=i*o+this.x,d=i*h,u=s*o+this.y,c=s*h,m=a*o+this.x,g=a*h,p=n*o+this.y,f=n*h,v=this.offset;v[0]=l-c,v[1]=u+d,v[2]=l-f,v[3]=p+d,v[4]=m-f,v[5]=p+g,v[6]=m-c,v[7]=u+g},computeVertices:function(e,t,i,s){e+=i.worldX,t+=i.worldY;var a=i.m00,n=i.m01,r=i.m10,o=i.m11,h=this.offset;s[0]=h[0]*a+h[1]*n+e,s[1]=h[0]*r+h[1]*o+t,s[2]=h[2]*a+h[3]*n+e,s[3]=h[2]*r+h[3]*o+t,s[4]=h[4]*a+h[5]*n+e,s[5]=h[4]*r+h[5]*o+t,s[6]=h[6]*a+h[7]*n+e,s[7]=h[6]*r+h[7]*o+t}},o.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},o.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,i){var s=this.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;var a=this.skeletonData.findAnimation(t);if(!a)throw"Animation not found: "+t;this.setMix(s,a,i)},setMix:function(e,t,i){this.animationToMixTime[e.name+":"+t.name]=i},getMix:function(e,t){var i=this.animationToMixTime[e.name+":"+t.name];return i?i:this.defaultMix}},o.AnimationState=function(e){this.data=e,this.queue=[]},o.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var i=this.data.skeletonData.findAnimation(e);if(!i)throw"Animation not found: "+e;this.setAnimation(i,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,i){var s=this.data.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;this.addAnimation(s,t,i)},addAnimation:function(e,t,i){var s={};if(s.animation=e,s.loop=t,!i||0>=i){var a=this.queue.length?this.queue[this.queue.length-1].animation:this.current;i=null!=a?a.duration-this.data.getMix(a,e)+(i||0):0}s.delay=i,this.queue.push(s)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},o.SkeletonJson=function(e){this.attachmentLoader=e},o.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var t,i=new o.SkeletonData,s=e.bones,a=0,n=s.length;n>a;a++){var r=s[a],h=null;if(r.parent&&(h=i.findBone(r.parent),!h))throw"Parent bone not found: "+r.parent;t=new o.BoneData(r.name,h),t.length=(r.length||0)*this.scale,t.x=(r.x||0)*this.scale,t.y=(r.y||0)*this.scale,t.rotation=r.rotation||0,t.scaleX=r.scaleX||1,t.scaleY=r.scaleY||1,i.bones.push(t)}var l=e.slots;for(a=0,n=l.length;n>a;a++){var d=l[a];if(t=i.findBone(d.bone),!t)throw"Slot bone not found: "+d.bone;var u=new o.SlotData(d.name,t),c=d.color;c&&(u.r=o.SkeletonJson.toColor(c,0),u.g=o.SkeletonJson.toColor(c,1),u.b=o.SkeletonJson.toColor(c,2),u.a=o.SkeletonJson.toColor(c,3)),u.attachmentName=d.attachment,i.slots.push(u)}var m=e.skins;for(var g in m)if(m.hasOwnProperty(g)){var p=m[g],f=new o.Skin(g);for(var v in p)if(p.hasOwnProperty(v)){var y=i.findSlotIndex(v),x=p[v];for(var w in x)if(x.hasOwnProperty(w)){var b=this.readAttachment(f,w,x[w]);null!=b&&f.addAttachment(y,w,b)}}i.skins.push(f),"default"==f.name&&(i.defaultSkin=f)}var T=e.animations;for(var S in T)T.hasOwnProperty(S)&&this.readAnimation(S,T[S],i);return i},readAttachment:function(e,t,i){t=i.name||t;var s=o.AttachmentType[i.type||"region"];if(s==o.AttachmentType.region){var a=new o.RegionAttachment;return a.x=(i.x||0)*this.scale,a.y=(i.y||0)*this.scale,a.scaleX=i.scaleX||1,a.scaleY=i.scaleY||1,a.rotation=i.rotation||0,a.width=(i.width||32)*this.scale,a.height=(i.height||32)*this.scale,a.updateOffset(),a.rendererObject={},a.rendererObject.name=t,a.rendererObject.scale={},a.rendererObject.scale.x=a.scaleX,a.rendererObject.scale.y=a.scaleY,a.rendererObject.rotation=-a.rotation*Math.PI/180,a}throw"Unknown attachment type: "+s},readAnimation:function(e,t,i){var s,a,n,r,h,l,d,u=[],c=0,m=t.bones;for(var g in m)if(m.hasOwnProperty(g)){var p=i.findBoneIndex(g);if(-1==p)throw"Bone not found: "+g;var f=m[g];for(n in f)if(f.hasOwnProperty(n))if(h=f[n],"rotate"==n){for(a=new o.RotateTimeline(h.length),a.boneIndex=p,s=0,l=0,d=h.length;d>l;l++)r=h[l],a.setFrame(s,r.time,r.angle),o.SkeletonJson.readCurve(a,s,r),s++;u.push(a),c=Math.max(c,a.frames[2*a.getFrameCount()-2])}else{if("translate"!=n&&"scale"!=n)throw"Invalid timeline type for a bone: "+n+" ("+g+")";var v=1;for("scale"==n?a=new o.ScaleTimeline(h.length):(a=new o.TranslateTimeline(h.length),v=this.scale),a.boneIndex=p,s=0,l=0,d=h.length;d>l;l++){r=h[l];var y=(r.x||0)*v,x=(r.y||0)*v;a.setFrame(s,r.time,y,x),o.SkeletonJson.readCurve(a,s,r),s++}u.push(a),c=Math.max(c,a.frames[3*a.getFrameCount()-3])}}var w=t.slots;for(var b in w)if(w.hasOwnProperty(b)){var T=w[b],S=i.findSlotIndex(b);for(n in T)if(T.hasOwnProperty(n))if(h=T[n],"color"==n){for(a=new o.ColorTimeline(h.length),a.slotIndex=S,s=0,l=0,d=h.length;d>l;l++){r=h[l];var C=r.color,A=o.SkeletonJson.toColor(C,0),M=o.SkeletonJson.toColor(C,1),E=o.SkeletonJson.toColor(C,2),L=o.SkeletonJson.toColor(C,3);a.setFrame(s,r.time,A,M,E,L),o.SkeletonJson.readCurve(a,s,r),s++}u.push(a),c=Math.max(c,a.frames[5*a.getFrameCount()-5])}else{if("attachment"!=n)throw"Invalid timeline type for a slot: "+n+" ("+b+")";for(a=new o.AttachmentTimeline(h.length),a.slotIndex=S,s=0,l=0,d=h.length;d>l;l++)r=h[l],a.setFrame(s++,r.time,r.name);u.push(a),c=Math.max(c,a.frames[a.getFrameCount()-1])}}i.animations.push(new o.Animation(e,u,c))}},o.SkeletonJson.readCurve=function(e,t,i){var s=i.curve;s&&("stepped"==s?e.curves.setStepped(t):s instanceof Array&&e.curves.setCurve(t,s[0],s[1],s[2],s[3]))},o.SkeletonJson.toColor=function(e,t){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*t,2),16)/255},o.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var i=new o.AtlasReader(e),s=[];s.length=4;for(var a=null;;){var n=i.readLine();if(null==n)break;if(n=i.trim(n),n.length)if(a){var r=new o.AtlasRegion;r.name=n,r.page=a,r.rotate="true"==i.readValue(),i.readTuple(s);var h=parseInt(s[0],10),l=parseInt(s[1],10);i.readTuple(s);var d=parseInt(s[0],10),u=parseInt(s[1],10);r.u=h/a.width,r.v=l/a.height,r.rotate?(r.u2=(h+u)/a.width,r.v2=(l+d)/a.height):(r.u2=(h+d)/a.width,r.v2=(l+u)/a.height),r.x=h,r.y=l,r.width=Math.abs(d),r.height=Math.abs(u),4==i.readTuple(s)&&(r.splits=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10),parseInt(s[3],10)],4==i.readTuple(s)&&(r.pads=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10),parseInt(s[3],10)],i.readTuple(s))),r.originalWidth=parseInt(s[0],10),r.originalHeight=parseInt(s[1],10),i.readTuple(s),r.offsetX=parseInt(s[0],10),r.offsetY=parseInt(s[1],10),r.index=parseInt(i.readValue(),10),this.regions.push(r)}else{a=new o.AtlasPage,a.name=n,a.format=o.Atlas.Format[i.readValue()],i.readTuple(s),a.minFilter=o.Atlas.TextureFilter[s[0]],a.magFilter=o.Atlas.TextureFilter[s[1]];var c=i.readValue();a.uWrap=o.Atlas.TextureWrap.clampToEdge,a.vWrap=o.Atlas.TextureWrap.clampToEdge,"x"==c?a.uWrap=o.Atlas.TextureWrap.repeat:"y"==c?a.vWrap=o.Atlas.TextureWrap.repeat:"xy"==c&&(a.uWrap=a.vWrap=o.Atlas.TextureWrap.repeat),t.load(a,n),this.pages.push(a)}else a=null}},o.Atlas.prototype={findRegion:function(e){for(var t=this.regions,i=0,s=t.length;s>i;i++)if(t[i].name==e)return t[i];return null},dispose:function(){for(var e=this.pages,t=0,i=e.length;i>t;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){for(var t=this.regions,i=0,s=t.length;s>i;i++){var a=t[i];a.page==e&&(a.u=a.x/e.width,a.v=a.y/e.height,a.rotate?(a.u2=(a.x+a.height)/e.width,a.v2=(a.y+a.width)/e.height):(a.u2=(a.x+a.width)/e.width,a.v2=(a.y+a.height)/e.height))}}},o.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},o.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},o.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},o.AtlasPage=function(){},o.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},o.AtlasRegion=function(){},o.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},o.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},o.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(-1==t)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),i=t.indexOf(":");if(-1==i)throw"Invalid line: "+t;for(var s=0,a=i+1;3>s;s++){var n=t.indexOf(",",a);if(-1==n){if(!s)throw"Invalid line: "+t;break}e[s]=this.trim(t.substr(a,n-a)),a=n+1}return e[s]=this.trim(t.substring(a)),s+1}},o.AtlasAttachmentLoader=function(e){this.atlas=e},o.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,i){switch(t){case o.AttachmentType.region:var s=this.atlas.findRegion(i);if(!s)throw"Region not found in atlas: "+i+" ("+t+")";var a=new o.RegionAttachment(i);return a.rendererObject=s,a.setUVs(s.u,s.v,s.u2,s.v2,s.rotate),a.regionOffsetX=s.offsetX,a.regionOffsetY=s.offsetY,a.regionWidth=s.width,a.regionHeight=s.height,a.regionOriginalWidth=s.originalWidth,a.regionOriginalHeight=s.originalHeight,a}throw"Unknown attachment type: "+t}},o.Bone.yDown=!0,t.AnimCache={},t.Spine=function(e){if(t.DisplayObjectContainer.call(this),this.spineData=t.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new o.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new o.AnimationStateData(this.spineData),this.state=new o.AnimationState(this.stateData),this.slotContainers=[];for(var i=0,s=this.skeleton.drawOrder.length;s>i;i++){var a=this.skeleton.drawOrder[i],n=a.attachment,r=new t.DisplayObjectContainer;if(this.slotContainers.push(r),this.addChild(r),n instanceof o.RegionAttachment){var h=n.rendererObject.name,l=this.createSprite(a,n.rendererObject);a.currentSprite=l,a.currentSpriteName=h,r.addChild(l)}}},t.Spine.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Spine.prototype.constructor=t.Spine,t.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();
var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var i=this.skeleton.drawOrder,s=0,a=i.length;a>s;s++){var n=i[s],r=n.attachment,h=this.slotContainers[s];if(r instanceof o.RegionAttachment){if(r.rendererObject&&(!n.currentSpriteName||n.currentSpriteName!=r.name)){var l=r.rendererObject.name;if(void 0!==n.currentSprite&&(n.currentSprite.visible=!1),n.sprites=n.sprites||{},void 0!==n.sprites[l])n.sprites[l].visible=!0;else{var d=this.createSprite(n,r.rendererObject);h.addChild(d)}n.currentSprite=n.sprites[l],n.currentSpriteName=l}h.visible=!0;var u=n.bone;h.position.x=u.worldX+r.x*u.m00+r.y*u.m01,h.position.y=u.worldY+r.x*u.m10+r.y*u.m11,h.scale.x=u.worldScaleX,h.scale.y=u.worldScaleY,h.rotation=-(n.bone.worldRotation*Math.PI/180)}else h.visible=!1}t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Spine.prototype.createSprite=function(e,i){var s=t.TextureCache[i.name]?i.name:i.name+".png",a=new t.Sprite(t.Texture.fromFrame(s));return a.scale=i.scale,a.rotation=i.rotation,a.anchor.x=a.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[i.name]=a,a},t.BaseTextureCache={},t.texturesToUpdate=[],t.texturesToDestroy=[],t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,i){if(t.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=i||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this.id=t.BaseTextureCacheIdGenerator++,this._glTextures=[],e){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,t.texturesToUpdate.push(this);else{var s=this;this.source.onload=function(){s.hasLoaded=!0,s.width=s.source.width,s.height=s.source.height,t.texturesToUpdate.push(s),s.dispatchEvent({type:"loaded",content:s})}}this.imageUrl=null,this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.BaseTexture.prototype.destroy=function(){this.imageUrl&&(delete t.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null),this.source=null,t.texturesToDestroy.push(this)},t.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},t.BaseTexture.fromImage=function(e,i,s){var a=t.BaseTextureCache[e];if(void 0===i&&-1===e.indexOf("data:")&&(i=!0),!a){var n=new Image;i&&(n.crossOrigin=""),n.src=e,a=new t.BaseTexture(n,s),a.imageUrl=e,t.BaseTextureCache[e]=a}return a},t.BaseTexture.fromCanvas=function(e,i){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var s=t.BaseTextureCache[e._pixiId];return s||(s=new t.BaseTexture(e,i),t.BaseTextureCache[e._pixiId]=s),s},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,i){if(t.EventTarget.call(this),i||(this.noFrame=!0,i=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=i,this.trim=null,this.scope=this,this._uvs=null,e.hasLoaded)this.noFrame&&(i=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(i);else{var s=this;e.addEventListener("loaded",function(){s.onBaseTextureLoaded()})}},t.Texture.prototype.constructor=t.Texture,t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},t.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,t.Texture.frameUpdates.push(this)},t.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.frame,i=this.baseTexture.width,s=this.baseTexture.height;this._uvs.x0=e.x/i,this._uvs.y0=e.y/s,this._uvs.x1=(e.x+e.width)/i,this._uvs.y1=e.y/s,this._uvs.x2=(e.x+e.width)/i,this._uvs.y2=(e.y+e.height)/s,this._uvs.x3=e.x/i,this._uvs.y3=(e.y+e.height)/s},t.Texture.fromImage=function(e,i,s){var a=t.TextureCache[e];return a||(a=new t.Texture(t.BaseTexture.fromImage(e,i,s)),t.TextureCache[e]=a),a},t.Texture.fromFrame=function(e){var i=t.TextureCache[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return i},t.Texture.fromCanvas=function(e,i){var s=t.BaseTexture.fromCanvas(e,i);return new t.Texture(s)},t.Texture.addTextureToCache=function(e,i){t.TextureCache[i]=e},t.Texture.removeTextureFromCache=function(e){var i=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],i},t.Texture.frameUpdates=[],t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y4=0},t.RenderTexture=function(e,i,s,a){if(t.EventTarget.call(this),this.width=e||100,this.height=i||100,this.frame=new t.Rectangle(0,0,this.width,this.height),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=a||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=s||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var n=this.renderer.gl;this.textureBuffer=new t.FilterTexture(n,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[n.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;t.Texture.frameUpdates.push(this)},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,i){if(this.width=e,this.height=i,this.frame.width=this.width,this.frame.height=this.height,this.renderer.type===t.WEBGL_RENDERER){this.projection.x=this.width/2,this.projection.y=-this.height/2;var s=this.renderer.gl;s.bindTexture(s.TEXTURE_2D,this.baseTexture._glTextures[s.id]),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null)}else this.textureBuffer.resize(this.width,this.height);t.Texture.frameUpdates.push(this)},t.RenderTexture.prototype.renderWebGL=function(e,i,s){var a=this.renderer.gl;a.colorMask(!0,!0,!0,!0),a.viewport(0,0,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),s&&this.textureBuffer.clear();var n=e.children,r=e.worldTransform;e.worldTransform=t.RenderTexture.tempMatrix,e.worldTransform.d=-1,e.worldTransform.ty=-2*this.projection.y,i&&(e.worldTransform.tx=i.x,e.worldTransform.ty-=i.y);for(var o=0,h=n.length;h>o;o++)n[o].updateTransform();t.WebGLRenderer.updateTextures(),this.renderer.renderDisplayObject(e,this.projection,this.textureBuffer.frameBuffer),e.worldTransform=r},t.RenderTexture.prototype.renderCanvas=function(e,i,s){var a=e.children,n=e.worldTransform;e.worldTransform=t.RenderTexture.tempMatrix,i&&(e.worldTransform.tx=i.x,e.worldTransform.ty=i.y);for(var r=0,o=a.length;o>r;r++)a[r].updateTransform();s&&this.textureBuffer.clear();var h=this.textureBuffer.context;this.renderer.renderDisplayObject(e,h),h.setTransform(1,0,0,1,0,0),e.worldTransform=n},t.RenderTexture.tempMatrix=new t.Matrix,t.AssetLoader=function(e,i){t.EventTarget.call(this),this.assetURLs=e,this.crossorigin=i,this.loadersByType={jpg:t.ImageLoader,jpeg:t.ImageLoader,png:t.ImageLoader,gif:t.ImageLoader,json:t.JsonLoader,atlas:t.AtlasLoader,anim:t.SpineLoader,xml:t.BitmapFontLoader,fnt:t.BitmapFontLoader}},t.AssetLoader.prototype.constructor=t.AssetLoader,t.AssetLoader.prototype._getDataType=function(e){var t="data:",i=e.slice(0,t.length).toLowerCase();if(i===t){var s=e.slice(t.length),a=s.indexOf(",");if(-1===a)return null;var n=s.slice(0,a).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null},t.AssetLoader.prototype.load=function(){function e(e){t.onAssetLoaded(e.content)}var t=this;this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var s=this.assetURLs[i],a=this._getDataType(s);a||(a=s.split("?").shift().split(".").pop().toLowerCase());var n=this.loadersByType[a];if(!n)throw new Error(a+" is an unsupported file type");var r=new n(s,this.crossorigin);r.addEventListener("loaded",e),r.load()}},t.AssetLoader.prototype.onAssetLoaded=function(e){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this,loader:e}),this.onProgress&&this.onProgress(e),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},t.JsonLoader=function(e,i){t.EventTarget.call(this),this.url=e,this.crossorigin=i,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},t.JsonLoader.prototype.constructor=t.JsonLoader,t.JsonLoader.prototype.load=function(){var e=this;this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},t.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,i=this.baseUrl+this.json.meta.image,s=new t.ImageLoader(i,this.crossorigin),a=this.json.frames;this.texture=s.texture.baseTexture,s.addEventListener("loaded",function(){e.onLoaded()});for(var n in a){var r=a[n].frame;if(r&&(t.TextureCache[n]=new t.Texture(this.texture,{x:r.x,y:r.y,width:r.w,height:r.h}),a[n].trimmed)){var h=t.TextureCache[n],l=a[n].sourceSize,d=a[n].spriteSourceSize;h.trim=new t.Rectangle(d.x,d.y,l.w,l.h)}}s.load()}else if(this.json.bones){var u=new o.SkeletonJson,c=u.readSkeletonData(this.json);t.AnimCache[this.url]=c,this.onLoaded()}else this.onLoaded()},t.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.AtlasLoader=function(e,i){t.EventTarget.call(this),this.url=e,this.baseUrl=e.replace(/[^\/]*$/,""),this.crossorigin=i,this.loaded=!1},t.AtlasLoader.constructor=t.AtlasLoader,t.AtlasLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},t.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,s=0,a=null,n=!1,r=0,o=0,h=this.onLoaded.bind(this);for(r=0;r<e.length;r++)if(e[r]=e[r].replace(/^\s+|\s+$/g,""),""===e[r]&&(n=r+1),e[r].length>0){if(n===r)this.atlas.meta.image.push(e[r]),s=this.atlas.meta.image.length-1,this.atlas.frames.push({}),i=-3;else if(i>0)if(i%7===1)null!=a&&(this.atlas.frames[s][a.name]=a),a={name:e[r],frame:{}};else{var l=e[r].split(" ");if(i%7===3)a.frame.x=Number(l[1].replace(",","")),a.frame.y=Number(l[2]);else if(i%7===4)a.frame.w=Number(l[1].replace(",","")),a.frame.h=Number(l[2]);else if(i%7===5){var d={x:0,y:0,w:Number(l[1].replace(",","")),h:Number(l[2])};d.w>a.frame.w||d.h>a.frame.h?(a.trimmed=!0,a.realSize=d):a.trimmed=!1}}i++}if(null!=a&&(this.atlas.frames[s][a.name]=a),this.atlas.meta.image.length>0){for(this.images=[],o=0;o<this.atlas.meta.image.length;o++){var u=this.baseUrl+this.atlas.meta.image[o],c=this.atlas.frames[o];this.images.push(new t.ImageLoader(u,this.crossorigin));for(r in c){var m=c[r].frame;m&&(t.TextureCache[r]=new t.Texture(this.images[o].texture.baseTexture,{x:m.x,y:m.y,width:m.w,height:m.h}),c[r].trimmed&&(t.TextureCache[r].realSize=c[r].realSize,t.TextureCache[r].trim.x=0,t.TextureCache[r].trim.y=0))}}for(this.currentImageId=0,o=0;o<this.images.length;o++)this.images[o].addEventListener("loaded",h);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},t.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},t.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.SpriteSheetLoader=function(e,i){t.EventTarget.call(this),this.url=e,this.crossorigin=i,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},t.SpriteSheetLoader.prototype.constructor=t.SpriteSheetLoader,t.SpriteSheetLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.addEventListener("loaded",function(t){e.json=t.content.json,e.onLoaded()}),i.load()},t.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},t.ImageLoader=function(e,i){t.EventTarget.call(this),this.texture=t.Texture.fromImage(e,i),this.frames=[]},t.ImageLoader.prototype.constructor=t.ImageLoader,t.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},t.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},t.ImageLoader.prototype.loadFramedSpriteSheet=function(e,i,s){this.frames=[];for(var a=Math.floor(this.texture.width/e),n=Math.floor(this.texture.height/i),r=0,o=0;n>o;o++)for(var h=0;a>h;h++,r++){var l=new t.Texture(this.texture,{x:h*e,y:o*i,width:e,height:i});this.frames.push(l),s&&(t.TextureCache[s+"-"+r]=l)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var d=this;this.texture.baseTexture.addEventListener("loaded",function(){d.onLoaded()})}},t.BitmapFontLoader=function(e,i){t.EventTarget.call(this),this.url=e,this.crossorigin=i,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},t.BitmapFontLoader.prototype.constructor=t.BitmapFontLoader,t.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},t.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var i=new DOMParser;e=i.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var s=document.createElement("div");s.innerHTML=this.ajaxRequest.responseText,e=s}var a=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),n=new t.ImageLoader(a,this.crossorigin);this.texture=n.texture.baseTexture;var r={},o=e.getElementsByTagName("info")[0],h=e.getElementsByTagName("common")[0];r.font=o.getAttribute("face"),r.size=parseInt(o.getAttribute("size"),10),r.lineHeight=parseInt(h.getAttribute("lineHeight"),10),r.chars={};for(var l=e.getElementsByTagName("char"),d=0;d<l.length;d++){var u=parseInt(l[d].getAttribute("id"),10),c=new t.Rectangle(parseInt(l[d].getAttribute("x"),10),parseInt(l[d].getAttribute("y"),10),parseInt(l[d].getAttribute("width"),10),parseInt(l[d].getAttribute("height"),10));r.chars[u]={xOffset:parseInt(l[d].getAttribute("xoffset"),10),yOffset:parseInt(l[d].getAttribute("yoffset"),10),xAdvance:parseInt(l[d].getAttribute("xadvance"),10),kerning:{},texture:t.TextureCache[u]=new t.Texture(this.texture,c)}}var m=e.getElementsByTagName("kerning");for(d=0;d<m.length;d++){var g=parseInt(m[d].getAttribute("first"),10),p=parseInt(m[d].getAttribute("second"),10),f=parseInt(m[d].getAttribute("amount"),10);r.chars[p].kerning[g]=f}t.BitmapText.fonts[r.font]=r;var v=this;n.addEventListener("loaded",function(){v.onLoaded()}),n.load()}},t.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},t.SpineLoader=function(e,i){t.EventTarget.call(this),this.url=e,this.crossorigin=i,this.loaded=!1},t.SpineLoader.prototype.constructor=t.SpineLoader,t.SpineLoader.prototype.load=function(){var e=this,i=new t.JsonLoader(this.url,this.crossorigin);i.addEventListener("loaded",function(t){e.json=t.content.json,e.onLoaded()}),i.load()},t.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.AbstractFilter=function(e,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=e||[]},t.AlphaMaskFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},t.AlphaMaskFilter.prototype=Object.create(t.AbstractFilter.prototype),t.AlphaMaskFilter.prototype.constructor=t.AlphaMaskFilter,t.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(e){this.uniforms.mask.value=e}}),t.ColorMatrixFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},t.ColorMatrixFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorMatrixFilter.prototype.constructor=t.ColorMatrixFilter,Object.defineProperty(t.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=e}}),t.GrayFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},t.GrayFilter.prototype=Object.create(t.AbstractFilter.prototype),t.GrayFilter.prototype.constructor=t.GrayFilter,Object.defineProperty(t.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(e){this.uniforms.gray.value=e}}),t.DisplacementFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},t.DisplacementFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DisplacementFilter.prototype.constructor=t.DisplacementFilter,t.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(e){this.uniforms.displacementMap.value=e}}),Object.defineProperty(t.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}}),Object.defineProperty(t.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}}),t.PixelateFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},t.PixelateFilter.prototype=Object.create(t.AbstractFilter.prototype),t.PixelateFilter.prototype.constructor=t.PixelateFilter,Object.defineProperty(t.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.dirty=!0,this.uniforms.pixelSize.value=e}}),t.BlurXFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurXFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurXFilter.prototype.constructor=t.BlurXFilter,Object.defineProperty(t.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.dirty=!0,this.uniforms.blur.value=1/7e3*e}}),t.BlurYFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurYFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurYFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),t.BlurFilter=function(){this.blurXFilter=new t.BlurXFilter,this.blurYFilter=new t.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(t.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}}),Object.defineProperty(t.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}}),Object.defineProperty(t.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}),t.InvertFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},t.InvertFilter.prototype=Object.create(t.AbstractFilter.prototype),t.InvertFilter.prototype.constructor=t.InvertFilter,Object.defineProperty(t.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(e){this.uniforms.invert.value=e}}),t.SepiaFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},t.SepiaFilter.prototype=Object.create(t.AbstractFilter.prototype),t.SepiaFilter.prototype.constructor=t.SepiaFilter,Object.defineProperty(t.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(e){this.uniforms.sepia.value=e}}),t.TwistFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},t.TwistFilter.prototype=Object.create(t.AbstractFilter.prototype),t.TwistFilter.prototype.constructor=t.TwistFilter,Object.defineProperty(t.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.dirty=!0,this.uniforms.offset.value=e}}),Object.defineProperty(t.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(e){this.dirty=!0,this.uniforms.radius.value=e}}),Object.defineProperty(t.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),t.ColorStepFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},t.ColorStepFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorStepFilter.prototype.constructor=t.ColorStepFilter,Object.defineProperty(t.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(e){this.uniforms.step.value=e}}),t.DotScreenFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},t.DotScreenFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DotScreenFilter.prototype.constructor=t.DotScreenFilter,Object.defineProperty(t.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.dirty=!0,this.uniforms.scale.value=e}}),Object.defineProperty(t.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),t.CrossHatchFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]
},t.CrossHatchFilter.prototype=Object.create(t.AbstractFilter.prototype),t.CrossHatchFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),t.RGBSplitFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},t.RGBSplitFilter.prototype=Object.create(t.AbstractFilter.prototype),t.RGBSplitFilter.prototype.constructor=t.RGBSplitFilter,Object.defineProperty(t.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define(t):e.PIXI=t}).call(this),PIXI.FlashClip=function(e){var t=[];for(var i in PIXI.TextureCache)-1!==i.indexOf(e)&&i.length===e.length+4&&t.push(PIXI.Texture.fromFrame(i));if(0===t.length)throw"FlashClip textures not found";PIXI.MovieClip.call(this,t)},PIXI.FlashClip.prototype=Object.create(PIXI.MovieClip.prototype),PIXI.FlashClip.prototype.constructor=PIXI.FlashClip,PIXI.extend=function(e){function t(){var t;this.init?this.init.apply(this,arguments):this.base.apply(this,arguments);for(t in s)"function"!=typeof s[t]&&(this[t]=game.copy(s[t]));for(t in e)"function"!=typeof e[t]&&(this[t]=game.copy(e[t]))}var i,s=this.prototype,a=this.prototype.base||this;t.prototype=Object.create(a.prototype);var n=function(e,t){var i=s[e];return"init"!==e||i||(i=a),function(){var e=this._super;this._super=i;var s=t.apply(this,arguments);return this._super=e,s}};for(i in s)t.prototype[i]="function"==typeof s[i]?n(i,s[i]):s[i];for(i in e)t.prototype[i]="function"==typeof e[i]?n(i,e[i]):e[i];return t.prototype.constructor=t,t.prototype.base=a,t.extend=PIXI.extend,t};for(var e in PIXI)PIXI[e].prototype instanceof Object&&(PIXI[e].extend=PIXI.extend);game.AssetLoader=PIXI.AssetLoader,game.Text=PIXI.Text,game.MovieClip=PIXI.MovieClip,game.FlashClip=PIXI.FlashClip,game.BitmapText=PIXI.BitmapText,game.Graphics=PIXI.Graphics,game.HitRectangle=PIXI.Rectangle,game.HitCircle=PIXI.Circle,game.HitEllipse=PIXI.Ellipse,game.HitPolygon=PIXI.Polygon,game.TextureCache=PIXI.TextureCache,game.RenderTexture=PIXI.RenderTexture,game.Point=PIXI.Point,game.CanvasRenderer=PIXI.CanvasRenderer,game.autoDetectRenderer=PIXI.autoDetectRenderer,game.Stage=PIXI.Stage,game.blendModes=PIXI.blendModes}),game.module("engine.sprite").require("engine.renderer").body(function(){game.Sprite=PIXI.Sprite.extend({debugDraw:!0,init:function(e,t,i,s){"string"==typeof e&&(e=game.assets[e]||e,e=game.Texture.fromFrame(e)),this._super(e),game.merge(this,s),"number"==typeof t&&(this.position.x=t),"number"==typeof i&&(this.position.y=i),game.device.mobile&&!this.tap&&this.click&&(this.tap=this.click),game.device.mobile&&!this.touchmove&&this.mousemove&&(this.touchmove=this.mousemove),game.device.mobile&&!this.touchstart&&this.mousedown&&(this.touchstart=this.mousedown),game.device.mobile&&!this.touchend&&this.mouseup&&(this.touchend=this.mouseup),game.device.mobile&&!this.touchendoutside&&this.mouseupoutside&&(this.touchendoutside=this.mouseupoutside)},setTexture:function(e){"string"==typeof e&&(e=game.assets[e]||e,e=game.Texture.fromFrame(e)),this._super(e)},remove:function(){this.parent&&this.parent.removeChild(this)},addChild:function(e){this._super(e),game.debugDraw&&e.interactive&&game.debugDraw.addSprite(e)}}),game.Spine=PIXI.Spine.extend({init:function(e,t){this._super(game.assets[e]||e),game.merge(this,t)},play:function(e,t,i){i?this.state.addAnimationByName(e,!!t):this.state.setAnimationByName(e,!!t)},mix:function(e,t,i){this.stateData.setMixByName(e,t,i/100)}}),game.Container=PIXI.DisplayObjectContainer.extend({debugDraw:!0,remove:function(){this.parent&&this.parent.removeChild(this)},addChild:function(e){this._super(e),game.debugDraw&&e.interactive&&e.debugDraw&&game.debugDraw.addSprite(e)},addTo:function(e){return e.addChild(this),this}}),game.Texture=PIXI.Texture.extend(),game.Texture.fromImage=function(e,t){return e=game.assets[e]||e,PIXI.Texture.fromImage(e,t)},game.Texture.fromCanvas=PIXI.Texture.fromCanvas,game.Texture.fromFrame=PIXI.Texture.fromFrame,game.TilingSprite=PIXI.TilingSprite.extend({speed:{x:0,y:0},init:function(e,t,i,s){e=game.assets[e]||e;var a=e instanceof PIXI.Texture?e:PIXI.Texture.fromFrame(this.path||e);this._super(a,t||a.width,i||a.height),game.merge(this,s)},update:function(){this.tilePosition.x+=this.speed.x*game.system.delta,this.tilePosition.y+=this.speed.y*game.system.delta}}),game.Animation=PIXI.MovieClip.extend({init:function(){for(var e=Array.prototype.slice.call(arguments),t=[],i=0;i<e.length;i++)t.push(game.Texture.fromImage(e[i]));this._super(t)}})}),game.module("engine.debug").body(function(){game.DebugDraw=game.Class.extend({container:null,init:function(){this.container=new game.Container},reset:function(){for(var e=this.container.children.length-1;e>=0;e--)this.container.removeChild(this.container.children[e]);game.system.stage.addChild(this.container)},addSprite:function(e){var t=new game.Graphics;t.beginFill(game.DebugDraw.spriteColor),e.hitArea?e.hitArea instanceof game.HitRectangle?t.drawRect(e.hitArea.x,e.hitArea.y,e.hitArea.width,e.hitArea.height):e.hitArea instanceof game.HitCircle&&t.drawCircle(e.hitArea.x,e.hitArea.y,e.hitArea.radius):t.drawRect(-e.width*e.anchor.x,-e.height*e.anchor.y,e.width,e.height),t.target=e,t.alpha=game.DebugDraw.spriteAlpha,this.container.addChild(t)},addBody:function(e){var t=new game.Graphics;this.drawDebugSprite(t,e),t.position.x=e.position.x,t.position.y=e.position.y,t.target=e,t.alpha=game.DebugDraw.shapeAlpha,this.container.addChild(t)},drawDebugSprite:function(e,t){e.clear(),e.beginFill(game.DebugDraw.shapeColor),t.shape instanceof game.Rectangle&&(e.drawRect(-t.shape.width/2,-t.shape.height/2,t.shape.width,t.shape.height),e.width=t.shape.width,e.height=t.shape.height),t.shape instanceof game.Circle&&(e.drawCircle(0,0,t.shape.radius),e.radius=t.shape.radius)},update:function(){for(var e=this.container.children.length-1;e>=0;e--)game.modules["plugins.p2"]&&this.container.children[e].target instanceof game.Body?this.updateP2(this.container.children[e]):(this.container.children[e].rotation=this.container.children[e].target.rotation,game.modules["engine.physics"]&&this.container.children[e].target instanceof game.Body?((this.container.children[e].width!==this.container.children[e].target.shape.width||this.container.children[e].height!==this.container.children[e].target.shape.height)&&this.drawDebugSprite(this.container.children[e],this.container.children[e].target),this.container.children[e].radius!==this.container.children[e].target.shape.radius&&this.drawDebugSprite(this.container.children[e],this.container.children[e].target),this.container.children[e].position.x=this.container.children[e].target.position.x+game.scene.stage.position.x,this.container.children[e].position.y=this.container.children[e].target.position.y+game.scene.stage.position.y,this.container.children[e].target.world||this.container.removeChild(this.container.children[e])):(this.container.children[e].target.parent&&this.container.children[e].target.updateTransform(),this.container.children[e].position.x=this.container.children[e].target.worldTransform.tx,this.container.children[e].position.y=this.container.children[e].target.worldTransform.ty,this.container.children[e].scale.x=this.container.children[e].target.scale.x,this.container.children[e].scale.y=this.container.children[e].target.scale.y,this.container.children[e].target.parent||this.container.removeChild(this.container.children[e])))}}),game.DebugDraw.spriteColor=16711680,game.DebugDraw.spriteAlpha=.3,game.DebugDraw.shapeColor=255,game.DebugDraw.shapeAlpha=.3,game.DebugDraw.enabled=document.location.href.match(/\?debugdraw/)?!0:!1,game.Debug=game.Class.extend({frames:0,last:0,fps:0,fpsText:null,init:function(){this.fpsText=new game.Text("0",{fill:game.Debug.color}),this.fpsText.position.set(game.Debug.position.x,game.Debug.position.y),game.system.stage.addChild(this.fpsText)},update:function(){this.frames++,game.Timer.last>=this.last+game.Debug.frequency&&(this.fps=Math.round(1e3*this.frames/(game.Timer.last-this.last)).toString(),this.fps!==this.fpsText.text&&this.fpsText.setText(this.fps.toString()),this.last=game.Timer.last,this.frames=0)}}),game.Debug.enabled=!!document.location.href.toLowerCase().match(/\?debug/),game.Debug.frequency=1e3,game.Debug.color="white",game.Debug.position={x:10,y:10}}),game.module("engine.storage").body(function(){game.Storage=game.Class.extend({id:null,init:function(e){this.id=e},set:function(e,t){localStorage[this.id+"."+e]=this.encode(t)},get:function(e){return this.decode(localStorage[this.id+"."+e])},remove:function(e){localStorage.removeItem(this.id+"."+e)},reset:function(){for(var e in localStorage)-1!==e.indexOf(this.id+".")&&localStorage.removeItem(e)},encode:function(e){return"object"==typeof e?JSON.stringify(e):e},decode:function(e){return"undefined"!=typeof e?0===e.indexOf("{")?JSON.parse(e):e:void 0}}),game.Storage.id=""}),game.module("engine.tween").body(function(){game.TweenEngine=game.Class.extend({tweens:[],removeAll:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].shouldRemove=!0},stopTweensForObject:function(e){for(var t=this.tweens.length-1;t>=0;t--)this.tweens[t].object===e&&this.tweens[t].stop()},getTweenForObject:function(e){for(var t=this.tweens.length-1;t>=0;t--)if(this.tweens[t].object===e)return this.tweens[t];return!1},add:function(e){this.tweens.push(e)},remove:function(e){var t=this.tweens.indexOf(e);-1!==t&&(this.tweens[t].shouldRemove=!0)},update:function(){if(0===this.tweens.length)return!1;for(var e=this.tweens.length-1;e>=0;e--)this.tweens[e].update()||this.tweens.splice(e,1);return!0}}),game.Tween=game.Class.extend({isPlaying:!1,paused:!1,object:null,valuesStart:{},valuesEnd:null,valuesStartRepeat:{},duration:1e3,repeatCount:0,repeats:0,yoyoEnabled:!1,reversed:!1,delayTime:0,delayRepeat:!1,startTime:null,originalStartTime:null,easingFunction:null,interpolationFunction:null,chainedTweens:[],onStartCallback:null,onStartCallbackFired:!1,onUpdateCallback:null,onCompleteCallback:null,onRepeatCallback:null,currentTime:0,shouldRemove:!1,init:function(e){if(!e)throw"No object defined for tween";if("object"!=typeof e)throw"Tween parameter must be object";this.object=e,this.easingFunction=game.Tween.Easing.Linear.None,this.interpolationFunction=game.Tween.Interpolation.Linear;for(var t in e)this.valuesStart[t]=parseFloat(e[t],10)},to:function(e,t){return this.duration=t||this.duration,this.valuesEnd=e,this},start:function(){game.tweenEngine.add(this),this.isPlaying=!0,this.onStartCallbackFired=!1,this.startTime=this.delayTime,this.originalStartTime=this.startTime;for(var e in this.valuesEnd){if(this.valuesEnd[e]instanceof Array){if(0===this.valuesEnd[e].length)continue;this.valuesEnd[e]=[this.object[e]].concat(this.valuesEnd[e])}this.valuesStart[e]=this.object[e],this.valuesStart[e]instanceof Array==!1&&(this.valuesStart[e]*=1),this.valuesStartRepeat[e]=this.valuesStart[e]||0}return this},stop:function(){return this.isPlaying?(game.tweenEngine.remove(this),this.isPlaying=!1,this.stopChainedTweens(),this):this},pause:function(){this.paused=!0},resume:function(){this.paused=!1},stopChainedTweens:function(){for(var e=0,t=this.chainedTweens.length;t>e;e++)this.chainedTweens[e].stop()},delay:function(e,t){return this.delayTime=e,this.delayRepeat=!!t,this},repeat:function(e){return"undefined"==typeof e&&(e=1/0),this.repeatCount=e,this},yoyo:function(e){return"undefined"==typeof e&&(e=!0),this.yoyoEnabled=e,this},easing:function(e){return this.easingFunction=e,this},interpolation:function(e){return this.interpolationFunction=e,this},chain:function(){return this.chainedTweens=arguments,this},onStart:function(e){return this.onStartCallback=e,this},onUpdate:function(e){return this.onUpdateCallback=e,this},onComplete:function(e){return this.onCompleteCallback=e,this},onRepeat:function(e){return this.onRepeatCallback=e,this},update:function(){if(this.shouldRemove)return!1;if(this.paused)return!0;if(this.currentTime+=1e3*game.system.delta,this.currentTime<this.startTime)return!0;this.onStartCallbackFired===!1&&(null!==this.onStartCallback&&this.onStartCallback.call(this.object),this.onStartCallbackFired=!0);var e=(this.currentTime-this.startTime)/this.duration;e=e>1?1:e;var t,i=this.easingFunction(e);for(t in this.valuesEnd){var s=this.valuesStart[t]||0,a=this.valuesEnd[t];a instanceof Array?this.object[t]=this.interpolationFunction(a,i):("string"==typeof a&&(a=s+parseFloat(a,10)),"number"==typeof a&&(this.object[t]=s+(a-s)*i))}if(null!==this.onUpdateCallback&&this.onUpdateCallback.call(this.object,i),1===e){if(this.repeatCount>0){isFinite(this.repeatCount)&&this.repeatCount--,this.repeats+=1;for(t in this.valuesStartRepeat){if("string"==typeof this.valuesEnd[t]&&(this.valuesStartRepeat[t]=this.valuesStartRepeat[t]+parseFloat(this.valuesEnd[t],10)),this.yoyoEnabled){var n=this.valuesStartRepeat[t];this.valuesStartRepeat[t]=this.valuesEnd[t],this.valuesEnd[t]=n,this.reversed=!this.reversed}this.valuesStart[t]=this.valuesStartRepeat[t]}return this.delayRepeat||(this.delayTime=0),this.startTime=this.originalStartTime+this.repeats*(this.duration+this.delayTime),null!==this.onRepeatCallback&&this.onRepeatCallback.call(this.object),!0}this.isPlaying=!1,null!==this.onCompleteCallback&&this.onCompleteCallback.call(this.object);for(var r=0,o=this.chainedTweens.length;o>r;r++)this.chainedTweens[r].start();return!1}return!0}}),game.Tween.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s)))},Out:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/s)+1)},InOut:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s):i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-game.Tween.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*game.Tween.Easing.Bounce.In(2*e):.5*game.Tween.Easing.Bounce.Out(2*e-1)+.5}}},game.Tween.Interpolation={Linear:function(e,t){var i=e.length-1,s=i*t,a=Math.floor(s),n=game.Tween.Interpolation.Utils.Linear;return 0>t?n(e[0],e[1],s):t>1?n(e[i],e[i-1],i-s):n(e[a],e[a+1>i?i:a+1],s-a)},Bezier:function(e,t){var i,s=0,a=e.length-1,n=Math.pow,r=game.Tween.Interpolation.Utils.Bernstein;for(i=0;a>=i;i++)s+=n(1-t,a-i)*n(t,i)*e[i]*r(a,i);return s},CatmullRom:function(e,t){var i=e.length-1,s=i*t,a=Math.floor(s),n=game.Tween.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(a=Math.floor(s=i*(1+t))),n(e[(a-1+i)%i],e[a],e[(a+1)%i],e[(a+2)%i],s-a)):0>t?e[0]-(n(e[0],e[0],e[1],e[1],-s)-e[0]):t>1?e[i]-(n(e[i],e[i],e[i-1],e[i-1],s-i)-e[i]):n(e[a?a-1:0],e[a],e[a+1>i?i:a+1],e[a+2>i?i:a+2],s-a)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=game.Tween.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,s=1;if(e[t])return e[t];for(i=t;i>1;i--)s*=i;return e[t]=s}}(),CatmullRom:function(e,t,i,s,a){var n=.5*(i-e),r=.5*(s-t),o=a*a,h=a*o;return(2*t-2*i+n+r)*h+(-3*t+3*i-2*n-r)*o+n*a+t}}},game.TweenGroup=game.Class.extend({tweens:[],onComplete:null,complete:!1,init:function(e){this.onComplete=e},add:function(e){return e.onComplete(this.tweenComplete.bind(this)),this.tweens.push(e),e},tweenComplete:function(){if(!this.complete){for(var e=0;e<this.tweens.length;e++)if(this.tweens[e].isPlaying)return;this.complete=!0,"function"==typeof this.onComplete&&this.onComplete()}},remove:function(e){this.tweens.erase(e)},start:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].start()},pause:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].pause()},resume:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].resume()},stop:function(e,t){if(!this.complete){for(var i=0;i<this.tweens.length;i++)this.tweens[i].stop(t);!this.complete&&e&&this.tweenComplete(),this.complete=!0}}})}),game.module("engine.scene").body(function(){game.Scene=game.Class.extend({backgroundColor:0,objects:[],timers:[],emitters:[],stage:null,swipeDist:100,swipeTime:500,staticInit:function(){game.scene=this;for(var e=game.system.stage.children.length-1;e>=0;e--)game.system.stage.removeChild(game.system.stage.children[e]);game.system.stage.setBackgroundColor(this.backgroundColor),game.system.stage.mousemove=game.system.stage.touchmove=this._mousemove.bind(this),game.system.stage.click=game.system.stage.tap=this.click.bind(this),game.system.stage.mousedown=game.system.stage.touchstart=this._mousedown.bind(this),game.system.stage.mouseup=game.system.stage.mouseupoutside=game.system.stage.touchend=game.system.stage.touchendoutside=this.mouseup.bind(this),game.system.stage.mouseout=this.mouseout.bind(this),this.stage=new game.Container,game.system.stage.addChild(this.stage),game.debugDraw&&game.debugDraw.reset()},update:function(){var e;for(this.world&&this.world.update(),e=this.timers.length-1;e>=0;e--)this.timers[e].time()>=0&&("function"==typeof this.timers[e].callback&&this.timers[e].callback(),this.timers[e].repeat?this.timers[e].reset():this.timers.splice(e,1));for(e=this.emitters.length-1;e>=0;e--)this.emitters[e].update(),this.emitters[e]._remove&&this.emitters.splice(e,1);for(game.tweenEngine&&game.tweenEngine.update(),e=this.objects.length-1;e>=0;e--)"function"==typeof this.objects[e].update&&this.objects[e].update(),this.objects[e]._remove&&this.objects.splice(e,1)},addObject:function(e){e._remove&&(e._remove=!1),this.objects.push(e)},removeObject:function(e){e._remove=!0},addEmitter:function(e){this.emitters.push(e)},removeEmitter:function(e){e._remove=!0},addTimer:function(e,t,i){var s=new game.Timer(e);return s.repeat=!!i,s.callback=t,this.timers.push(s),s},addTween:function(e,t,i,s){var a=new game.Tween(e);a.to(t,i);for(var n in s)a[n](s[n]);return a},removeTimer:function(e,t){t||(e.callback=null),e.repeat=!1,e.set(0)},click:function(){},mousedown:function(){},mouseup:function(){},mousemove:function(){},mouseout:function(){},keydown:function(){},keyup:function(){},_mousedown:function(e){e.startTime=Date.now(),e.swipeX=e.global.x,e.swipeY=e.global.y,this.mousedown(e)},_mousemove:function(e){this.mousemove(e),e.startTime&&(e.global.x-e.swipeX>=this.swipeDist?this._swipe(e,"right"):e.global.x-e.swipeX<=-this.swipeDist?this._swipe(e,"left"):e.global.y-e.swipeY>=this.swipeDist?this._swipe(e,"down"):e.global.y-e.swipeY<=-this.swipeDist&&this._swipe(e,"up"))},_swipe:function(e,t){var i=Date.now()-e.startTime;e.startTime=null,i<=this.swipeTime&&this.swipe(t)},swipe:function(){},run:function(){this.update(),game.debugDraw&&game.debugDraw.update(),this.render()},render:function(){game.renderer.render(game.system.stage)},pause:function(){game.audio&&game.audio.pauseAll()},resume:function(){game.audio&&game.audio.resumeAll()}})}),game.module("engine.pool").body(function(){game.Pool=game.Class.extend({create:function(e){return this[e]?!1:(this[e]=[],!0)},get:function(e){return this[e]&&0!==this[e].length?this[e].pop():!1},put:function(e,t){return this[e]?(this[e].push(t),!0):!1}})}),game.module("engine.analytics").body(function(){game.Analytics=game.Class.extend({trackId:null,userId:null,init:function(e){if(navigator.onLine&&(!game.device.cocoonJS||game.Analytics.cocoonJS)){if(!e)throw"Analytics id not set.";if(this.trackId=e,game.device.cocoonJS&&game.Analytics.cocoonJS){this.userId=this.guid();var t=new XMLHttpRequest,i="v=1&tid="+this.trackId+"&cid="+this.userId+"&t=pageview&dp=%2F";t.open("POST","http://www.google-analytics.com/collect",!0),t.send(i)}else!function(e,t,i,s,a,n,r){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,n=t.createElement(i),r=t.getElementsByTagName(i)[0],n.async=1,n.src=s,r.parentNode.insertBefore(n,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",e,"auto"),ga("send","pageview")}},guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},event:function(e,t,i,s){if(navigator.onLine&&(!game.device.cocoonJS||game.Analytics.cocoonJS))if(game.device.cocoonJS&&game.Analytics.cocoonJS){var a=new XMLHttpRequest,n="v=1&tid="+this.trackId+"&cid="+this.userId+"&t=event&ec="+e+"&ea="+t;"undefined"!=typeof i&&(n+="&el="+i),"undefined"!=typeof s&&(n+="&ev="+s),a.open("POST","http://www.google-analytics.com/collect",!0),a.send(n)}else ga("send","event",e,t,i,s)}}),game.Analytics.id="",game.Analytics.cocoonJS=!1}),game.module("game.main").require("engine.physics","game.assets","game.levels","game.title","game.bee","game.flower","game.ui").body(function(){SceneGame=game.Scene.extend({activeBee:null,flowers:[],bees:[],score:0,lives:3,level:null,unlockedBees:[],init:function(){"undefined"==typeof game.currentLevel&&(game.currentLevel=0),this.level=game.Levels[game.currentLevel],this.updateUnlockedBees();var e=new game.Sprite(this.level.background);e.anchor.set(.5,.5),e.position.set(game.system.width/2,game.system.height/2),game.system.width>e.width&&e.scale.set(game.system.width/e.width,game.system.width/e.width),game.system.height>e.height&&e.scale.set(game.system.height/e.height,game.system.height/e.height),this.stage.addChild(e),this.world=new game.World(0,0),this.flowerContainer=(new game.Container).addTo(this.stage),this.shadowContainer=(new game.Container).addTo(this.stage),this.pathContainer=(new game.Container).addTo(this.stage),this.beeContainer=(new game.Container).addTo(this.stage),this.fgContainer=(new game.Container).addTo(this.stage),this.uiContainer=(new game.Container).addTo(this.stage),this.pauseContainer=new game.Container,this.gameoverContainer=new game.Container;for(var t=0;t<this.level.flowers.length;t++){var i=new Flower(this.level.flowers[t][0],this.level.flowers[t][1],this.level.flowers[t][2]);this.flowers.push(i)}var s=new game.Sprite("flare_bg.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2,-100),game.config.useBlendModes&&(s.blendMode=game.blendModes.ADD),s.scale.set(4,4),s.alpha=0,this.fgContainer.addChild(s);var a=new game.Tween(s);a.to({rotation:2*Math.PI},6e4),a.repeat(),a.start(),this.addTween(s,{alpha:.5},4e3,{easing:game.Tween.Easing.Quadratic.InOut,repeat:1/0,yoyo:!0}).start();var n=new game.Sprite("flare_fg.png");n.anchor.set(.5,.5),n.position.set(game.system.width/2,-100),game.config.useBlendModes&&(n.blendMode=game.blendModes.ADD),n.scale.set(4,4),n.alpha=.5,this.fgContainer.addChild(n);var a=new game.Tween(n);a.to({rotation:2*-Math.PI},6e4),a.repeat(),a.start(),this.addTween(n,{alpha:0},4e3,{easing:game.Tween.Easing.Quadratic.InOut,repeat:1/0,yoyo:!0}).start();var r=new TilingSprite("clouds_big.png");this.fgContainer.addChild(r.container),this.addObject(r),this.scoreText=new game.BitmapText(this.score.toString(),{font:"Fredoka"}),this.scoreText.position.set(180,20),this.uiContainer.addChild(this.scoreText);var o=new game.BitmapText("Score:",{font:"Fredoka"});if(o.position.set(50,20),this.uiContainer.addChild(o),this.level.scoreToUnlock&&game.Levels[game.currentLevel+1]&&game.Levels[game.currentLevel+1].locked){var h=new game.BitmapText("Unlock next level: "+game.getScoreText(this.level.scoreToUnlock),{font:"FredokaSmall"});h.position.set(50,70),this.uiContainer.addChild(h)}var l=(new UiButton(2,"Pause",game.system.width-80,80,this.pauseGame.bind(this)).addTo(this.uiContainer),new game.BitmapText("Lives",{font:"Fredoka"}));l.position.set(game.system.width-284,600),l.scale.set(.8,.8),this.uiContainer.addChild(l);var d=new game.Sprite("LivesStart.png");d.position.set(game.system.width-189,595),this.uiContainer.addChild(d);var u=new game.Sprite("_TimerGaugeBG.png");u.position.set(14,game.system.height-400-5),this.uiContainer.addChild(u),this.timerBg=new game.Graphics,this.timerBg.beginFill(7600014),this.timerBg.drawRect(0,-274,15,274),this.timerBg.position.set(64,557),this.uiContainer.addChild(this.timerBg);var c=new game.Sprite("_TimerGaugeFrame.png");c.position.set(14,game.system.height-400-5),this.uiContainer.addChild(c);var m=new game.Graphics;m.beginFill(723753),m.drawRect(0,0,game.system.width,game.system.height),m.alpha=.5,m.hitArea=new game.HitRectangle(0,0,game.system.width,game.system.height),m.interactive=!0,m.click=m.tap=function(){},this.pauseContainer.addChild(m);var g=new game.Sprite("PanelSmall.png");g.anchor.set(.5,.5),g.position.set(game.system.width/2,game.system.height/2),this.pauseContainer.addChild(g);var p=new game.BitmapText("Paused",{font:"FredokaTitle"});p.position.set(game.system.width/2-p.textWidth/2,180),this.pauseContainer.addChild(p);new UiButton(3,null,game.system.width/2+230,170,this.resumeGame.bind(this)).addTo(this.pauseContainer),new UiButton(1,"Restart",game.system.width/2-70,300,function(){game.system.setScene(SceneGame)}).addTo(this.pauseContainer),new UiButton(1,"Play",game.system.width/2+70,300,this.resumeGame.bind(this)).addTo(this.pauseContainer),new UiButton(2,"Mainmenu",game.system.width/2-100,450,function(){game.system.setScene(SceneTitle)}).addTo(this.pauseContainer);if(game.Audio.enabled){var f=new UiButton(2,"Soundon",game.system.width/2,450).addTo(this.pauseContainer);f.callback=game.toggleSound.bind(this,f.container),game.audio.musicMuted&&(f.container.alpha=.5)}var v=(new UiButton(2,"Howplay",game.system.width/2+100,450,this.showHowTo.bind(this)).addTo(this.pauseContainer),new game.Sprite("HorizontalSmall.png"));v.position.set(game.system.width/2-v.width/2,380),this.pauseContainer.addChild(v);var y=new game.Sprite("PanelLarge.png");y.anchor.set(.5,.5),y.position.set(game.system.width/2,game.system.height/2),this.gameoverContainer.addChild(y);var x=new game.Graphics;x.beginFill(16777215),x.drawRect(0,0,game.system.width,game.system.height),this.stage.addChild(x);var w=new game.Tween(x);w.to({alpha:0},800),w.easing(game.Tween.Easing.Quadratic.Out),w.onComplete(this.startGame.bind(this)),w.start(),this.gameTotalTime=this.level.time,this.gameTimeTimer=this.addTimer(1e3,this.updateTimer.bind(this),!0),this.gameTimeText=new game.BitmapText(this.getTime(this.gameTotalTime),{font:"FredokaTime"}),this.gameTimeText.position.set(36,595),this.uiContainer.addChild(this.gameTimeText),this.gameTimer=new game.Timer},getTime:function(e){e=Math.round(e);var t=Math.floor(e/60),i=e-60*t;return 10>i&&(i="0"+i),t+":"+i},updateTimer:function(e){if(!this.ended){e&&(this.gameTotalTime+=e);var t=this.gameTotalTime-this.gameTimer.time()/1e3;0>t&&(t=0);var i=Math.round(t);if(this.gameTimeText.setText(this.getTime(i)),5>=i&&i>0){var s=new game.BitmapText(i.toString(),{font:"Fredoka"});s.pivot.set(s.textWidth/2,s.textHeight/2),s.position.set(game.system.width/2-s.textWidth/2,game.system.height/2-s.textHeight/2),this.uiContainer.addChild(s),this.addTween(s,{alpha:0},1e3).start(),this.addTween(s.scale,{x:2,y:2},1e3,{onComplete:function(){game.scene.uiContainer.removeChild(s)}}).start()}10!==i||this.hurryupText||(game.audio.playSound("audio/hurry-up.m4a"),this.hurryupText=new game.BitmapText("ALMOST THERE!",{font:"Fredoka"}),this.hurryupText.position.set(game.system.width/2-this.hurryupText.textWidth/2,game.system.height/2-this.hurryupText.textHeight/2-100),this.hurryupText.alpha=0,this.addTween(this.hurryupText,{alpha:1},500,{repeat:5,yoyo:!0,easing:game.Tween.Easing.Quadratic.InOut,onComplete:function(){game.scene.uiContainer.removeChild(game.scene.hurryupText),game.scene.hurryupText=null}}).start(),this.addTween(this.hurryupText.position,{y:"-50"},3e3).start(),this.uiContainer.addChild(this.hurryupText),this.addTween(this.timerBg,{alpha:0},500,{repeat:1/0,yoyo:!0}).start()),0>=t&&(this.gameTimeTimer.repeat=!1,game.audio.playSound("audio/time-over-panel.m4a"),this.gameOver(!0))}},startGame:function(){this.beeTimer=this.addTimer(1e3*this.level.beeSpawnInterval,this.spawnBee.bind(this),!0),"number"==typeof this.level.queenSpawnInterval&&this.addTimer(1e3*this.level.queenSpawnInterval,function(){game.scene.shouldSpawnQueen=!0},!0),this.spawnBee(),"number"==typeof this.level.speedUpInterval&&this.addTimer(1e3*this.level.speedUpInterval,this.speedUp.bind(this),!0)},speedUp:function(){this.beeTimer.target=Math.max(1e3,this.beeTimer.target-1e3*this.level.speedUpAmount)},pauseGame:function(){for(i=this.timers.length-1;i>=0;i--)this.timers[i].pause();this.gameTimer.pause(),this.paused=!0,this.pauseContainer.alpha=0;var e=new game.Tween(this.pauseContainer);e.to({alpha:1},200),e.start(),this.stage.addChild(this.pauseContainer)},resumeGame:function(){for(i=this.timers.length-1;i>=0;i--)this.timers[i].resume();this.gameTimer.resume(),this.paused=!1,this.stage.removeChild(this.pauseContainer)},addScore:function(e){if(this.score+=e,this.scoreText.setText(game.getScoreText(this.score)),this.score>=this.level.scoreToUnlock&&game.Levels[game.currentLevel+1]&&game.Levels[game.currentLevel+1].locked){game.Levels[game.currentLevel+1].locked=!1,game.audio.playSound("audio/level-unlocked-panel.m4a");var t=new game.BitmapText("LEVEL UNLOCKED",{font:"Fredoka"});t.pivot.set(t.textWidth/2,t.textHeight/2),t.position.set(game.system.width/2,game.system.height/2),t.alpha=1,this.addTween(t,{alpha:0},3e3,{onComplete:function(){game.scene.uiContainer.removeChild(t)}}).start(),this.addTween(t.scale,{x:2,y:2},3e3).start(),this.uiContainer.addChild(t),this.saveLevelData()}this.updateUnlockedBees()},updateUnlockedBees:function(){for(var e,t=0;t<this.level.bees.length;t++)e=this.level.bees[t],"undefined"==typeof e.scoreToUnlock&&(e.scoreToUnlock=0),this.score>=e.scoreToUnlock&&-1===this.unlockedBees.indexOf(e.name)&&this.unlockedBees.push(e.name)
},saveLevelData:function(){for(var e=0;e<game.Levels.length;e++)game.storage.set("levelData"+e,game.Levels[e].locked)},spawnBee:function(){if(!(this.ended||this.spawningQueen||this.bees.length>=this.level.maxBees)){if(this.shouldSpawnQueen)return this.spawnQueen();var e=new Bee;this.addObject(e),this.bees.push(e)}},spawnQueen:function(){this.shouldSpawnQueen=!1,this.spawningQueen=!0;var e=game.system.width/2,t=game.system.height+200,i=-Math.PI/2,s=3,a=new Bee(e,t,"Queen",i);this.addObject(a),this.bees.push(a);for(var n=1;s+1>n;n++)this.addTimer(2050*n,function(){var s=new Bee(e,t,"TwoBanded",i);game.scene.addObject(s),game.scene.bees.push(s)});this.addTimer(2050*s+1e3,function(){game.scene.spawningQueen=!1,game.scene.beeTimer.reset()})},spawnLine:function(e,t,i){if(this.activeBee){game.audio.playSound("audio/line-draw-blip.m4a");var s=new game.Sprite("LineDrawSegment.png");s.position.set(e,t),s.anchor.set(.5,.5),s.rotation=i,s.scale.set(3,3),s.alpha=0,this.activeBee.pathContainer.addChild(s),this.addTween(s,{alpha:1},300).start(),this.addTween(s.scale,{x:1,y:1},300,{easing:game.Tween.Easing.Elastic.Out}).start()}},spawnReticle:function(e,t){if(this.activeBee){var i=new game.Sprite("TargetReticle_ADD.png");i.anchor.set(.5,.5),i.position.set(e,t),game.config.useBlendModes&&(i.blendMode=game.blendModes.ADD),this.activeBee.pathContainer.addChild(i);var s=new game.Tween(i);s.to({rotation:2*Math.PI},5e3),s.repeat(),s.start();var i=new game.Sprite("TargetReticle.png");i.anchor.set(.5,.5),i.position.set(e,t),this.activeBee.pathContainer.addChild(i);var s=new game.Tween(i);s.to({rotation:2*Math.PI},5e3),s.repeat(),s.start()}},showLeaderboard:function(){new LeaderBoard(function(){game.scene.stage.addChild(game.scene.gameoverContainer),game.scene.gameoverContainer.alpha=0,game.scene.addTween(game.scene.gameoverContainer,{alpha:1},200).start()}).addTo(this.stage)},hideGameOver:function(e){this.addTween(this.gameoverContainer,{alpha:0},200,{onComplete:function(){game.scene.stage.removeChild(game.scene.gameoverContainer),e()}}).start()},showSubmit:function(){this.gameoverContainer.removeChild(this.submitButton.textSprite),this.gameoverContainer.removeChild(this.submitButton.container),this.submitContainer=new game.Container,this.submitContainer.alpha=0,this.stage.addChild(this.submitContainer);var e=new game.Sprite("PanelLarge.png");e.anchor.set(.5,.5),e.position.set(game.system.width/2,game.system.height/2),this.submitContainer.addChild(e);var t=new game.BitmapText("Submit score",{font:"FredokaTitle"});t.position.set(game.system.width/2-t.textWidth/2,130),this.submitContainer.addChild(t);var i=new game.Sprite("HorizontalSmall.png");i.position.set(game.system.width/2-i.width/2,190),this.submitContainer.addChild(i);var s=new game.Sprite("NameUnderline.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2,258),this.submitContainer.addChild(s);var a=new game.BitmapText("",{font:"FredokaTitle"});a.position.set(game.system.width/2,210),this.submitContainer.addChild(a);var n=(new UiButton(4,"ButtonSubmit.png",game.system.width/2,485,function(){n.input.length<3||game.scene.submitScore(n.input,game.scene.score,this)}).addTo(this.submitContainer),new Keyboard(game.system.width/2,300,function(){a.setText(n.input),a.updateTransform(),a.position.x=game.system.width/2-a.textWidth/2}).addTo(this.submitContainer));this.addTween(this.submitContainer,{alpha:1},200).start()},submitScore:function(e,t,i){this.submitContainer.removeChild(i.container);var s=new game.BitmapText("Sending...",{font:"FredokaText"});s.position.set(game.system.width/2-s.textWidth/2,465),this.submitContainer.addChild(s),game.db.sendScore({name:e,score:t.toString()},function(e){e.error?game.scene.submitContainer.removeChild(i.container):game.scene.addTween(game.scene.submitContainer,{alpha:0},200,{onComplete:function(){game.scene.showLeaderboard()}}).start()})},showHowTo:function(){this.stage.removeChild(this.pauseContainer);var e=new game.Graphics;e.beginFill(723753),e.drawRect(0,0,game.system.width,game.system.height),e.alpha=.5,e.hitArea=new game.HitRectangle(0,0,game.system.width,game.system.height),e.interactive=!0,e.click=e.tap=function(){},this.stage.addChild(e);var t=new HowToPlay(function(){game.scene.stage.removeChild(t.container),game.scene.stage.removeChild(e),game.scene.stage.addChild(game.scene.pauseContainer)}).addTo(this.stage)},gameOver:function(e){if(!this.ended){this.ended=!0;for(var t=this.bees.length-1;t>=0;t--)this.bees[t].collecting&&this.bees[t].flyOff(),this.bees[t].kill();var i=new game.Graphics;if(i.beginFill(723753),i.drawRect(0,0,game.system.width,game.system.height),i.hitArea=new game.HitRectangle(0,0,game.system.width,game.system.height),i.interactive=!0,i.click=i.tap=function(){},i.alpha=0,this.stage.addChild(i),this.addTween(i,{alpha:.5},200).start(),this.score>game.bestScore&&(game.bestScore=this.score,game.storage.set("bestScore",game.bestScore)),e){var s="Level complete!",a=new game.BitmapText("Your score: "+game.getScoreText(this.score),{font:"FredokaText"});if(a.position.set(game.system.width/2-a.textWidth/2,210),this.gameoverContainer.addChild(a),this.score>0){this.submitButton=new UiButton(0,"AddName",game.system.width/2-80-35,300,this.hideGameOver.bind(this,this.showSubmit.bind(this))).addTo(this.gameoverContainer);var a=new game.BitmapText("Submit score",{font:"FredokaText"});a.position.set(game.system.width/2-60,280),this.submitButton.textSprite=a,this.gameoverContainer.addChild(a)}var n=new UiButton(4,"buttonleaderboard_big.png",game.system.width/2-120-30,380,this.hideGameOver.bind(this,this.showLeaderboard.bind(this))).addTo(this.gameoverContainer);n.bgSprite.scale.set(.55,.55),n.container.hitArea=new game.HitRectangle(-n.bgSprite.width/2,-n.bgSprite.height/2,n.bgSprite.width,n.bgSprite.height);var a=new game.BitmapText("View Leaderboard",{font:"FredokaText"});a.position.set(game.system.width/2-100,360),this.gameoverContainer.addChild(a)}else{var s="Game Over",a=new game.BitmapText("You ran out of lives",{font:"FredokaText"});a.position.set(game.system.width/2-a.textWidth/2,220),this.gameoverContainer.addChild(a);var a=new game.BitmapText("Try again!",{font:"FredokaText",align:"center"});a.scale.set(.9,.9),a.position.set(game.system.width/2-a.textWidth/2,320),this.gameoverContainer.addChild(a)}if(e&&game.Levels[game.currentLevel+1]&&!game.Levels[game.currentLevel+1].locked){new UiButton(2,"PlayNext",game.system.width/2+100,490,function(){game.currentLevel++,game.system.setScene(SceneGame)}).addTo(this.gameoverContainer),new UiButton(2,"Mainmenu",game.system.width/2-100,490,function(){game.system.setScene(SceneTitle)}).addTo(this.gameoverContainer),new UiButton(2,"Restart",game.system.width/2,490,function(){game.system.setScene(SceneGame)}).addTo(this.gameoverContainer)}else if(e&&game.Levels[game.currentLevel+1]&&!this.level.scoreToUnlock){new UiButton(2,"Locked",game.system.width/2+100,490,function(){var e=new game.Sprite("Level4Locked_Info.png");e.anchor.set(.5,.5),e.scale.set(0,0),e.position.set(game.system.width/2+100,300),game.scene.stage.addChild(e),game.scene.addTween(e.scale,{x:1,y:1},800,{easing:game.Tween.Easing.Elastic.Out}).start(),this.callback=function(){}}).addTo(this.gameoverContainer),new UiButton(2,"Mainmenu",game.system.width/2-100,490,function(){game.system.setScene(SceneTitle)}).addTo(this.gameoverContainer),new UiButton(2,"Restart",game.system.width/2,490,function(){game.system.setScene(SceneGame)}).addTo(this.gameoverContainer)}else{new UiButton(2,"Mainmenu",game.system.width/2-50,490,function(){game.system.setScene(SceneTitle)}).addTo(this.gameoverContainer),new UiButton(2,"Restart",game.system.width/2+50,490,function(){game.system.setScene(SceneGame)}).addTo(this.gameoverContainer)}var r=new game.BitmapText(s,{font:"FredokaTitle"});r.position.set(game.system.width/2-r.textWidth/2,138),this.gameoverContainer.addChild(r);var o=new game.Sprite("HorizontalSmall.png");o.position.set(game.system.width/2-o.width/2,190),this.gameoverContainer.addChild(o);var o=new game.Sprite("HorizontalSmall.png");o.position.set(game.system.width/2-o.width/2,430),this.gameoverContainer.addChild(o),this.activeBee&&(this.activeBee.clearPath(),this.activeBee=null),this.gameoverContainer.alpha=0;var h=new game.Tween(this.gameoverContainer);h.to({alpha:1},200),h.start(),this.stage.addChild(this.gameoverContainer)}},mousemove:function(e){if(this.activeBee&&(!this.activeBee.touchEvent||e===this.activeBee.touchEvent)){var t=~~e.global.x,i=~~e.global.y;if(this.activeBee.path.x.length>=2){for(var s,a=0;a<this.flowers.length;a++)this.flowers[a].container.scale.set(1,1),!s&&Math.distance(t,i,this.flowers[a].container.position.x,this.flowers[a].container.position.y)<=this.flowers[a].radius&&(s=this.flowers[a]);s?(this.targetFlower!==s&&game.audio.playSound("audio/button-rollover.m4a"),this.targetFlower=s,s.container.scale.set(1.1,1.1)):this.targetFlower=null}if(this.activeBee.path.x.length>0)var n=this.activeBee.path.x[this.activeBee.path.x.length-1],r=this.activeBee.path.y[this.activeBee.path.y.length-1];else var n=this.activeBee.sprite.position.x,r=this.activeBee.sprite.position.y;if(!(game.Math.distance(t,i,n,r)<30)){if(this.activeBee.pathLength>=50)return this.endPath(t,i),void(this.activeBee=null);if(this.activeBee.pathLength++,this.activeBee.path.x.push(t),this.activeBee.path.y.push(i),1===this.activeBee.path.x.length){var o=Math.atan2(this.activeBee.path.y[0]-this.activeBee.sprite.position.y,this.activeBee.path.x[0]-this.activeBee.sprite.position.x);this.activeBee.dirVector.x=Math.cos(o),this.activeBee.dirVector.y=Math.sin(o)}this.spawnLine((n+t)/2,(r+i)/2,Math.atan2(r-i,n-t))}}},mouseup:function(e){if(this.activeBee){if(this.activeBee.touchEvent&&e!==this.activeBee.touchEvent)return;if(this.activeBee.path.x.length>=1){var t=~~e.global.x,i=~~e.global.y;this.activeBee.endPath(t,i)}else this.activeBee.clearPath();this.activeBee=null}},update:function(){return this.paused?void(game.tweenEngine&&game.tweenEngine.update()):(this.ended||(this.timerBg.scale.y=(this.gameTotalTime-this.gameTimer.time()/1e3)/this.gameTotalTime),void this._super())}}),game.Loader.inject({backgroundColor:16777215,initStage:function(){var e=new game.Sprite(game.Texture.fromImage("media/paper.jpg"));e.anchor.set(.5,.5),e.position.set(game.system.width/2,game.system.height/2),game.system.width>1024&&e.scale.set(game.system.width/1024,game.system.width/1024),game.system.height>672&&e.scale.set(game.system.height/672,game.system.height/672),this.stage.addChild(e),this.barBg=new game.Sprite(game.Texture.fromImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAToAAAAwBAMAAABzgKu9AAAAFVBMVEUAAABgKjdgKjdgKjdgKjdgKjdgKjcs5IgKAAAABnRSTlMAcRLJ9kWKKg8RAAAAd0lEQVRYw+3YOwqAMBAA0fjBWhS8n0b2/kewjAGLlBOcd4Ih22w2Sfo27gGSt1Q5gmVNL0PAnOSnqx5vDJwLPNhqtFPg5FI3B0+pW4LHOusaWAdinXUNrAPppQ64Qd29bJ/szZ3962H/GHmjPfu5VMCvPJIk6XceXKXTdRn0VJkAAAAASUVORK5CYII=")),this.barBg.anchor.set(.5,.5),this.barBg.position.set(game.system.width/2,game.system.height/2),this.stage.addChild(this.barBg),this.barFg=new game.Graphics,this.barFg.beginFill(game.Loader.barColor),this.barFg.drawRect(0,0,game.Loader.barWidth,game.Loader.barHeight),this.barFg.position.set(game.system.width/2-game.Loader.barWidth/2,game.system.height/2-game.Loader.barHeight/2),this.barFg.scale.x=this.percent/100,this.stage.addChild(this.barFg),this.barFrame=new game.Sprite(game.Texture.fromImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAToAAAAwCAMAAAC2cEa8AAADAFBMVEUsR0DTkTctR0FKTTbTkTfz03zz03zz03zTkTcAAAA/QCq4fzIsR0A6KxdVNwwpMkssR0AsR0A5KhacbCw3KRYzPTlUNw01QzZxXzogAGNqWDQsR0AsP0NbNABiUjB6aEAsR0BbNAA9LRi/qnpbNABOQCasmGtURSo3NzW3o3Q4KhgyLEJcTC7y0nuIc0bx0nsuRT1bNABbNADx0XosR0AmJ1IsR0Dz03ygjmWvmGVbNAC8n1rEsH9bNACEXCdbNABaNAGxlVQtIE7z03xZNARbNABDNh9aNAGpiETBqWxdNgRaNABaNQKijV6Id1FaNAFzY0ZILhw4E0cgBWLMrF5EMxiVf07KtYNdTSzTkTfPuH4hEls6HzjEqmPOs2h1YzlSJhtBNybmz5CXgUvu1ZZ3VCTIsnhCOyVoTyY0JxVbNABbNQA0JxUaAGb756n35bHy0Xz646P25KdlPQb214jx2pXUjDnDbBTLdx724KPz2I/ZiDHHbhT857HuzXj13p7225T335lcNQD34azbjzvz4qbNfSXQeR3t1ZDwy2/57MPx25v21YH44Z7y36Lu3J/VfB4+EDn977v36bnAaA/y3p/w0oUzBkxVKwr/67fr1pry363rzoXGchvPiDH778nSgyzKplhDFjDLcRQnAF9HGyc4C0Plzo330neeVS3MgC1pQw0sAlb867ByThrRl0FNIRr624royX/isljVgSbrx2/r2J/vxmXTvX+3oGrKijuRTTepkl/qw2iASwnv3KXbrVPn05WnYBUfAGjmxXWgXBltSBO4nVzXolXjuWDOrmPzz3P8+9aIUQh5RwbZpEjav3EUAHPZtm7+/vzgxoewk1GJdk18WSPKtXmdiV379sbErXfx5LrCpWFQJhLivHbXx4nlvGnFfS3Folbbql2VgFSSbzm7mVLZmUiGYizs26nhwn28eihZNAFxQgOjh01fMSHTwZj7+O2+pm6ucy+tm3dzOTR0Ox62Yw5oWT7o48+RVg2cf0Hq59/QxrFWOhwEUywtAAAAaXRSTlOAEIADKA8nLi8ACzZw4iiYaVPtQfaRMRPW/ttgiTrhznZH1swb9tPum8/9puhlxXIgYYExe6hCPdj+xsrK8k76l866Um2y/ejQylbg1dfj6/rw7+7CxdvGvxvF1tR1NnP9r72d1ULpeO5dv9ZSAAAV+ElEQVRo3nxQQY7kIAxciRMcfHROHJD4AByRouRA1BIg5R/hF7x8C9o7s+pZrbtjsMtlF/6lfxh5RWZelDLGbEwc8ow3ozQ5R0yWnDVwXiv2SmsmbwNppa1DshRN2VNAqTeuACMbrLUcvFGImAuRUWy9t+AW6xwXz2Qc6Y0Nu/mB4zXGgFxciTnnGIsL+bxyiDmiiBx0heIJNJ+ti05DAYHFjtDTcylsLEMZunmoX6a9i1ewmyJrHQAikBhBccxhitYmBybe8HiUwwwpT/qHfa4OjXuvPV0pnjW1Wu/+4HdfZxp7u56OYGaeF86R0nO80jnjp7eWkJq319H3HWfvO5DxJkx/p9UN91frz34/qSI9Udj9PPXo9wSPWb6nd1/xy6QY6F/R0Y6l6rrq1XuTjjtScFI3jv21TAbudbEH3I3UGiIyL3lyrS3VM2IVHRXR+f+tbjvb7CIGvpwz+QaGyEYsb5BdyDmE9UeGrOxN+tzEAD4W96uLsIUjQ2XQCj7qvnf5ja6/fCJMnCRF2Zr+NUZqoUd64ToQTROwndu/V8e/yaae1kaBKP4t9hPsJ+htFxbyeSxM1ImHekjjgGBIsoEWPYRA8eTC4IBCipdShOCCuYhkMTSEFkIFyWEppZfQw/40ssvu/mbem/fHN/Pmx3j2+ctpX9Zs0gIWT6goikoU1bs4ZwkXCNCKJkyUJTJlyRNBJVpUBT3nLGGS4JJIJMaSBA4XlCNLKZeSoqg9GElRUSoELQvGKGMcJbxgvBC84KwWKqioEgkLZ4ydiGPsxAYmZZyjEFfFEUklsP85LcuqFKhCEp5Amhc4V+LsN9fNgqr6Cxgta62gFTSXoK0EJQzdov2W0aYSP8LZh/+p64Dl9jGIqsIdwMt7WX7abra35m3XJz5A1Dg2p+pXEnv+bPqkEt++IIRMbTXexCoh3pPt2VHkTzfqLFp7ikK8aETikbeJvVkcKYSMFM+yIkNRFMvTrPXEsCJvvbYizbOMtWUYuhEeHD08hL1wrs+z+WCu54d8l6a73ff8kOU/3ncpRpgfwjxM92k+HmfLsez2l+5jAPSCwJkvnWX2GMh5Lgdhf5nK6X6/d6Ggc3fvuvs87C3T1K0jUC2QSPMsy6Lt6+t2u9lET9H2ZwkiiqoSrH3kTOr8S12nedX8+e3leLx5uPK79yaIIhDz3gQpRFVNszZagIULpYY9izFsLKPJxL40LicNRhpgaYgCE8MwNA3qDwaaZVm6rg8GgyDA7PWc3unmta7hzMfQkDrgOLABmIi1kOVvLVa19PtyE5T7SLSpNlurxd3dYjFcDRfD2jsB1nAFZ4go1Goly47jeEA8m5rd6+uub953/auHm+Px5e2ZN++08xd1H3+RVf4qbgNBGH+Me4G8y5X3Jt6LyBUyKHIQC4lkryHChosOXKbKFYbYaYJIc5U6tVtc7XQuD2zu90mLdH9+7Ixmd1bG+nZGupSo9+fj8di2x7b5LsqylPOeAIxn/o7SHA5VZUrs9rY0iTGGMMERHMixkPzqIampyKx1brl0nfyLxccFiqdFOiiLogg/uyHSEfykVGeU6UzrCP51Nh3RESD03R1PjQeEfsd6uyVBSSqHae86uC1w4Zj4uZtitXLOWmPKPA+P3LTogjjne+l0+WGQDuWk5sNTow2nU7PZ5Ay/AQJcnnuP00TTt2xewlYR7hkpA973vtKhBqR0llWQAWInSbdGpOShGr3IhOZ9UMnqCqvrXS2yHktobWbj2Ll4gESkbL0TdRzvfqxYThlss65I0zjKDNLxYB5jNKeTtGmeHtSdaBeku7jqPjjnpm3bxqyoA7qTP5FMJgyaExZFEVpRdTAFSkB8ketjCmA68EmEy5qjxa5HPjMEvndjYs7h07hzimD+gnFDb9xDq6nZACd+y2jLfkKHduxH/u6HjepcsX/Nt+v1/z+Pj/92tVvW0SRBBhtFejGZTp5z92W5ugjSPZNUxagRxDDwXXpA+vtMvpEvhK3SpfaAiusMqc/CwiwsLMalC30gI26QmBlJ9egjA/D34ur76zMT/BpuZtJh7lrKgE5TV5mu8PHzKqOXPkq5XgxTUnoOBisCkQQJUZGIDsF0KCEODhUImE9zEYV6BO0UyHx4mGsegCubCDV7pFJwPVV3thFb6xvnyU56C1ZrrdZNWdu5Nx393n/Haqu1te6Dg5uSJl/GWsfzebMPvg+iVnVH9EIydDGzf928/QAYKI2lffOBYfdgHagydYUEHR+I/XLHjf6uWaXAwr976tNMvEBLK3OYAQDXVYzaQBADf5B6UDFbiYEg7hn7HBsXqQ3GVVIEDGnS+Rdx4zdcmdJNivwiIxeBREjalTQsO2KL1Xz8y8/xP/l6e/FX4un9+fXz47tf2sO9dR4fDtfj+bau29Nmt7+koak5FZqZCbAyp1LKVGUsywBax7LY2S9t3rUBnQtwsCKcA0NEsYoKeEEAklKsVgxQaWzOQpYlIkimCGZOUgog5JpkS4sYLKMaGrBiIO7esbPqiMNnFY0qDVdA2g02PBrVd7dZfjmYkUkXgWzS0X24N+Sy321O23W9nY/Xg4eLbt0PO3bM0jwQx3E8RZM+cZZuXUQQhBA0Q0AQhKt7uqVD28Hpn4N2KBxCyRYXx2Q6g6K4ubiISAedCkfpJBk0i4OCMbgU4pDt+RcfSnlew31fwodfcsfVKPUGTGS3kzTt9c5KwLq21elUZVinY9ldwMqzXi9NJ7eZYAOP0pqurB3i/MZD8c6i1OehA9B027ZtVWX/smy77TYBnJD7acTexXCMZIdrSg2vdPSbBcdJGvvhDGDLNAwi6ZbpiGGYWwCz0I/T5Dhg3/Pnj5qy43ne4JLdjaKIc15C0zRNSfc/HaI0oUSgKBrdscsBou0ouzi6x2Fw/TzFayiO7sjEDEm3TGeY2BHODu/q0+frYPiIs9tFOkrHjJ0np3nsvwK0f+k02aJfujbAqx/np8k5Y2NKke4AV1dkwc1TGHPuwLYxj1RV2aIqMeZtg8N5HD7dBFmBqztQGvjZFll2EUe4RgdcdCPE0iuyRbpFCOq54OA/LYovsqxAtIZS38fVCcFO4rzv/4BLiG1X1daqbFFLrdo2IS78+P08PmFC4Or268rmHqXFx2R0H/U5n8E6HhCaurL6R7ZodUXV8LBYhxnn/eh+NPkoKN3bVPQG9Qrx8pmkPuc5QFfTVL0i6ZbpKrqqaV2AnHM/TT5fROHRhq7odY9+XT2It6mPpiVs4OYqLUm3TNeq4O42oOwj3fRNPFx9Ua+OdPpfdq0eNJEgCrcHyzab5bjmGheGjFXSbbKLIATZPbKLhT9gGZJCBS/iWVicCjYHJiwkGHBjb5XmwnkhVQQJCkKCmEYIEiJpEkhlf9/bjTmOu/K6u8/MzHvfeztvZ4jizud6poCT/tmkib3DF7v4yv+t+33rVuJpvF+xRZPZ18dRIbPunZysZjM3U7ffHtYOms05HnSXN3ZCwhsBf6ElQUC3JPydexB+9QQ0epG9JCyhDkD8SxwOTHDoiUUGBgF8iHJhoIHzpkEQJhjY6PyU0Ac0eOD8Kn41CsKAT7TfKLYAVSBmsQs7G8vYlnmzeVAbtvvu9CaTXfW27n02czkaP95PTnKHteN5JE2QRFmWZBhyEF1QlEQRTaIhQIMUCJAlLgbA6xY2SECiNN+TZFGUxQAmgClRgBivTDwgUiUfMui4iATiRFkSqTyuQB5F5WBQfs1Eg0NzSz5JDCZPw/sJeBLiqChjITLm9klcC5DnM0G6TW+h8uJYksqKCAKR+XHtMHcyuX8cjy4z2ff+KfFmJvsw6vZnw3qbTsjXIul/F3Lwj3RkjfSjdn0463dHD9nM5ssBO50APF8Xz6eTVpkEvNZ4W1W5GrVZ1FZV1bZtVeeKris6BlMztXBYC5sxE2BKiisK57qSVBAGuJKEycECjMHUMbw0UBRjjCNNVZOcKSpjWzrnKkMVzizLVHhqK2XqZooznuJ6Esk0Pa5QbW8ezlQ7oaoWg814wkI2bsRK4GVaFgubpqVp4YSdMAz7XcJIGGED92tosZhhGJqhaRjBAFhIOBbTEKEVaTGMXohZmAsLjzI7io1Qt8ct0jDLrcn0vHj9TM/+C0UMv9Qo3J61n6bDXDUPNQofh57YBJPgM59z+eqnvV1Ilbt70Fx2scnVSoN0pEoln8e5PKxSpe4SGiVE8qVSw2k4Hdd1Go085KGS03VLYEuO0yG2A7fRQdBxnHqj7na7X9qQDUmihYJYhzIFDddFiTxh30OFUKzsIwTtseijugD+NY6OfC2WRB0f39EGp4PBHQk+UIMQBHq93l2vVy5/g++lDy4urq6uLk5P92uQszzkPL3tI1YPJ1/NDadP7bPbAn6W8iomvsUj2Q8mzWi1USAMo2+x77FvsO8TaHbbVZqwNVmKwUWiF8VcyGxgr4SWMOBgLoQQA0JjKRhKoFAK1iJEaB9iz1hKezATM5HROf5DCJ9X1/sobR5uz2zit2N7uSSv7oYgvQ5GI0fElkWOZHVwztl4NJqykaAOYIRD5ucz3wCDbAEJHlZC3+cLINv0BtofLfI8e+AvSflgoMGcM0TaEAFjeAvAQ2yNXU5kMKJBn0CZwXGu6wxd551Y/NTWYrL+JMnrerVSmSrYQGmyFVdd/7FwlCS86rpOEvqKVVIrjsneUarOZ0ND3663PPB8jYlzpJzdPjRptL++4k//l48IWz+r1DvsIymjx4sFOT8ZGiEaMdrvMVe0gzyxgF1uF2mwE4auJtQgIvA98L1jAD7T2hrPZke/fLBpuRd6cFqbXdB4vmvAuIuvaQxns2F0fzBwYqwJYYyil3hTNT+mg9xsiu22rURsiLtcxHFUVXn+fVZnd9sWa/OyKNJnWcq2vHyW6ak0J2bcplspGyXnmZy32zYrlTkp28nlXM5BdpSaDOPUI1NEoJ7Ecs3lLy4etZ39oYeqb5/T/x49J/eHp5vXtArt/qLfX3T1NmU6wxmQhOpq2+3E0DECyilwXRYaRUVLjq/VsQzxBCjkneUZLv3uoQtPG/TXHAHemv7O3OLoyPa6TsZw/VAvVOoNJe6GLDQIN/4xVToVRvBShZHmTgSiqpzqectv2pQqNHIh8mFdWzllpZIiSVS5atJ/u6IoVWHOpUqsVopcNpalzGZyaWV/m0K1Sv06VeXcLJUqsWZ+EkcpsqxnM1YB8o766LDDKn29eTrcnyCq95H+w9ee5uQ/mWaMGzkMA8Bn3DvuEXlRAJuAXBp068ItDQLqlFaVywABFvnFGVdcsQ/YIsUNrT1fNhmIFEVRXInwurE+3i9dlnX8T9d1a0rJS9Gg+HrSAeozbcm59LRCNsYIKsAVLawN9u1Ita6JxKWsZSe/l46I0jFS9U51K0WKmjohBLjgLiLsTdRVRNEmgpi4ZJGqHjPVjzkXcx1UrbecxfrB6PPQL70Vsq3ucUiRSBE/SBX5//76/WccV8nd5f2D1xz8/HJdp92fetkuY6p1nmSCGSE39EMOI8M0z2ImdEQRJs1kRXMxFU6Z7xwRzR+RLe6RqXHaRv5miRmt702ETdiU2RBntR4yZ0YPKATvgsLAg8RuD9f9AMcM0DGPLNAvt9syYCCPRJioVlCda03jZXtpl8wer+vAE06uQD2/vfKNJ4H70TQwq/9QnDwcI6BWT3dwn/he9p1xAce8e3aG1+u1FOaK01095nmEzhSopEpfE1K9CFuoJsVdJeqX1Y1atiqZCV4QW0R6ujjxRMtRnKgctuAMYbFE6WzApHyw3AhpgQg6GMgHqqhJa+yELzmvb8/t3uLTt/t1P/6yae0oksNA1Gy+wUSDbzAw+d6je5h8JvXiyDfQDSqS4kIqaFCgvMFBC4cW+AK6gY2jdoOTffIwyTLP1q/k0qt6cljV59yoDvV/aknjOPZ9edOW0tKnrlvGEbMxrUzrfdu2le57n/aF19RvfZ/S2vU3WPpx2fdlua/zer6zd926mjWNHZ9VdutHKUREA5auU6ZjzDcsUoLnMG4JR4F23O4gQQBlvg/DrWAYLrfL9Xq7XS+X63BYSrsMN6wuwwPW6/WrKyjD96zgsNzQH4vhAr9y4vB4PPDdA0ff79diRDLgTeh3EAw7xEgLokY9ZDN/Vs//SQc8VdXLKeTZ5GyaHErNpMkqOGJyhp0xLjCTnzRbzUKWjIQscbLe2ig0kdbOsjJmNipEthPQtjXa5LWvsamjIy8EyZoPCoEckQ4uE6sgHXPusjjRgUj85A3xoTIO7GZ8E7T2FntWxDM7hZvoGmOCc1k5Z4LXtrURHG0b0erW2vaArY+hxnCMZV17H7XWAt+mUQaEB4qJyLmvpIPKpgSQc1M0mXM4vVTV0w8Fsc+/qqp6fWc2WgcE5ZwjYbJAFE3steizaA4Q4k0Q/Un4zIHkHMgiHRd+O4h5+ns6k/XFx/s6eju1sRWRCEz1BIhA7ogEom21JWmRddT2zZKOdoq2PGwyYje4MAVuyMgxSiR9JEay4LfVYoyBhHNWRUILIvjb+K0WpPsRdSz7CAHcoGGopQKzfTsXIEnEbfFiV8CGEBpcm2F+f4VAv55/KsP+849SK9aJGIahVTducZcMJ3lisuTZfEAWBpDQUTG1A3xAf6J/cBPMiDIx9B/6YzynoEgnL/fOfnmxnMTnZGxTkJKqJM2AJiISSe4FrRMjiRMxqEkioIYZwuNpN2Ix5GE1tjCFMiIzETPLakYFls0lE5yx2o0KRN5yHoesqukP5ISw5tv7l/F8ev1cl/U0z0+P88fDaV1+vr6Hfpr66dgf8eZ6aMy3DbwNtXHb/gK3zV/CeYG/98/LOI7ZCFBAtDBm/10QL6MpuIu/YO9abyt+Ffvc7SJYvPAVaOtYBTjcBOFaS3QU4++I4KIYLqX5IAITJAY33iVZZhBZw8bk18g+KJMEB4Sz1rm7iVt36GpitD5uYRSKk1tYlB93t0oXcV0x2viaqr4oJNotPq07hK0DDr/Vm0HKrTAMhaWdlSDpxA46yRI6KN3/0t7XghQlXOHN/mM0TaK56TnCHZnV4Tv8nhAX9jj+yxlu6pbbJczt7nXCdugwxBFc1r53833fijSnH1/rxKGOMj6Ck/oISTxOr/6NsNnkePYKHuH+L24Zf0i2Z9IR/a91Nk7xKcA5U233wWJw53r3fMMn2Nm1M2Bw3tIv5TH/Vjndb8TeaEPNuomtDjJhmImqVs15uprxQoBRzLViZjoyfkwzrd0047tID6y6WA+d1vN6EM3GR7DDpApnVZpgsmDS713IDSYQ0r3vfW6mwivzJs39v3sLbxbEZGKljZHnrhq0ONR5iKmkmBoo8UaKu/xwKd6L5fc9Ja0kLUpZq1RKSlxa4RJToinLxnOP7gs819p5MkGhDMCqFjLnuK48oUjX64WCI4si2WCJvgSZVM0XIpPFVA6UR7Gag1ZR6zMkUcmMel3jai2le8OlgTnymsyl7o9jKoQDW7npk/M6NDRAO56I1CGJMK71/+AfMZvc9s9PyuAAAAAASUVORK5CYII=")),this.barFrame.anchor.set(.5,.5),this.barFrame.position.set(game.system.width/2,game.system.height/2),this.stage.addChild(this.barFrame)},ready:function(){if(game.Debug.enabled)return this.setScene();var e=new game.Tween(this.barFrame);e.to({alpha:0},800),e.onComplete(this.showLogo.bind(this)),e.start();var e=new game.Tween(this.barBg);e.to({alpha:0},800),e.start();var e=new game.Tween(this.barFg);e.to({alpha:0},800),e.start()},showLogo:function(){this.logo=new game.Sprite("edflogo.png"),this.logo.alpha=0,this.logo.anchor.set(.5,.5),this.logo.position.set(game.system.width/2,game.system.height/2),this.stage.addChild(this.logo);var e=new game.Tween(this.logo);e.to({alpha:1},800),e.onComplete(this.hideLogo.bind(this)),e.start()},hideLogo:function(){this.fader=new game.Graphics,this.fader.beginFill(16777215),this.fader.drawRect(0,0,game.system.width,game.system.height),this.fader.alpha=0,this.stage.addChild(this.fader);var e=new game.Tween(this.fader);e.to({alpha:1},800),e.delay(500),e.onComplete(this.setScene.bind(this)),e.start()}}),game.db=new GBAPI,game.db.setSharedKey("1234"),(game.device.android2||document.location.href.toLowerCase().match(/\?lowmode/))&&(game.System.webGL=!1,game.config.useBlendModes=!1,game.config.useTint=!1,game.config.useShadows=!1),game.start()}),game.module("engine.physics").body(function(){game.World=game.Class.extend({gravity:null,solver:null,bodies:[],collisionGroups:[],init:function(e,t){this.gravity=new game.Vector,this.gravity.x="number"==typeof e?e:0,this.gravity.y="number"==typeof t?t:980,this.solver=new game.CollisionSolver},addBody:function(e){e.world=this,this.bodies.push(e),"number"==typeof e.collisionGroup&&this.addBodyCollision(e,e.collisionGroup),game.debugDraw&&e.shape&&game.debugDraw.addBody(e)},removeBody:function(e){e.world&&(e.world=null,e._remove=!0)},removeBodyCollision:function(e){this.collisionGroups[e.collisionGroup].erase(e)},addBodyCollision:function(e,t){e.collisionGroup=t,this.collisionGroups[e.collisionGroup]=this.collisionGroups[e.collisionGroup]||[],this.collisionGroups[e.collisionGroup].push(e)},removeCollisionGroup:function(e){this.collisionGroups.erase(this.collisionGroups[e])},collide:function(e){if(this.collisionGroups[e.collideAgainst]){var t,i;for(t=this.collisionGroups[e.collideAgainst].length-1;t>=0&&this.collisionGroups[e.collideAgainst];t--)i=this.collisionGroups[e.collideAgainst][t],e!==i&&this.solver.solve(e,i)}},update:function(){var e,t;for(e=this.bodies.length-1;e>=0;e--)this.bodies[e]._remove?("number"==typeof this.bodies[e].collisionGroup&&this.removeBodyCollision(this.bodies[e]),this.bodies.splice(e,1)):this.bodies[e].update();for(e=this.collisionGroups.length-1;e>=0;e--)if(this.collisionGroups[e])for(t=this.collisionGroups[e].length-1;t>=0;t--)this.collisionGroups[e][t]&&"number"==typeof this.collisionGroups[e][t].collideAgainst&&this.collide(this.collisionGroups[e][t])}}),game.CollisionSolver=game.Class.extend({solve:function(e,t){this.hitTest(e,t)&&this.hitResponse(e,t)&&e.afterCollide(t)},hitTest:function(e,t){if(e.shape instanceof game.Rectangle&&t.shape instanceof game.Rectangle)return!(e.position.y+e.shape.height/2<=t.position.y-t.shape.height/2||e.position.y-e.shape.height/2>=t.position.y+t.shape.height/2||e.position.x-e.shape.width/2>=t.position.x+t.shape.width/2||e.position.x+e.shape.width/2<=t.position.x-t.shape.width/2);if(e.shape instanceof game.Circle&&t.shape instanceof game.Circle)return e.shape.radius+t.shape.radius>e.position.distance(t.position);if(e.shape instanceof game.Rectangle&&t.shape instanceof game.Circle||e.shape instanceof game.Circle&&t.shape instanceof game.Rectangle){var i=e.shape instanceof game.Rectangle?e:t,s=e.shape instanceof game.Circle?e:t,a=Math.max(i.position.x-i.shape.width/2,Math.min(i.position.x+i.shape.width/2,s.position.x)),n=Math.max(i.position.y-i.shape.height/2,Math.min(i.position.y+i.shape.height/2,s.position.y)),r=Math.pow(s.position.x-a,2)+Math.pow(s.position.y-n,2);return r<s.shape.radius*s.shape.radius}if(e.shape instanceof game.Line&&t.shape instanceof game.Line){var o=e.position.x-Math.sin(e.shape.rotation)*(e.shape.length/2),h=e.position.y-Math.cos(e.shape.rotation)*(e.shape.length/2),l=e.position.x+Math.sin(e.shape.rotation)*(e.shape.length/2),d=e.position.y+Math.cos(e.shape.rotation)*(e.shape.length/2),u=t.position.x-Math.sin(t.shape.rotation)*(t.shape.length/2),c=t.position.y-Math.cos(t.shape.rotation)*(t.shape.length/2),m=t.position.x+Math.sin(t.shape.rotation)*(t.shape.length/2),g=t.position.y+Math.cos(t.shape.rotation)*(t.shape.length/2),p=(g-c)*(l-o)-(m-u)*(d-h);if(0!==p){var f=(m-u)*(h-c)-(g-c)*(o-u),v=(l-o)*(h-c)-(d-h)*(o-u),y=f/p;if(p=v/p,y>=0&&1>=y&&p>=0&&1>=p)return!0}return!1}if(e.shape instanceof game.Line&&t.shape instanceof game.Circle||e.shape instanceof game.Circle&&t.shape instanceof game.Line){var x=e.shape instanceof game.Line?e:t,s=e.shape instanceof game.Circle?e:t,o=x.position.x-Math.sin(x.shape.rotation-x.rotation)*(x.shape.length/2),h=x.position.y-Math.cos(x.shape.rotation-x.rotation)*(x.shape.length/2),l=x.position.x+Math.sin(x.shape.rotation-x.rotation)*(x.shape.length/2),d=x.position.y+Math.cos(x.shape.rotation-x.rotation)*(x.shape.length/2),w=l-o,b=d-h,T=s.position.x,S=s.position.y,C=T-o,A=S-h,M=(w*C+b*A)/(x.shape.length*x.shape.length);if(0>M){var E=Math.sqrt(C*C+A*A);if(E<s.shape.radius)return!0}else if(M>1){var E=this.distance(T,S,l,d);if(E<s.shape.radius)return!0}else{var E=this.distance(C,A,w*M,b*M);if(E<s.shape.radius)return!0}return!1}return!1},hitResponse:function(e,t){if(e.shape instanceof game.Rectangle&&t.shape instanceof game.Rectangle){if(e.last.y+e.shape.height/2<=t.last.y-t.shape.height/2){if(e.collide(t))return e.position.y=t.position.y-t.shape.height/2-e.shape.height/2,!0}else if(e.last.y-e.shape.height/2>=t.last.y+t.shape.height/2){if(e.collide(t))return e.position.y=t.position.y+t.shape.height/2+e.shape.height/2,!0}else if(e.last.x+e.shape.width/2<=t.last.x-t.shape.width/2){if(e.collide(t))return e.position.x=t.position.x-t.shape.width/2-e.shape.width/2,!0}else if(e.last.x-e.shape.width/2>=t.last.x+t.shape.width/2&&e.collide(t))return e.position.x=t.position.x+t.shape.width/2+e.shape.width/2,!0}else if(e.shape instanceof game.Circle&&t.shape instanceof game.Circle){if(e.collide(t)){var i=t.position.angle(e.position),s=e.shape.radius+t.shape.radius;return e.position.x=t.position.x+Math.cos(i)*s,e.position.y=t.position.y+Math.sin(i)*s,!0}}else if(e.shape instanceof game.Rectangle&&t.shape instanceof game.Circle){if(e.collide(t))return}else if(e.shape instanceof game.Circle&&t.shape instanceof game.Rectangle){if(e.collide(t))return}else if(e.shape instanceof game.Line&&t.shape instanceof game.Line){if(e.collide(t))return}else if(e.shape instanceof game.Circle&&t.shape instanceof game.Line){if(e.collide(t))return}else if(e.shape instanceof game.Line&&t.shape instanceof game.Circle&&e.collide(t))return;return!1}}),game.Body=game.Class.extend({world:null,shape:null,position:null,last:null,velocity:null,velocityLimit:null,mass:0,collisionGroup:null,collideAgainst:null,rotation:0,init:function(e){this.position=new game.Vector,this.velocity=new game.Vector,this.velocityLimit=new game.Vector(500,500),this.last=new game.Vector,game.merge(this,e)},addShape:function(e){this.shape=e},collide:function(){return!0},afterCollide:function(){},setCollisionGroup:function(e){this.world&&("number"==typeof this.collisionGroup&&this.world.removeBodyCollision(this,this.collisionGroup),this.world.addBodyCollision(this,e))},setCollideAgainst:function(e){this.collideAgainst=e},update:function(){this.last.copy(this.position),this.mass>0&&(this.velocity.x+=this.world.gravity.x*this.mass*game.system.delta,this.velocity.y+=this.world.gravity.y*this.mass*game.system.delta,this.velocity.limit(this.velocityLimit)),this.position.multiplyAdd(this.velocity,game.scale*game.system.delta)}}),game.Rectangle=game.Class.extend({width:50,height:50,init:function(e,t){this.width=e||this.width*game.scale,this.height=t||this.height*game.scale}}),game.Circle=game.Class.extend({radius:50,init:function(e){this.radius=e||this.radius*game.scale}}),game.Line=game.Class.extend({length:50,rotation:0,init:function(e,t){this.length=e||this.length*game.scale,this.rotation=t||this.rotation}}),game.Vector=game.Class.extend({x:0,y:0,init:function(e,t){"number"==typeof e&&(this.x=e),"number"==typeof t&&(this.y=t)},set:function(e,t){return this.x=e,this.y=t,this},clone:function(){return new game.Vector(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x+=e instanceof game.Vector?e.x:e,this.y+=e instanceof game.Vector?e.y:t||e,this},subtract:function(e,t){return this.x-=e instanceof game.Vector?e.x:e,this.y-=e instanceof game.Vector?e.y:t||e,this},multiply:function(e,t){return this.x*=e instanceof game.Vector?e.x:e,this.y*=e instanceof game.Vector?e.y:t||e,this},multiplyAdd:function(e,t){return this.x+=e instanceof game.Vector?e.x*t:e*t,this.y+=e instanceof game.Vector?e.y*t:e*t,this},divide:function(e,t){return this.x/=e instanceof game.Vector?e.x:e,this.y/=e instanceof game.Vector?e.y:t||e,this},distance:function(e){var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},length:function(){return Math.sqrt(this.dot())},dot:function(e){return e instanceof game.Vector?this.x*e.x+this.y*e.y:this.x*this.x+this.y*this.y},dotNormalized:function(e){var t=this.length(),i=this.x/t,s=this.y/t;if(e instanceof game.Vector){var a=e.length(),n=e.x/a,r=e.y/a;return i*n+s*r}return i*i+s*s},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),s=this.x*t-this.y*i,a=this.y*t+this.x*i;return this.x=s,this.y=a,this},normalize:function(){var e=this.length();return this.x/=e||1,this.y/=e||1,this},limit:function(e){return this.x=this.x.limit(-e.x,e.x),this.y=this.y.limit(-e.y,e.y),this},angle:function(e){return Math.atan2(e.y-this.y,e.x-this.x)},angleFromOrigin:function(e){return Math.atan2(e.y,e.x)-Math.atan2(this.y,this.x)},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}})}),game.module("game.assets").body(function(){game.addAsset("bg_park.jpg"),game.addAsset("bg_garden.jpg"),game.addAsset("bg_woodland.jpg"),game.addAsset("bg_urban.jpg"),game.addAsset("bg_coast.jpg"),game.addAsset("flare_bg.png"),game.addAsset("flare_fg.png"),game.addAsset("clouds_big.png"),game.addAsset("ui.json"),game.addAsset("sprites.json"),game.addAsset("levelselect.json"),game.addAsset("howtoplay.json"),game.addAsset("keyboard.json"),game.addAsset("font.fnt"),game.addAsset("font2.fnt"),game.addAsset("font3.fnt"),game.addAsset("font4.fnt"),game.addAsset("font5.fnt"),game.addAudio("audio/bee-crash.m4a"),game.addAudio("audio/bee-flower-land.m4a"),game.addAudio("audio/bee-landing-approach.m4a"),game.addAudio("audio/button-press.m4a"),game.addAudio("audio/button-rollover.m4a"),game.addAudio("audio/game-over-panel.m4a"),game.addAudio("audio/hurry-up.m4a"),game.addAudio("audio/level-unlocked-panel.m4a"),game.addAudio("audio/line-draw-blip.m4a"),game.addAudio("audio/PiggybackRideLoop.m4a"),game.addAudio("audio/time-over-panel.m4a")}),game.module("game.levels").body(function(){game.Levels=[{time:90,maxBees:4,scoreToUnlock:15e3,beeSpawnInterval:3,speedUpInterval:30,speedUpAmount:1,background:"bg_park.jpg",flowers:[["flower",-190,-75],["flower",25,115],["flower",180,-130]],bees:[{name:"TwoBanded"}]},{locked:!0,time:120,maxBees:5,scoreToUnlock:25e3,beeSpawnInterval:1.5,speedUpInterval:30,speedUpAmount:2,background:"bg_garden.jpg",flowers:[["cosmos",50,-100],["cosmos",-150,20],["cosmos",140,120]],bees:[{name:"TwoBanded",scoreToUnlock:0},{name:"WhiteTailed",scoreToUnlock:1e3}]},{locked:!0,time:120,maxBees:6,scoreToUnlock:27e3,beeSpawnInterval:1.5,speedUpInterval:10,speedUpAmount:2,queenSpawnInterval:40,background:"bg_woodland.jpg",flowers:[["bluebell2",-140,70],["bluebell",-220,150],["bluebell2",205,-100],["bluebell",160,-10]],bees:[{name:"TwoBanded",scoreToUnlock:0},{name:"WhiteTailed",scoreToUnlock:0},{name:"ThreeBanded",scoreToUnlock:1500}]},{locked:!0,time:140,maxBees:6,scoreToUnlock:3e4,beeSpawnInterval:1.3,speedUpInterval:10,speedUpAmount:3,queenSpawnInterval:50,background:"bg_urban.jpg",flowers:[["cosmos",265,-125],["flower",-250,-65],["bluebell2",90,70],["bluebell",10,150]],bees:[{name:"TwoBanded",scoreToUnlock:0},{name:"WhiteTailed",scoreToUnlock:0},{name:"ThreeBanded",scoreToUnlock:0}]},{locked:!0,time:180,maxBees:7,beeSpawnInterval:1.2,speedUpInterval:20,speedUpAmount:4,queenSpawnInterval:40,background:"bg_coast.jpg",flowers:[["bluebell2",-183,-182],["bluebell",-264,-102],["flower",-123,121],["flower",80,-136],["cosmos",200,80]],bees:[{name:"TwoBanded",scoreToUnlock:0},{name:"WhiteTailed",scoreToUnlock:0},{name:"ThreeBanded",scoreToUnlock:0}]}]
}),game.module("game.title").require("engine.scene").body(function(){TilingSprite=game.Class.extend({speed:50,init:function(e){this.container=new game.Container;for(var t=0;2>t;t++){var i=new game.Sprite(e);i.anchor.set(.5,.5),game.system.height>i.height&&i.scale.set(game.system.height/i.height,game.system.height/i.height),i.position.set(t*i.width+game.system.width/2,game.system.height/2),this.container.addChild(i)}},update:function(){for(var e=0;e<this.container.children.length;e++){var t=this.container.children[e];if(t.position.x-=this.speed*game.system.delta,t.position.x+t.width/2<0){var i=this.container.children[e-1]||this.container.children[this.container.children.length-1];t.position.x=i.position.x+t.width}}}}),SceneTitle=game.Scene.extend({count:0,ratio:0,init:function(){game.audio.playMusic("audio/PiggybackRideLoop.m4a");for(var e=0;e<game.Levels.length;e++){var t=game.storage.get("levelData"+e);"undefined"!=typeof t&&(game.Levels[e].locked="true"===t)}game.bestScore=parseInt(game.storage.get("bestScore"))||0;var i=new game.Sprite("bg_park.jpg");i.anchor.set(.5,.5),i.position.set(game.system.width/2,game.system.height/2),game.system.width>i.width&&i.scale.set(game.system.width/i.width,game.system.width/i.width),game.system.height>i.height&&i.scale.set(game.system.height/i.height,game.system.height/i.height),this.stage.addChild(i),this.shadowContainer=(new game.Container).addTo(this.stage),this.beeContainer=(new game.Container).addTo(this.stage);var s=new TitleBee;this.addObject(s),this.addTimer(3e3,function(){var e=new TitleBee;game.scene.addObject(e)},!0);var a=new game.Sprite("flare_bg.png");a.anchor.set(.5,.5),a.position.set(game.system.width/2,-100),game.config.useBlendModes&&(a.blendMode=game.blendModes.ADD),a.scale.set(4,4),a.alpha=0,this.stage.addChild(a);var n=new game.Tween(a);n.to({rotation:2*Math.PI},6e4),n.repeat(),n.start(),this.addTween(a,{alpha:.5},4e3,{easing:game.Tween.Easing.Quadratic.InOut,repeat:1/0,yoyo:!0}).start();var r=new game.Sprite("flare_fg.png");r.anchor.set(.5,.5),r.position.set(game.system.width/2,-100),game.config.useBlendModes&&(r.blendMode=game.blendModes.ADD),r.scale.set(4,4),r.alpha=.5,this.stage.addChild(r);var n=new game.Tween(r);n.to({rotation:2*-Math.PI},6e4),n.repeat(),n.start(),this.addTween(r,{alpha:0},4e3,{easing:game.Tween.Easing.Quadratic.InOut,repeat:1/0,yoyo:!0}).start();var o=new TilingSprite("clouds_big.png");this.stage.addChild(o.container),this.addObject(o),this.titleContainer=(new game.Container).addTo(this.stage);var h=new game.Sprite("logo.png");h.anchor.set(.5,.7),h.scale.set(0,0),h.position.set(game.system.width/2-40,170),h.rotation=-.05,this.titleContainer.addChild(h),this.logo=h,this.addTween(this,{ratio:1},800,{easing:game.Tween.Easing.Elastic.Out}).start();var l=new UiButton(4,"buttonplay_big.png",game.system.width/2,430,this.hideTitle.bind(this,this.showLevels.bind(this))).addTo(this.titleContainer);l.container.scale.set(0,0),this.addTween(l.container.scale,{x:1,y:1},400,{easing:game.Tween.Easing.Back.Out,delay:200}).start();var d=new UiButton(4,"buttonhowto_big.png",game.system.width/2-100,570,this.hideTitle.bind(this,this.showHowto.bind(this))).addTo(this.titleContainer);d.container.scale.set(0,0),this.addTween(d.container.scale,{x:1,y:1},400,{easing:game.Tween.Easing.Back.Out,delay:400}).start();var u=new UiButton(4,"buttonleaderboard_big.png",game.system.width/2+100,570,this.hideTitle.bind(this,this.showLeaderboard.bind(this))).addTo(this.titleContainer);u.container.scale.set(0,0),this.addTween(u.container.scale,{x:1,y:1},400,{easing:game.Tween.Easing.Back.Out,delay:400}).start(),game.Audio.enabled&&(this.soundButton=new UiButton(0,"Soundon",game.system.width-80,80,null).addTo(this.stage),this.soundButton.callback=game.toggleSound.bind(this,this.soundButton.container),game.audio.musicMuted&&(this.soundButton.container.alpha=.5)),this.levelContainer=new game.Container;var c=new game.Graphics;c.beginFill(16777215),c.drawRect(0,0,game.system.width,game.system.height),c.alpha=1,this.stage.addChild(c),this.tween=new game.Tween(c),this.tween.to({alpha:0},400),this.tween.onComplete(function(){game.scene.stage.removeChild(c),game.scene.tween=null}),this.tween.start()},showLeaderboard:function(){new LeaderBoard(function(){game.scene.tween=null,game.scene.showTitle()},!0).addTo(this.stage)},update:function(){this._super(),this.count+=.0225*game.system.delta*50,this.logo.position.y=230+10*Math.sin(4*this.count),this.logo.rotation=.2*Math.sin(2*this.count)*.5,this.logo.scale.x=(1+.02*Math.sin(4*this.count))*this.ratio,this.logo.scale.y=(1+.02*Math.cos(4*this.count))*this.ratio},showHowto:function(){this.tween=null;var e=new HowToPlay(function(){game.scene.tween||(game.scene.tween=game.scene.addTween(e.container,{alpha:0},200,{onComplete:function(){game.scene.stage.removeChild(e.container),game.scene.tween=null,game.scene.showTitle()}}).start())}).addTo(this.stage)},showTitle:function(){this.tween||(this.titleContainer.alpha=0,this.stage.addChild(this.titleContainer),this.tween=new game.Tween(this.titleContainer),this.tween.to({alpha:1},200),this.tween.onComplete(function(){game.scene.tween=null}),this.tween.start())},hideTitle:function(e){this.tween||(this.tween=new game.Tween(this.titleContainer),this.tween.to({alpha:0},200),this.tween.onComplete(function(){game.scene.stage.removeChild(game.scene.titleContainer),e()}),this.tween.start())},showLevels:function(){this.tween=null,this.levelContainer.alpha=1;for(var e=this.levelContainer.children.length-1;e>=0;e--)this.levelContainer.removeChild(this.levelContainer.children[e]);new UiButton(0,"Mainmenu",80,80,this.hideLevels.bind(this)).addTo(this.levelContainer),new LevelButton("LevelSelect_01.png",-260,-100,0,this.startGame.bind(this,0),game.Levels[0].locked).addTo(this.levelContainer),new LevelButton("LevelSelect_02.png",0,-100,100,this.startGame.bind(this,1),game.Levels[1].locked).addTo(this.levelContainer),new LevelButton("LevelSelect_03.png",260,-100,200,this.startGame.bind(this,2),game.Levels[2].locked).addTo(this.levelContainer),new LevelButton("LevelSelect_04.png",-130,130,300,this.startGame.bind(this,3),game.Levels[3].locked).addTo(this.levelContainer),new LevelButton("LevelSelect_05.png",130,130,400,this.startGame.bind(this,4),game.Levels[4].locked).addTo(this.levelContainer);this.stage.addChild(this.levelContainer)},hideLevels:function(){this.addTween(this.levelContainer,{alpha:0},200,{onComplete:this.showTitle.bind(this)}).start()},startGame:function(e){if(!this.tween){var t=new game.Graphics;t.beginFill(16777215),t.drawRect(0,0,game.system.width,game.system.height),t.alpha=0,this.stage.addChild(t),this.tween=new game.Tween(t),this.tween.to({alpha:1},400),this.tween.onComplete(function(){game.currentLevel=e,game.system.setScene(SceneGame)}),this.tween.start()}}})}),game.module("game.bee").body(function(){BeeTypes=[{name:"TwoBanded",lowSpeed:50,highSpeed:220,initMargin:150,landingTweenSpeed:1100,landingAnimSpeed:.08,pollenTime:3e3,score:1e3},{name:"WhiteTailed",lowSpeed:70,highSpeed:270,initMargin:300,landingTweenSpeed:1e3,landingAnimSpeed:.09,pollenTime:6e3,score:1e3},{name:"ThreeBanded",lowSpeed:100,highSpeed:300,initMargin:300,landingTweenSpeed:900,landingAnimSpeed:.1,pollenTime:9e3,score:1e3},{name:"Queen",lowSpeed:50,shapeRadius:50}],Bee=game.Class.extend({path:{x:[],y:[]},pathLength:0,angleFound:!1,pathContainer:null,flying:!0,speed:100,initMargin:150,steerSpeed:.8,shadowPosition:125,shapeRadius:35,startOffset:200,counter:0,collecting:!1,wobbleCounter:0,realScale:1,init:function(e,t,i,s){var a=i||game.scene.unlockedBees.random(),n=this.getBeeData(a);if(game.merge(this,n),"ThreeBanded"===this.name&&(this.steerDir=Math.random()>.5?1:-1),this._steerSpeed=this.steerSpeed,this.setSpeed(this.lowSpeed),this.dirVector=new game.Vector,this.pathContainer=new game.Container,game.scene.pathContainer.addChild(this.pathContainer),this.sprite=new game.Animation(this.name+"Fly01.png",this.name+"Fly02.png",this.name+"Fly03.png",this.name+"Fly04.png",this.name+"Fly05.png",this.name+"Fly06.png",this.name+"Fly07.png",this.name+"Fly08.png"),this.sprite.animationSpeed=1,this.sprite.play(),this.sprite.anchor.set(.5,.5),this.sprite.interactive=!0,this.sprite.mousedown=this.mousedown.bind(this),this.sprite.touchstart=this.touchstart.bind(this),game.config.useShadows&&(this.shadow=new game.Animation(this.name+"Fly01.png",this.name+"Fly02.png",this.name+"Fly03.png",this.name+"Fly04.png",this.name+"Fly05.png",this.name+"Fly06.png",this.name+"Fly07.png",this.name+"Fly08.png"),this.shadow.animationSpeed=this.sprite.animationSpeed,this.shadow.play(),this.shadow.anchor.set(.5,.5),this.shadow.scale.set(.47,.47),this.shadow.alpha=.2,this.shadow.position.set(0,250),game.config.useTint&&(this.shadow.tint=928595),game.scene.shadowContainer.addChild(this.shadow)),"Queen"===this.name){var r=new game.Sprite("noGrabQueen.png");r.anchor.set(.5,.5),r.position.set(0,0),this.sprite.addChild(r)}var o=Math.floor(4*Math.random());o===Bee.count&&o++;var h=Bee.count%4,l=Bee.count%2;if(Bee.count=o,h>1){{var d=l>.5?-this.startOffset:game.system.width+this.startOffset,u=Math.random()*(game.system.height-2*this.initMargin)+this.initMargin;l>.5?game.system.width+this.startOffset:-this.startOffset,Math.random()*(game.system.height-2*this.initMargin)+this.initMargin}this.dirVector.x=l>.5?1:-1;var c=l>.5?"IncomingLeft.png":"IncomingRight.png"}else{{var d=Math.random()*(game.system.width-2*this.initMargin)+this.initMargin,u=l>.5?-this.startOffset:game.system.height+this.startOffset;Math.random()*(game.system.width-2*this.initMargin)+this.initMargin,l>.5?game.system.height+this.startOffset:-this.startOffset}this.dirVector.y=l>.5?1:-1;var c=l>.5?"IncomingTop.png":"IncomingBottom.png"}"number"==typeof s&&(this.dirVector.x=Math.cos(s),this.dirVector.y=Math.sin(s)),"WhiteTailed"===this.name&&this.dirVector.rotate(Math.random()>.5?.2:-.2),this.sprite.position.set(e||d,t||u);var m=new game.Circle(this.shapeRadius);if(this.body=new game.Body({collisionGroup:0,collideAgainst:0}),e&&t&&(this.body.position.x=e,this.body.position.y=t),this.body.collide=this.collide.bind(this),this.body.addShape(m),this.body.parent=this,game.scene.world.addBody(this.body),game.scene.beeContainer.addChild(this.sprite),!i){var g=new game.Sprite(c);g.anchor.set(.5,.5),g.alpha=0,g.position.set(d.limit(30,game.system.width-30),u.limit(30,game.system.height-30)),game.scene.stage.addChild(g),game.scene.addTimer(2e3,function(){game.scene.addTween(g,{alpha:0},800,{onComplete:function(){game.scene.stage.removeChild(g)}}).start()}),game.scene.addTween(g,{alpha:1},800).start()}this.warning=new game.Sprite("warningarea_add.png"),this.warning.anchor.set(.5,.5),game.config.useBlendModes&&(this.warning.blendMode=game.blendModes.ADD),this.warning.alpha=.5,game.scene.addTween(this.warning.scale,{x:1.2,y:1.2},200,{repeat:1/0,yoyo:!0,easing:game.Tween.Easing.Quadratic.InOut}).start()},setSpeed:function(e){this.speed=e,this.steerSpeed=this._steerSpeed/100*e*2},getBeeData:function(e){for(var t=0;t<BeeTypes.length;t++)if(BeeTypes[t].name===e)return BeeTypes[t]},touchstart:function(e){this.touchEvent=e,this.mousedown(e)},mousedown:function(){this.landed||game.scene.activeBee||game.scene.ended||"Queen"===this.name||(this.flowerFound=!1,game.scene.activeBee=this,this.clearPath(),this.realScale=.7,game.scene.addTween(this,{realScale:1},1600,{easing:game.Tween.Easing.Elastic.Out}).start())},clearPath:function(){this.setSpeed(this.lowSpeed),this.path.x.length=0,this.path.y.length=0,this.pathLength=0,this.angleFound=!1;for(var e=this.pathContainer.children.length-1;e>=0;e--)this.pathContainer.removeChild(this.pathContainer.children[e])},collide:function(e){if(!game.scene.ended&&!this.collided&&!(this.sprite.position.x+this.sprite.height<0||this.sprite.position.x-this.sprite.height>game.system.width||this.sprite.position.y+this.sprite.height<0||this.sprite.position.y-this.sprite.height>game.system.height||e.parent.sprite.position.x+e.parent.sprite.height<0||e.parent.sprite.position.x-e.parent.sprite.height>game.system.width||e.parent.sprite.position.y+e.parent.sprite.height<0||e.parent.sprite.position.y-e.parent.sprite.height>game.system.height)){e.parent.collided=!0,e.parent.kill(),this.kill(),game.audio.playSound("audio/bee-crash.m4a"),game.scene.lives--;var t=new game.Sprite("LifeLostStrike.png");t.position.set(game.system.width-93-52*game.scene.lives,597),t.alpha=0;var i=new game.Tween(t);i.to({alpha:1},400),i.start(),game.scene.uiContainer.addChild(t);var s=new game.Animation("collision_add01.png","collision_add02.png","collision_add03.png","collision_add04.png","collision_add05.png","collision_add06.png","collision_add07.png","collision_add08.png","collision_add09.png","collision_add10.png");return s.animationSpeed=.3,s.loop=!1,s.alpha=1,s.play(),s.anchor.set(.5,.5),s.position.set((this.sprite.position.x+e.parent.sprite.position.x)/2,(this.sprite.position.y+e.parent.sprite.position.y)/2),game.config.useBlendModes&&(s.blendMode=game.blendModes.ADD),game.scene.beeContainer.addChild(s),game.scene.addTween(s.scale,{x:1,y:1},500).start(),game.scene.addTween(s,{alpha:1},1e3,{onComplete:function(){game.scene.beeContainer.removeChild(s)}}).start(),0===game.scene.lives&&(game.audio.playSound("audio/game-over-panel.m4a"),game.scene.gameOver()),!1}},endPath:function(e,t){-1e4!==e&&-1e4!==t&&(this.path.x.push(e),this.path.y.push(t)),this.setSpeed(this.highSpeed),this.flowerFound=!1;for(var i=this.path.x[this.path.x.length-1],s=this.path.y[this.path.y.length-1],a=0;a<game.scene.flowers.length;a++){var n=game.scene.flowers[a],r=Math.distance(i,s,n.container.position.x,n.container.position.y);if(r<=n.radius){if(this.flowerFound=!0,this.flower=n,this.flower.container.scale.set(1,1),e=n.container.position.x,t=n.container.position.y,this.path.x[this.path.x.length-1]=this.flower.container.position.x,this.path.y[this.path.x.length-1]=this.flower.container.position.y,game.config.useTint)for(var a=0;a<this.pathContainer.children.length;a++)this.pathContainer.children[a].setTexture("LineDrawSegmentRelease.png");break}}game.scene.spawnReticle(e,t)},flyOff:function(){if(this.flower&&this.collecting){var e=this.pollenTimer.time(),t=this.score;if(0>e){var i=this.score/this.pollenTime,s=Math.abs(e),a=this.pollenTime-s;t=Math.round(a*i)}if(game.scene.addScore(t),this.collecting=!1,!game.scene.ended){this.flower.resume(),game.scene.flowerContainer.removeChild(this.sprite),game.scene.beeContainer.addChild(this.sprite),this.sprite.textures=[game.Texture.fromFrame(this.name+"Fly01.png"),game.Texture.fromFrame(this.name+"Fly02.png"),game.Texture.fromFrame(this.name+"Fly03.png"),game.Texture.fromFrame(this.name+"Fly04.png"),game.Texture.fromFrame(this.name+"Fly05.png"),game.Texture.fromFrame(this.name+"Fly06.png"),game.Texture.fromFrame(this.name+"Fly07.png"),game.Texture.fromFrame(this.name+"Fly08.png")],this.sprite.loop=!0,this.sprite.animationSpeed=1,this.sprite.gotoAndPlay(0);var n=new game.Tween(this.sprite);n.to({alpha:0},1e3),n.start(),game.config.useShadows&&(this.shadow.textures=[game.Texture.fromFrame(this.name+"Fly01.png"),game.Texture.fromFrame(this.name+"Fly02.png"),game.Texture.fromFrame(this.name+"Fly03.png"),game.Texture.fromFrame(this.name+"Fly04.png"),game.Texture.fromFrame(this.name+"Fly05.png"),game.Texture.fromFrame(this.name+"Fly06.png"),game.Texture.fromFrame(this.name+"Fly07.png"),game.Texture.fromFrame(this.name+"Fly08.png")],this.shadow.loop=!0,this.shadow.animationSpeed=1,this.shadow.gotoAndPlay(0),this.shadow.visible=!0,n=new game.Tween(this.shadow),n.to({alpha:0},1e3),n.start(),n=new game.Tween(this.shadow.position),n.to({y:this.shadow.position.y+200},1e3),n.start(),n=new game.Tween(this),n.to({shadowPosition:250},1e3),n.start()),n=new game.Tween(this.sprite.scale),n.to({x:3,y:3},1e3),n.onComplete(this.kill.bind(this)),n.start();var r=new game.BitmapText(t.toString(),{font:"Fredoka"});r.position.set(this.sprite.position.x,this.sprite.position.y),game.scene.addTween(r.position,{x:180,y:20},1e3,{onComplete:function(){game.scene.uiContainer.removeChild(r),game.scene.beeContainer.removeChild(o)}}).start(),game.scene.addTween(r,{alpha:0},1e3).start(),game.scene.uiContainer.addChild(r),this.flower.bee=null,this.flower=null;var o=new game.Animation("pollen_burst01.png","pollen_burst02.png","pollen_burst03.png","pollen_burst04.png","pollen_burst05.png","pollen_burst06.png","pollen_burst07.png","pollen_burst08.png","pollen_burst09.png","pollen_burst10.png","pollen_burst11.png","pollen_burst12.png","pollen_burst13.png");o.anchor.set(.5,.5),o.position.set(this.sprite.position.x,this.sprite.position.y),o.animationSpeed=.35,o.loop=!1,o.play(),game.scene.beeContainer.addChild(o)}}},kill:function(){this.killed||(this.killed=!0,game.config.useShadows&&game.scene.shadowContainer.removeChild(this.shadow),game.scene.pathContainer.removeChild(this.pathContainer),this.sprite.parent.removeChild(this.sprite),game.scene.world.removeBody(this.body),game.scene.removeObject(this),game.scene.bees.erase(this),this.warning.parent&&this.warning.parent.removeChild(this.warning))},land:function(){this.flowerFound=!1,this.targetAngle=null,this.flying=!1,this.landed=!0,game.audio.playSound("audio/bee-landing-approach.m4a");var e=game.Tween.Easing.Quadratic.Out,t=this.path.x[this.path.x.length-1],i=this.path.y[this.path.y.length-1];game.scene.addTween(this.sprite.position,{x:t,y:i},this.landingTweenSpeed,{easing:e}).start();var s=Math.atan2(i-this.sprite.position.y,t-this.sprite.position.x);game.scene.addTween(this.dirVector,{x:Math.cos(s),y:Math.sin(s)},this.landingTweenSpeed,{easing:e}).start(),game.scene.addTween(this.sprite.scale,{x:.8,y:.8},this.landingTweenSpeed,{easing:e,onComplete:this.landComplete.bind(this)}).start(),this.clearPath(),game.scene.world.removeBodyCollision(this.body),game.config.useShadows&&(game.scene.addTween(this.shadow.position,{x:t,y:i},this.landingTweenSpeed,{easing:e}).start(),game.scene.addTween(this,{shadowPosition:0},this.landingTweenSpeed,{easing:e}).start(),game.scene.addTween(this.shadow.scale,{x:.8,y:.8},this.landingTweenSpeed,{easing:e}).start(),this.shadow.textures=[game.Texture.fromFrame(this.name+"Land01.png"),game.Texture.fromFrame(this.name+"Land02.png"),game.Texture.fromFrame(this.name+"Land03.png"),game.Texture.fromFrame(this.name+"Land04.png"),game.Texture.fromFrame(this.name+"Land05.png"),game.Texture.fromFrame(this.name+"Land06.png"),game.Texture.fromFrame(this.name+"Land07.png")],this.shadow.loop=!1,this.shadow.animationSpeed=this.landingAnimSpeed,this.shadow.gotoAndPlay(0)),this.sprite.textures=[game.Texture.fromFrame(this.name+"Land01.png"),game.Texture.fromFrame(this.name+"Land02.png"),game.Texture.fromFrame(this.name+"Land03.png"),game.Texture.fromFrame(this.name+"Land04.png"),game.Texture.fromFrame(this.name+"Land05.png"),game.Texture.fromFrame(this.name+"Land06.png"),game.Texture.fromFrame(this.name+"Land07.png")],this.sprite.loop=!1,this.sprite.animationSpeed=this.landingAnimSpeed,this.sprite.gotoAndPlay(0)},landComplete:function(){game.scene.ended||(game.scene.beeContainer.removeChild(this.sprite),game.scene.flowerContainer.addChild(this.sprite),this.collecting=!0,this.counter=0,game.config.useShadows&&(this.shadow.visible=!1),this.pollenTimer=game.scene.addTimer(this.pollenTime,this.flyOff.bind(this)),this.flower.pause(),game.audio.playSound("audio/bee-flower-land.m4a"),this.flower.bee&&this.flower.bee.flyOff(),this.flower.bee=this)},update:function(){if(this.landed){var e=Math.atan2(this.dirVector.y,this.dirVector.x)+Math.PI/2;if(this.collecting){this.counter+=.3;var t=.3*this.counter;t>1&&(t=1),this.sprite.pivot.x=2*Math.sin(this.counter)*t,this.sprite.pivot.y=2*Math.cos(this.counter/2)*t,this.sprite.rotation=e+.05*this.sprite.pivot.x}else this.sprite.rotation=e;game.config.useShadows&&(this.shadow.rotation=e)}if(this.flying&&!this.killed&&!this.landed){if(this.path.x.length>0){var i=Math.distance(this.sprite.position.x,this.sprite.position.y,this.path.x[0],this.path.y[0]);if(30>=i&&(this.path.x.shift(),this.path.y.shift(),this.pathContainer.removeChild(this.pathContainer.children[0]),this.angleFound=!1),this.flowerFound){var s=Math.distance(this.sprite.position.x,this.sprite.position.y,this.path.x[this.path.x.length-1],this.path.y[this.path.y.length-1]);100>=s&&this.path.x.length<4&&this.land()}else 0===this.path.x.length&&this.clearPath()}this.path.x.length>0&&!this.angleFound&&(this.targetAngle=Math.atan2(this.path.y[0]-this.sprite.position.y,this.path.x[0]-this.sprite.position.x),this.targetAngleCos=Math.cos(this.targetAngle),this.targetAngleSin=Math.sin(this.targetAngle)),"number"==typeof this.targetAngle&&(Math.abs(this.dirVector.x-this.targetAngleCos)>.05?this.dirVector.x+=(this.dirVector.x>this.targetAngleCos?-this.steerSpeed:this.steerSpeed)*game.system.delta:this.dirVector.x=this.targetAngleCos,Math.abs(this.dirVector.y-this.targetAngleSin)>.05?this.dirVector.y+=(this.dirVector.y>this.targetAngleSin?-this.steerSpeed:this.steerSpeed)*game.system.delta:this.dirVector.y=this.targetAngleSin,this.dirVector.x===this.targetAngleCos&&this.dirVector.y===this.targetAngleSin&&(this.angleFound=!0,this.targetAngle=null)),0===this.path.x.length&&this.flying&&"ThreeBanded"===this.name&&this.dirVector.rotate(.2*this.steerDir*game.system.delta);var a=Math.atan2(this.dirVector.y,this.dirVector.x)+Math.PI/2;this.sprite.rotation=a,this.sprite.position.x+=this.dirVector.x*this.speed*game.system.delta,this.sprite.position.y+=this.dirVector.y*this.speed*game.system.delta,this.body.position.x=this.sprite.position.x,this.body.position.y=this.sprite.position.y,this.wobbleCounter+=60*game.system.delta,this.sprite.scale.x=this.sprite.scale.y=.975+.025*Math.sin(.2*this.wobbleCounter),this.sprite.scale.x*=this.realScale,this.sprite.scale.y*=this.realScale,this.sprite.pivot.x=4*Math.sin(.05*this.wobbleCounter),this.sprite.pivot.y=3*Math.cos(.17*this.wobbleCounter),game.config.useShadows&&(this.shadow.rotation=a,this.shadow.position.set(this.sprite.position.x,this.sprite.position.y+this.shadowPosition));var n=!1;if(!this.landed)for(var r=game.scene.bees.length-1;r>=0;r--)if(game.scene.bees[r]!==this&&!game.scene.bees[r].landed){var o=Math.distance(this.sprite.position.x,this.sprite.position.y,game.scene.bees[r].sprite.position.x,game.scene.bees[r].sprite.position.y);if(200>=o){n=!0;break}}n&&game.scene.uiContainer.addChild(this.warning),this.warning.parent&&(n?this.warning.position.set(this.sprite.position.x,this.sprite.position.y):game.scene.uiContainer.removeChild(this.warning)),(this.sprite.position.x+this.startOffset<0||this.sprite.position.x-this.startOffset>game.system.width||this.sprite.position.y+this.startOffset<0||this.sprite.position.y-this.startOffset>game.system.height)&&this.kill()}}}),TitleBee=game.Class.extend({initMargin:150,shadowPosition:125,startOffset:200,init:function(){var e=Math.round(Math.randomBetween(0,BeeTypes.length-2)),t=BeeTypes[e];game.merge(this,t),this.speed=this.lowSpeed,"ThreeBanded"===this.name&&(this.steerDir=Math.random()>.5?1:-1),this.dirVector=new game.Vector,this.sprite=new game.Animation(this.name+"Fly01.png",this.name+"Fly02.png",this.name+"Fly03.png",this.name+"Fly04.png",this.name+"Fly05.png",this.name+"Fly06.png",this.name+"Fly07.png",this.name+"Fly08.png"),this.sprite.animationSpeed=1,this.sprite.play(),this.sprite.anchor.set(.5,.5),game.config.useShadows&&(this.shadow=new game.Animation(this.name+"Fly01.png",this.name+"Fly02.png",this.name+"Fly03.png",this.name+"Fly04.png",this.name+"Fly05.png",this.name+"Fly06.png",this.name+"Fly07.png",this.name+"Fly08.png"),this.shadow.animationSpeed=this.sprite.animationSpeed,this.shadow.play(),this.shadow.anchor.set(.5,.5),this.shadow.scale.set(.47,.47),this.shadow.alpha=.2,this.shadow.position.set(0,250),game.config.useTint&&(this.shadow.tint=928595),game.scene.shadowContainer.addChild(this.shadow));var i=Math.random(),s=Math.random();if(i>.5){{var a=s>.5?-this.startOffset:game.system.width+this.startOffset,n=Math.random()*(game.system.height-2*this.initMargin)+this.initMargin;s>.5?game.system.width+this.startOffset:-this.startOffset,Math.random()*(game.system.height-2*this.initMargin)+this.initMargin}this.dirVector.x=s>.5?1:-1}else{{var a=Math.random()*(game.system.width-2*this.initMargin)+this.initMargin,n=s>.5?-this.startOffset:game.system.height+this.startOffset;Math.random()*(game.system.width-2*this.initMargin)+this.initMargin,s>.5?game.system.height+this.startOffset:-this.startOffset}this.dirVector.y=s>.5?1:-1}"WhiteTailed"===this.name&&this.dirVector.rotate(Math.random()>.5?.2:-.2),this.sprite.position.set(a,n),game.scene.beeContainer.addChild(this.sprite)},kill:function(){this.shadow&&game.scene.shadowContainer.removeChild(this.shadow),this.sprite.parent.removeChild(this.sprite),game.scene.removeObject(this)},update:function(){"ThreeBanded"===this.name&&this.dirVector.rotate(.2*this.steerDir*game.system.delta),this.sprite.rotation=Math.atan2(this.dirVector.y,this.dirVector.x)+Math.PI/2,this.sprite.position.x+=this.dirVector.x*this.speed*game.system.delta,this.sprite.position.y+=this.dirVector.y*this.speed*game.system.delta,this.shadow&&(this.shadow.rotation=this.sprite.rotation,this.shadow.position.set(this.sprite.position.x,this.sprite.position.y+this.shadowPosition)),(this.sprite.position.x+this.startOffset<0||this.sprite.position.x-this.startOffset>game.system.width||this.sprite.position.y+this.startOffset<0||this.sprite.position.y-this.startOffset>game.system.height)&&this.kill()}}),Bee.count=0}),game.module("game.flower").body(function(){FlowerTypes=[{name:"flower",animSpeed:1e3,radius:85,head:{x:0,y:50}},{name:"cosmos",animSpeed:800,radius:100,head:{x:0,y:45}},{name:"bluebell",animSpeed:900,radius:60,head:{x:-5,y:45}}],Flower=game.Class.extend({bee:null,tweens:[],init:function(e,t,i){"bluebell2"===e&&(e="bluebell",this.blueBellLeaves=!0);for(var s,a=0;a<FlowerTypes.length;a++)if(FlowerTypes[a].name===e){s=FlowerTypes[a];break}if(game.merge(this,s),this.container=new game.Container,this.container.position.set(game.system.width/2+t,game.system.height/2+i),"bluebell"!==this.name||this.blueBellLeaves){var n=new game.Sprite(this.name+"_leaves.png");n.anchor.set(.5,.5),n.rotation=.4*Math.random(),"bluebell"===this.name?n.position.set(-50,40):n.position.set(0,20),this.container.addChild(n);var r=new game.Tween(n.scale);r.to({x:1.05,y:1.05},this.animSpeed/2),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r)}var o=new game.Sprite(this.name+"_head.png");o.anchor.set(.5,.6),o.position.set(this.head.x,this.head.y),o.scale.set(1,1),this.container.addChild(o);var h=new game.Sprite(this.name+"_face.png");h.anchor.set(.5,.5),"bluebell"===this.name&&h.position.set(0,-10),this.container.addChild(h),game.scene.flowerContainer.addChild(this.container);var r=new game.Tween(o);r.to({rotation:.15},this.animSpeed),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r);var r=new game.Tween(o.scale);r.to({y:.95},this.animSpeed/2),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r);var r=new game.Tween(h);r.to({rotation:.15},this.animSpeed),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r);var r=new game.Tween(h.scale);r.to({y:.95},this.animSpeed/2),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r);var r=new game.Tween(this.container);if(r.to({rotation:.05},this.animSpeed),r.easing(game.Tween.Easing.Quadratic.InOut),r.repeat(),r.yoyo(),r.start(),this.tweens.push(r),game.debugDraw){var l=new game.Graphics;l.beginFill(16711680),l.drawCircle(0,0,this.radius),l.position.set(game.system.width/2+t,game.system.height/2+i),l.alpha=.5,game.scene.stage.addChild(l)}},pause:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].pause()},resume:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].resume()}})}),game.module("game.ui").body(function(){UiButton=game.Class.extend({init:function(e,t,i,s,a){var n="MenuSmall";if(1===e&&(n="UILarge"),2===e&&(n="UISmall"),this.container=new game.Container,this.container.position.set(i,s),4===e){var r=new game.Sprite(t);r.anchor.set(.5,.5),this.container.addChild(r)}else if(3===e){var r=new game.Sprite("ButtonClose.png");r.anchor.set(.5,.5),this.container.addChild(r)}else{var r=new game.Sprite("Button"+n+".png");r.anchor.set(.5,.5),this.container.addChild(r);var t=new game.Sprite("ButtonIcon"+t+".png");t.anchor.set(.5,.5),this.container.addChild(t),1!==e&&t.scale.set(.7,.7)}this.bgSprite=r,this.callback=a,this.container.interactive=!0,this.container.hitArea=new game.HitRectangle(-r.width/2,-r.height/2,r.width,r.height),this.container.buttonMode=!0,this.container.click=this.container.tap=this.click.bind(this),this.container.mousedown=this.container.touchstart=function(){var e=game.device.mobile?.9:1;game.scene.addTween(this.scale,{x:e,y:e},300,{easing:game.Tween.Easing.Elastic.Out}).start(),game.scene.addTween(this,{rotation:0},300,{easing:game.Tween.Easing.Elastic.Out}).start()},this.container.mouseup=this.container.touchend=this.container.mouseupoutside=this.container.touchendoutside=function(){var e=game.device.mobile?1:1.1;game.scene.addTween(this.scale,{x:e,y:e},300,{easing:game.Tween.Easing.Elastic.Out}).start()},this.container.mouseover=function(){game.scene.addTween(this.scale,{x:1.1,y:1.1},200,{easing:game.Tween.Easing.Back.Out}).start(),game.scene.addTween(this,{rotation:2*(Math.random()-.5)*.1},300,{easing:game.Tween.Easing.Back.Out}).start()},this.container.mouseout=this.container.mouseupoutside=function(){game.scene.addTween(this.scale,{x:1,y:1},200,{easing:game.Tween.Easing.Back.Out}).start(),game.scene.addTween(this,{rotation:0},200,{easing:game.Tween.Easing.Back.Out}).start()}},click:function(){this.callback(),game.audio.playSound("audio/button-press.m4a")},addTo:function(e){return e.addChild(this.container),this}}),LevelButton=game.Class.extend({init:function(e,t,i,s,a,n){if(this.sprite=new game.Sprite(e),this.sprite.anchor.set(.5,.5),this.sprite.scale.set(0,0),this.sprite.position.set(game.system.width/2+t,game.system.height/2+i),n){var e=new game.Sprite(e.replace("Select","Unlock"));e.anchor.set(.5,.5),this.sprite.addChild(e)}else{new UiButton(2,"Play",0,70,this.click.bind(this)).addTo(this.sprite)}this.delay=s,this.callback=a},click:function(){this.tween||(this.callback(),game.audio.playSound("audio/button-press.m4a"))},mousedown:function(){this.tween||this.sprite.scale.set(.9,.9)},mouseup:function(){this.tween||this.sprite.scale.set(1,1)},ready:function(){this.tween=null},addTo:function(e){return this.tween=game.scene.addTween(this.sprite.scale,{x:1,y:1},200,{delay:this.delay,easing:game.Tween.Easing.Back.Out,onComplete:this.ready.bind(this)}).start(),e.addChild(this.sprite),this}}),HowToPlay=game.Class.extend({init:function(e){this.callback=e,this.container=new game.Container;var t=new PIXI.Graphics;t.beginFill(0),t.drawRect(0,0,game.system.width,game.system.height),t.alpha=0,game.scene.addTween(t,{alpha:.6},200).start(),this.container.addChild(t);var i=new game.BitmapText("How to play",{font:"Fredoka"});i.position.x=game.system.width/2-i.textWidth/2,i.position.y=70,i.alpha=0,game.scene.addTween(i,{alpha:1},200).start();var s=new game.Sprite("HowToPlay_01.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2-310,game.system.height/2-110),s.scale.set(0,0),game.scene.addTween(s.scale,{x:.95,y:.95},200,{easing:game.Tween.Easing.Back.Out}).start(),this.container.addChild(s);var s=new game.Sprite("HowToPlay_02.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2,game.system.height/2-110),s.scale.set(0,0),game.scene.addTween(s.scale,{x:.95,y:.95},200,{delay:200,easing:game.Tween.Easing.Back.Out}).start(),this.container.addChild(s);var s=new game.Sprite("HowToPlay_03.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2+310,game.system.height/2-110),s.scale.set(0,0),game.scene.addTween(s.scale,{x:.95,y:.95},200,{delay:400,easing:game.Tween.Easing.Back.Out}).start(),this.container.addChild(s);
var s=new game.Sprite("HowToPlay_04.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2-155,game.system.height/2+160),s.scale.set(0,0),game.scene.addTween(s.scale,{x:.95,y:.95},200,{delay:600,easing:game.Tween.Easing.Back.Out}).start(),this.container.addChild(s);var s=new game.Sprite("HowToPlay_05.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2+155,game.system.height/2+160),s.scale.set(0,0),game.scene.addTween(s.scale,{x:.95,y:.95},200,{delay:800,easing:game.Tween.Easing.Back.Out}).start(),this.container.addChild(s);var a=new UiButton(3,null,60,75,this.callback.bind(this)).addTo(this.container);a.container.scale.set(0,0),game.scene.addTween(a.container.scale,{x:1,y:1},400,{easing:game.Tween.Easing.Back.Out,delay:400}).start()},addTo:function(e){return e.addChild(this.container),this}}),Keyboard=game.Class.extend({keys:[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M","del"]],input:"",init:function(e,t,i){this.callback=i,this.container=new game.Container,this.container.position.set(e,t);for(var s=0,a=5,n=0;n<this.keys.length;n++){for(var r=0;r<this.keys[n].length;r++){var o=this.keys[n][r],h=new game.Sprite("keyboard_"+o+".png");h.anchor.set(.5,.5),h.interactive=!0,h.buttonMode=!0,h.mousedown=h.touchstart=function(){this.scale.set(.9,.9)},h.mouseup=h.touchend=h.mouseupoutside=h.touchendoutside=function(){this.scale.set(1,1)},h.click=h.tap=this.click.bind(this,o),h.position.set(r*(h.width+a)-(this.keys[n].length*h.width+a)/2+a,s),this.container.addChild(h)}s+=h.height}},click:function(e){game.audio.playSound("audio/button-press.m4a"),"del"===e?this.input=this.input.substr(0,Math.max(0,this.input.length-1)):(3===this.input.length&&(this.input=this.input.substr(0,2)),this.input+=e),this.callback()},addTo:function(e){return e.addChild(this.container),this}}),LeaderBoard=game.Class.extend({data:null,pages:null,currentPage:1,perPage:6,maxResults:100,init:function(e,t){if(this.closeCallback=e,this.container=new game.Container,t){var i=new PIXI.Graphics;i.beginFill(0),i.drawRect(0,0,game.system.width,game.system.height),i.alpha=0,game.scene.addTween(i,{alpha:.6},200).start(),this.container.addChild(i)}var s=new game.Sprite("PanelLarge.png");s.anchor.set(.5,.5),s.position.set(game.system.width/2,game.system.height/2),this.container.addChild(s);var a=new game.BitmapText("Leaderboard",{font:"FredokaTitle"});a.position.set(game.system.width/2-a.textWidth/2,138),this.container.addChild(a);var n=new game.Sprite("HorizontalSmall.png");n.position.set(game.system.width/2-n.width/2,190),this.container.addChild(n);var n=new game.Sprite("HorizontalSmall.png");n.position.set(game.system.width/2-n.width/2,480),this.container.addChild(n);var r=new game.BitmapText("Your best: "+game.getScoreText(game.bestScore),{font:"FredokaText"});r.position.set(game.system.width/2-r.textWidth/2,495),this.container.addChild(r);var o=(new UiButton(3,null,game.system.width/2+303,130,this.close.bind(this)).addTo(this.container),new game.Sprite("ScrollTrack.png"));o.anchor.set(.5,.5),o.position.set(game.system.width/2+260,game.system.height/2),this.track=o,this.container.addChild(o);var h=new game.Sprite("Scroller.png");h.anchor.set(.5,.5),h.position.set(o.position.x,o.position.y-o.height/2+h.height/2),h.interactive=!0,h.buttonMode=!0,h.mousedown=h.touchstart=this.mousedown.bind(this),h.mouseup=h.touchend=h.mouseupoutside=h.touchendoutside=this.mouseup.bind(this),h.mousemove=h.touchmove=this.mousemove.bind(this),this.scroller=h,this.container.addChild(h),this.rowsContainer=new game.Container,this.container.addChild(this.rowsContainer),this.statusText=new game.BitmapText("Loading...",{font:"FredokaText"}),this.statusText.position.set(game.system.width/2-this.statusText.textWidth/2,game.system.height/2-this.statusText.textHeight/2),this.container.addChild(this.statusText),this.getScores()},getScores:function(){var e={perPage:1e3,pageNumber:1};game.db.getScores(e,this.dataLoaded.bind(this))},dataLoaded:function(e){e.error?(this.statusText.setText("Error connecting to database"),this.statusText.updateTransform(),this.statusText.position.set(game.system.width/2-this.statusText.textWidth/2,game.system.height/2-this.statusText.textHeight/2)):(this.container.removeChild(this.statusText),this.data=e,this.data.results.length>this.maxResults&&(this.data.results.length=this.maxResults),this.pages=Math.ceil(this.data.results.length/this.perPage),this.changePage(this.currentPage))},close:function(){game.scene.addTween(this.container,{alpha:0},200,{onComplete:this.closeComplete.bind(this)}).start()},closeComplete:function(){this.container.parent.removeChild(this.container),"function"==typeof this.closeCallback&&this.closeCallback()},mousedown:function(){this._mousedown=!0},mouseup:function(){this._mousedown=!1},mousemove:function(e){if(this.data&&this._mousedown){var t=e.global.y.limit(this.track.position.y-this.track.height/2+this.scroller.height/2,this.track.position.y+this.track.height/2-this.scroller.height/2);this.scroller.position.y=t;var i=t-(this.track.position.y-this.track.height/2)-this.scroller.height/2,s=Math.max(1,Math.ceil(i/((this.track.height-this.scroller.height)/this.pages)));this.currentPage!==s&&this.changePage(s)}},changePage:function(e){this.currentPage!==e&&game.audio.playSound("audio/button-rollover.m4a"),this.currentPage=e;for(var t=this.rowsContainer.children.length-1;t>=0;t--)this.rowsContainer.removeChild(this.rowsContainer.children[t]);for(var t=0;t<this.perPage;t++){var i=this.data.results[(this.currentPage-1)*this.perPage+t];if(!i)break;var s=new game.BitmapText(((this.currentPage-1)*this.perPage+(t+1)).toString(),{font:"FredokaTitle"}),a=new game.BitmapText(i.name_str,{font:"FredokaTitle"}),n=new game.BitmapText(game.getScoreText(i.score_int),{font:"FredokaTitle"});s.position.x=game.system.width/2-200,a.position.x=game.system.width/2-100,n.position.x=game.system.width/2+200-n.textWidth,s.position.y=a.position.y=n.position.y=200+46*t,this.rowsContainer.addChild(s),this.rowsContainer.addChild(a),this.rowsContainer.addChild(n)}},addTo:function(e){return this.container.alpha=0,e.addChild(this.container),game.scene.addTween(this.container,{alpha:1},200).start(),this}}),game.toggleSound=function(e){game.audio.musicMuted?(game.audio.soundMuted=game.audio.musicMuted=!1,game.audio.resumeAll(),e.alpha=1):(game.audio.pauseAll(),game.audio.soundMuted=game.audio.musicMuted=!0,e.alpha=.5)},game.getScoreText=function(e){var t=e.toString();return t.length>3&&(t=t.substr(0,t.length-3)+","+t.substr(t.length-3)),t}});